import{c as G,T as i,M as e,O as K,g as q,F as V}from"./index-DG-X5MhE.js";import{o as Y}from"./clock-WUT2miNn-C_mFelBV.js";import{u as Q,p as X,h as Z,g as ee,f as te}from"./GenericConfirmationModal-VeCxLLv1-DvtuwBiU.js";import{m as R}from"./notifications-D5TRqq6t-DQIGt6BL.js";import{b as ae,A as se,$ as re}from"./storage-Cnls39ez-BBYBvF2Y.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=q("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),le=({stats:t,todayJobs:r,isLoading:d})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(z,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tugas Hari Ini"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.today})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(Y,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tugas Minggu Ini"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.thisWeek})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(K,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Tugas Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.completed})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Jadwal Hari Ini"}),d?e.jsx("div",{className:"text-center py-10 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Memuat data..."})}):r.length>0?e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg divide-y dark:divide-slate-700",children:r.map(a=>e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.service})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-primary",children:a.time}),e.jsx("p",{className:"text-xs text-gray-400",children:a.status})]})]},a.id))}):e.jsx("div",{className:"text-center py-10 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal untuk hari ini."})})]})]}),ne=({currentUserName:t,onOpenSidebar:r})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:r,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),J=({label:t,photoUrlOrPath:r,onUploadFile:d,disabled:a=!1,size:l=72})=>{const[x,c]=i.useState(!1),[u,g]=i.useState(null),p=i.useRef(null),f=i.useMemo(()=>se(r),[r]),y=u||f||null,L=()=>{var w;a||x||(w=p.current)==null||w.click()},_=async w=>{var v;const S=(v=w.target.files)==null?void 0:v[0];if(!S)return;const T=URL.createObjectURL(S);g(T);try{c(!0),await d(S)}catch(j){console.error(j),alert((j==null?void 0:j.message)||"Gagal upload foto."),g(null)}finally{c(!1),p.current&&(p.current.value=""),setTimeout(()=>{URL.revokeObjectURL(T)},1e3)}};return e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-100 truncate",children:t}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:y?"Preview siap":"Belum ada foto"})]}),e.jsx("div",{className:"shrink-0",children:e.jsxs("button",{type:"button",onClick:L,disabled:a||x,className:`group relative overflow-hidden rounded-xl border shadow-sm transition ${a?"opacity-60 cursor-not-allowed":"hover:shadow-md"} border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800`,style:{width:l,height:l},"aria-label":y?`Ganti ${t}`:`Unggah ${t}`,children:[y?e.jsx("img",{src:y,alt:t,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-50 dark:bg-slate-900",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})})}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center text-[11px] font-bold text-white transition ${x?"bg-black/55 opacity-100":"bg-black/40 opacity-0 group-hover:opacity-100"}`,children:x?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Upload"]}):e.jsx("span",{children:y?"Ganti":"Unggah"})}),e.jsx("input",{ref:p,type:"file",className:"sr-only",onChange:_,accept:"image/*",disabled:a||x})]})})]})},A={Confirmed:1,"On Site":2,"In Progress":3,Completed:4,Cancelled:5};async function ie(t,r,d,a){const l=A[r]??A.Confirmed,x=await fetch("https://api-homeservice.viniela.id/api/v1/admin/update-booking-status",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({form_id:t,user_id:d,arrival_time:a.arrival_time,start_time:a.start_time,end_time:a.end_time,work_duration_minutes:a.work_duration_minutes,note:a.note,additional_cost:a.additional_cost,status:l})}),c=await x.json().catch(()=>null);if(!x.ok){const u=(c==null?void 0:c.message)||(c==null?void 0:c.error)||`Gagal update status (status ${x.status})`;throw new Error(u)}}const H=({booking:t,currentTechnicianId:r,onBookingUpdateLocal:d,onRefresh:a})=>{var l,x;const{addNotification:c}=V(),u=new Date;u.setHours(0,0,0,0);const g=new Date(t.startDate);g.setHours(0,0,0,0);const p=new Date(t.endDate);p.setHours(0,0,0,0);const f=g.getTime()!==p.getTime(),y=u>=g&&u<=p,L=u.getTime()===g.getTime(),_=u.getTime()===p.getTime(),[w,v]=i.useState(!1),[S,T]=i.useState(!1),[j,C]=i.useState(t.note||""),[B,P]=i.useState(t.additionalCosts||0),[M,n]=i.useState(()=>(t.additionalCosts||0).toString()==="0"?"0":new Intl.NumberFormat("id-ID").format(t.additionalCosts||0)),k=s=>{const m=s.target.value;if(m===""){P(0),n("");return}const o=parseInt(m.replace(/\./g,""),10);isNaN(o)||(P(o),n(new Intl.NumberFormat("id-ID").format(o)))},b=()=>{M===""&&n("0")},I=()=>{const s=t.formId??t.form_id??null;if(!s)throw new Error("form_id tidak ditemukan pada booking (cek mapping API).");return Number(s)},N=async(s,m)=>{const o=I();if(!o)throw new Error("booking.id tidak valid untuk form_id.");await ie(o,s,r,m);const $={...t,...m,status:s};d($),await a()},h=async s=>{const m=new Date().toISOString();try{if(s==="On Site"){const o=R("technician_on_the_way",{...t,status:s,arrivalTime:m});c(o,"info"),await N(s,{arrival_time:m});return}if(s==="In Progress"){await N(s,{start_time:m});return}await N(s)}catch(o){console.error(o),c((o==null?void 0:o.message)||"Gagal update status di server.","error")}},D=async(s,m)=>{const o=I();if(!o)throw new Error("booking.id tidak valid untuk form_id.");const $=await re(o,s,m),U=$==null?void 0:$.url,F={...t,photos:{...t.photos||{},[s]:U}};d(F),await a()},O=async()=>{try{const s=new Date,m=t.startTime,o=new Date(m),$=Math.round((s.getTime()-o.getTime())/6e4);await N("Completed",{end_time:s.toISOString(),work_duration_minutes:String($),note:j,additional_cost:B});const U=R("job_completed",{...t,status:"Completed"});c(U,"success"),v(!1),T(!1)}catch(s){console.error(s),c((s==null?void 0:s.message)||"Gagal menyelesaikan pekerjaan.","error")}},E=()=>{const s=g.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"});if(!f)return`${s} - ${t.time}`;const m=p.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"});return`${s} s/d ${m}`},W=()=>{var s,m,o,$,U;if(!y&&t.status!=="Completed"&&t.status!=="Cancelled")return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Tugas belum dimulai."})});switch(t.status){case"Confirmed":return L?e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700",children:e.jsx("button",{onClick:()=>h("On Site"),className:"w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors",children:"Saya Sudah di Lokasi"})}):e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsxs("p",{className:"font-semibold text-gray-500 dark:text-gray-400",children:["Tugas dimulai pada ",g.toLocaleDateString("id-ID")]})});case"On Site":return e.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:[e.jsx(J,{label:"Foto Tiba di Lokasi",photoUrlOrPath:(s=t.photos)==null?void 0:s.arrival,onUploadFile:F=>D("arrival",F)}),((m=t.photos)==null?void 0:m.arrival)&&e.jsx(J,{label:"Foto Sebelum Pengerjaan",photoUrlOrPath:(o=t.photos)==null?void 0:o.before,onUploadFile:F=>D("before",F)}),e.jsx("button",{onClick:()=>h("In Progress"),disabled:!(($=t.photos)!=null&&$.arrival)||!((U=t.photos)!=null&&U.before),className:"w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors disabled:bg-gray-400",children:"Mulai Pekerjaan"})]});case"In Progress":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:_?e.jsx("button",{onClick:()=>v(!0),className:"w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors",children:"Selesaikan Pekerjaan"}):e.jsx("p",{className:"font-semibold text-yellow-600 dark:text-yellow-400 text-center",children:"Pekerjaan Sedang Berlangsung"})});case"Completed":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-green-600 dark:text-green-400",children:"Pekerjaan Selesai"})});case"Cancelled":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-red-600 dark:text-red-400",children:"Dibatalkan"})});default:return null}};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border-l-4 border-transparent",children:[e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.service}),e.jsx("p",{className:"font-bold text-lg text-gray-800 dark:text-white",children:t.name})]}),y&&e.jsx("span",{className:"text-xs font-bold bg-primary text-white px-2 py-1 rounded-full",children:"AKTIF HARI INI"})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-secondary dark:text-slate-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Jadwal:"})," ",E()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Alamat:"})," ",t.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Telepon:"})," ",t.whatsapp]})]}),w?e.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:[e.jsx("h4",{className:"font-bold text-center",children:"Formulir Penyelesaian"}),e.jsx(J,{label:"Foto Setelah Selesai",photoUrlOrPath:(l=t.photos)==null?void 0:l.after,onUploadFile:s=>D("after",s)}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`notes-${t.id}`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Catatan Pekerjaan Tambahan"}),e.jsx("textarea",{id:`notes-${t.id}`,rows:3,value:j,onChange:s=>C(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"Catatan tambahan..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`costs-${t.id}`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Biaya Tambahan (Bahan, dll.)"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"Rp"})}),e.jsx("input",{type:"text",inputMode:"numeric",id:`costs-${t.id}`,value:M,onChange:k,onBlur:b,className:"block w-full rounded-md border-gray-300 pl-8 pr-2 dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"0"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"w-full bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors",children:"Batal"}),e.jsx("button",{onClick:()=>T(!0),disabled:!((x=t.photos)!=null&&x.after),className:"w-full bg-primary text-white font-bold py-2 px-4 rounded-lg hover:bg-primary-dark transition-colors disabled:bg-gray-400",children:"Konfirmasi Selesai"})]})]}):W()]}),e.jsx(te,{isOpen:S,onClose:()=>T(!1),onConfirm:O,title:"Konfirmasi Penyelesaian",confirmText:"Ya, Selesaikan",confirmButtonClass:"bg-green-600 hover:bg-green-700 focus:ring-green-500",children:e.jsx("p",{children:"Apakah Anda yakin ingin menyelesaikan pekerjaan ini?"})})]})},oe=({jobFilter:t,setJobFilter:r,refreshBookings:d,categories:a,completedJobs:l,currentTechnicianId:x,onBookingUpdateLocal:c,onRefresh:u})=>{const g=i.useMemo(()=>Object.entries(a),[a]),p=i.useMemo(()=>g.every(([,f])=>f.length===0),[g]);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center gap-3",children:[e.jsxs("div",{className:"inline-flex rounded-md shadow-sm bg-white dark:bg-slate-800 p-1",children:[e.jsx("button",{onClick:()=>r("upcoming"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${t==="upcoming"?"bg-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:"Akan Datang"}),e.jsx("button",{onClick:()=>r("completed"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${t==="completed"?"bg-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:"Riwayat"})]}),e.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-semibold rounded-md bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700",children:"Refresh"})]}),t==="upcoming"&&(p?e.jsx("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Tidak Ada Tugas Akan Datang"})}):e.jsx("div",{className:"space-y-10",children:g.map(([f,y])=>y.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:f}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:y.map(L=>e.jsx(H,{booking:L,currentTechnicianId:x,onBookingUpdateLocal:c,onRefresh:u},L.id))})]},f):null)})),t==="completed"&&(l.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:l.map(f=>e.jsx(H,{booking:f,currentTechnicianId:x,onBookingUpdateLocal:c,onRefresh:u},f.id))}):e.jsx("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Belum Ada Riwayat Tugas"})}))]})};function de(t,r,d){const a=t==null?void 0:t.slice(0,10),l=r==null?void 0:r.slice(0,10);return a!==l?`${a} s/d ${l}`:`${a} - ${d}`}const ce=({upcomingJobsFlat:t,selectedLocation:r,setSelectedLocation:d})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]","data-aos":"fade-up",children:[e.jsx("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:t.length>0?t.map(a=>e.jsx("div",{className:`w-full p-4 rounded-lg transition-all duration-200 border-l-4 ${(r==null?void 0:r.title)===a.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent"}`,children:e.jsxs("button",{onClick:()=>d({lat:a.lat,lng:a.lng,title:a.name}),className:"w-full text-left",children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm font-semibold text-primary mt-1",children:de(a.startDate,a.endDate,a.time)})]})},a.id)):e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:"Tidak ada pekerjaan akan datang."})})}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:r?e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${r.lat},${r.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${r.lat}-${r.lng}`):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(ee,{size:48,className:"mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Tugas"}),e.jsx("p",{children:"Tidak ada tugas akan datang untuk ditampilkan."})]})})]}),me=({isOpen:t,activeSection:r,onSelect:d,onLogout:a})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${t?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Teknisi"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:[{name:"Dashboard",icon:Q,section:"dashboard"},{name:"Tugas Saya",icon:z,section:"jobs"},{name:"Peta Tugas",icon:X,section:"map"}].map(l=>e.jsxs("button",{onClick:()=>d(l.section),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${r===l.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(l.icon,{size:20}),l.name]},l.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(Z,{size:20}),"Logout"]})})]}),be=()=>{const{currentUser:t,logout:r}=G(),[d,a]=i.useState([]),[l,x]=i.useState("dashboard"),[c,u]=i.useState(!1),[g,p]=i.useState(null),[f,y]=i.useState("upcoming"),[L,_]=i.useState(!1),w=i.useCallback(async()=>{_(!0);try{const n=await ae();a(n)}catch(n){console.error(n)}finally{_(!1)}},[]);if(i.useEffect(()=>{const n=()=>w();return window.addEventListener("focus",n),n(),()=>window.removeEventListener("focus",n)},[w]),!t)return e.jsx("div",{className:"text-center py-20",children:"Loading..."});const v=Number(t==null?void 0:t.id);if(!v)return e.jsx("div",{className:"text-center py-20",children:"currentUser.id tidak ada. Pastikan endpoint auth/me mengembalikan id user."});const S=i.useMemo(()=>d.filter(n=>Number(n.technicianId)===v).sort((n,k)=>new Date(n.startDate).getTime()-new Date(k.startDate).getTime()),[d,v]),{completedJobs:T,upcomingJobsCategorized:j,upcomingJobsFlat:C}=i.useMemo(()=>{const n=S.filter(h=>h.status!=="Completed"&&h.status!=="Cancelled"),k=S.filter(h=>h.status==="Completed"||h.status==="Cancelled"),b=new Date;b.setHours(0,0,0,0);const I=new Date(b);I.setDate(b.getDate()+1);const N={today:[],tomorrow:[],upcoming:[]};return n.forEach(h=>{const D=new Date(h.startDate);D.setHours(0,0,0,0);const O=new Date(h.endDate);O.setHours(0,0,0,0),D.getTime()===b.getTime()||b>D&&b<=O?N.today.push(h):D.getTime()===I.getTime()?N.tomorrow.push(h):D.getTime()>I.getTime()&&N.upcoming.push(h)}),{completedJobs:k,upcomingJobsCategorized:N,upcomingJobsFlat:n}},[S]);i.useEffect(()=>{l==="map"&&C.length>0&&!g&&p({lat:C[0].lat,lng:C[0].lng,title:C[0].name})},[l,C,g]);const B=n=>{a(k=>k.map(b=>b.id===n.id?n:b))},P=i.useMemo(()=>{const n=new Date,k=new Date(n);k.setDate(n.getDate()-n.getDay()),k.setHours(0,0,0,0);const b=new Date(k);b.setDate(k.getDate()+6),b.setHours(23,59,59,999);const I=C.filter(N=>{const h=new Date(N.startDate);return h>=k&&h<=b});return{today:j.today.length,thisWeek:I.length,completed:T.length}},[j.today,C,T]),M={dashboard:"Dashboard",jobs:"Tugas Saya",map:"Peta Tugas"};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx(me,{isOpen:c,activeSection:l,onSelect:n=>{x(n),u(!1)},onLogout:r}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(ne,{currentUserName:(t==null?void 0:t.name)||"",onOpenSidebar:()=>u(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white mb-6",children:M[l]}),l==="dashboard"&&e.jsx(le,{stats:P,todayJobs:j.today,isLoading:L}),l==="jobs"&&e.jsx(oe,{jobFilter:f,setJobFilter:y,refreshBookings:w,categories:{"Hari Ini":j.today,Besok:j.tomorrow,"Akan Datang":j.upcoming},completedJobs:T,currentTechnicianId:v,onBookingUpdateLocal:B,onRefresh:w}),l==="map"&&e.jsx(ce,{upcomingJobsFlat:C,selectedLocation:g,setSelectedLocation:p})]})]})]}),c&&e.jsx("div",{onClick:()=>u(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"})]})};export{be as default};
