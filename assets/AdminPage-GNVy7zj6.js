import{c as z,r as n,j as e,X as Ye,a as Ge,R as Ta,d as Ba,e as _a}from"./index-CGd5Tk4V.js";import{a as Ve,f as E,p as Te}from"./storage-BHb65FEp.js";import{C as $e}from"./Calendar-KoDvXCiO.js";import{L as Ia,M as $a,a as Oa,b as Pa,G as Be}from"./GenericConfirmationModal-DR-1mjBC.js";import{f as Xe,b as Ua,c as La,d as Fa,e as Ea,g as Ha,h as Ra,m as za,B as Ke,s as Ga,u as Ka,i as Wa,j as We,k as Ja,l as qa,n as Ya}from"./admin-DdTG2enl.js";import{T as Qe}from"./trash-2-D9xBwq_v.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=z("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=z("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=z("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=z("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=z("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=z("PencilLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=z("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=z("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=z("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=z("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Z={lat:-6.175392,lng:106.827153,mapSrc:"https://maps.google.com/maps?q=-6.175392,106.827153&z=16&output=embed"},nt=({isOpen:t,onClose:r,onSave:x,services:s,technicians:g,availability:c})=>{const[d,N]=n.useState({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),[S,I]=n.useState({lat:Z.lat,lng:Z.lng}),[y,C]=n.useState({}),[$,v]=n.useState(Z.mapSrc),A=c||{fullyBookedDates:[],bookedSlots:[]},P=n.useMemo(()=>new Set(A.fullyBookedDates||[]),[A.fullyBookedDates]),j=n.useMemo(()=>new Set(A.bookedSlots||[]),[A.bookedSlots]),i=n.useMemo(()=>Ve(9,17,12,13,30),[]);n.useEffect(()=>{t&&(N({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),C({}),I({lat:Z.lat,lng:Z.lng}),v(Z.mapSrc))},[t]);const T=h=>{const{name:M,value:m}=h.target;C(B=>({...B,[M]:void 0})),N(B=>({...B,[M]:m}))},O=h=>{const M=new Date(h);M.setDate(M.getDate()),N(m=>({...m,startDate:h,endDate:M,time:""})),C(m=>({...m,startDate:void 0,time:void 0}))},L=()=>{const h={};return d.name.trim()||(h.name="Nama wajib diisi."),d.whatsapp.trim()||(h.whatsapp="Nomor WhatsApp wajib diisi."),d.address.trim()||(h.address="Alamat wajib diisi."),d.service||(h.service="Layanan wajib dipilih."),d.startDate||(h.startDate="Tanggal wajib dipilih."),d.time||(h.time="Waktu wajib dipilih."),C(h),Object.keys(h).length===0},w=h=>{if(h.preventDefault(),!L()||!d.startDate)return;const M=d.startDate.toISOString().slice(0,10),m=Number(d.service),B=d.technician&&d.technician!==""?Number(d.technician):null,U={fullname:d.name,whatsapp:d.whatsapp,address:d.address,service:m,user_id:B,status:d.status,lat:S.lat,lng:S.lng,schedule_date:M,schedule_time:d.time};x(U)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:r,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-5xl transform transition-all",onClick:h=>h.stopPropagation(),children:e.jsxs("form",{onSubmit:w,noValidate:!0,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Tambah Booking Manual"}),e.jsx("button",{type:"button",onClick:r,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Ye,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Pelanggan"}),e.jsx("input",{type:"text",name:"name",value:d.name,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),y.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",name:"whatsapp",value:d.whatsapp,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),y.whatsapp&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.whatsapp})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alamat Lengkap"}),e.jsx("textarea",{name:"address",rows:2,value:d.address,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),y.address&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Layanan"}),e.jsxs("select",{name:"service",value:d.service,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih Layanan --"}),s.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),y.service&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.service})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Teknisi"}),e.jsxs("select",{name:"technician",value:d.technician,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Belum Ditugaskan"}),g.map(h=>e.jsx("option",{value:h.id,children:h.name||h.fullname||h.username},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status Awal"}),e.jsx("select",{name:"status",value:d.status,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:["Confirmed","On Site","In Progress","Completed","Cancelled"].map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Jadwal"}),e.jsx($e,{selectedDate:d.startDate,onDateSelect:O,fullyBookedDates:P}),y.startDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.startDate})]}),d.startDate?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.map(h=>{const M=`${E(d.startDate)}-${h}`,m=j.has(M);return e.jsx("button",{type:"button",onClick:()=>N(B=>({...B,time:h})),disabled:m,className:`p-2 rounded-md text-sm font-semibold border-2 transition-colors ${d.time===h?"bg-primary text-white border-primary":"bg-transparent border-gray-300 dark:border-slate-600"} ${m?"bg-gray-200 dark:bg-slate-600 text-gray-400 dark:text-gray-500 line-through cursor-not-allowed":"hover:border-primary"}`,children:h},h)})}),y.time&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.time})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"h-48 flex items-center justify-center bg-gray-50 dark:bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Pilih tanggal dahulu"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lokasi (sementara default: Monas, Jakarta)"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Untuk sekarang, lokasi booking akan tersimpan di sekitar Monas (lat: ",Z.lat,", lng: ",Z.lng,")."]}),e.jsx("div",{className:"mt-2 h-64 w-full rounded-lg overflow-hidden border dark:border-slate-600",children:e.jsx("iframe",{title:"Booking Location Default Monas",width:"100%",height:"100%",style:{border:0},src:$,allowFullScreen:!1,loading:"lazy"},$)})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-500",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan Booking"})]})]})})}):null},lt=["unit","jam","kg","m²"];function it(t){const r={includes:[],excludes:[]};if(!t)return r;if(typeof t=="object")return{includes:Array.isArray(t.includes)?t.includes.map(String):[],excludes:Array.isArray(t.excludes)?t.excludes.map(String):[]};if(typeof t=="string"){const x=t.trim();if(!x)return r;try{const s=JSON.parse(x);return{includes:Array.isArray(s==null?void 0:s.includes)?s.includes.map(String):[],excludes:Array.isArray(s==null?void 0:s.excludes)?s.excludes.map(String):[]}}catch{return{includes:[x],excludes:[]}}}return r}function be(t){const r=t.map(x=>(x??"").trim()).filter(Boolean);return Array.from(new Set(r))}const dt=({isOpen:t,onClose:r,onSave:x,serviceToEdit:s,categoryToEdit:g,serviceCategories:c})=>{const d=!!s,[N,S]=n.useState(""),[I,y]=n.useState(""),[C,$]=n.useState("unit"),[v,A]=n.useState(""),[P,j]=n.useState(""),[i,T]=n.useState(""),[O,L]=n.useState(""),[w,h]=n.useState(!1),[M,m]=n.useState([]),[B,U]=n.useState([]),[Y,G]=n.useState(""),[V,K]=n.useState(""),[J,W]=n.useState(!1),re=n.useMemo(()=>c,[c]);n.useEffect(()=>{if(t)if(s){S(s.name??""),y(typeof s.price=="number"?String(s.price):s.price??""),$(s.unit_price||"unit"),A(s.service_category?String(s.service_category):""),j(g||s.category||"");const u=s.duration_minute,D=s.duration_hour;T(u!=null&&String(u)!=="0"?String(u):""),L(D!=null&&String(D)!=="0"?String(D):"");const R=s.is_guarantee;h(!!Number(R??0));const H=s.point,q=it(H);m(q.includes),U(q.excludes),G(""),K("")}else S(""),y(""),$("unit"),A(""),j(""),T(""),L(""),h(!1),m([]),U([]),G(""),K("")},[t,s,g]);const X=u=>{const D=u.target.value;A(D);const R=Number(D),H=c.find(q=>q.id===R);H&&j(H.name)},ie=u=>{const D=u.target.value;j(D),D||A("")},Q=()=>{const u=Y.trim();u&&(m(D=>be([...D,u])),G(""))},xe=()=>{const u=V.trim();u&&(U(D=>be([...D,u])),K(""))},fe=u=>{m(D=>D.filter((R,H)=>H!==u))},ke=u=>{U(D=>D.filter((R,H)=>H!==u))},je=async u=>{if(u.preventDefault(),!!N.trim()&&I.trim()&&P.trim()){W(!0);try{const D=v!==""?Number(v):(s==null?void 0:s.service_category)??0,R=JSON.stringify({includes:be(M),excludes:be(B)}),H={id:(s==null?void 0:s.id)??0,name:N.trim(),price:I.trim(),unit_price:C,service_category:D,category:P.trim(),duration_minute:i.trim()||"",duration_hour:O.trim()||"",is_guarantee:w,point:R};x(H,v)}finally{W(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-3xl",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:d?"Edit Layanan":"Tambah Layanan Baru"}),e.jsx("button",{type:"button",onClick:r,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:"✕"})]}),e.jsxs("form",{onSubmit:je,className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Nama Layanan"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:N,onChange:u=>S(u.target.value),placeholder:"Contoh: Cuci AC 1 PK",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Harga"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:I,onChange:u=>y(u.target.value),placeholder:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Satuan Harga"}),e.jsx("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:C,onChange:u=>$(u.target.value),children:lt.map(u=>e.jsx("option",{value:u,children:u},u))})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("input",{id:"isGuarantee",type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary",checked:w,onChange:u=>h(u.target.checked)}),e.jsx("label",{htmlFor:"isGuarantee",className:"text-sm text-slate-700 dark:text-slate-200",children:"Bergaransi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Kategori"}),e.jsxs("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary mb-2",value:v,onChange:X,children:[e.jsx("option",{value:"",children:"-- Pilih kategori --"}),re.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-dashed border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-xs text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-1 focus:ring-primary",placeholder:"Label kategori untuk tampilan (opsional)",value:P,onChange:ie})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (menit)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:u=>T(u.target.value),placeholder:"60"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (hari/jam)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:O,onChange:u=>L(u.target.value),placeholder:"1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:Y,onChange:u=>G(u.target.value),onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),Q())}}),e.jsx("button",{type:"button",onClick:Q,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin termasuk",children:e.jsx(Je,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:M.map((u,D)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:u}),e.jsx("button",{type:"button",onClick:()=>fe(D),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Ge,{size:18})})]},`${u}-${D}`))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Tidak Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:V,onChange:u=>K(u.target.value),onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),xe())}}),e.jsx("button",{type:"button",onClick:xe,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin tidak termasuk",children:e.jsx(Je,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:B.map((u,D)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:u}),e.jsx("button",{type:"button",onClick:()=>ke(D),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Ge,{size:18})})]},`${u}-${D}`))})]})]}),e.jsxs("div",{className:"pt-2 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",disabled:J,children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark disabled:opacity-60",disabled:J,children:J?"Menyimpan...":d?"Simpan Layanan":"Tambah Layanan"})]})]})]})}):null},ot=({booking:t})=>{const r=s=>s.startsWith("0")?`62${s.substring(1)}`:s,x=()=>{const s=r(t.whatsapp),g=new Date(t.startDate).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),c=`Halo ${t.name}, kami dari Viniela Home & Service ingin mengkonfirmasi pesanan Anda:

*Layanan:* ${t.service}
*Jadwal:* ${g}, pukul ${t.time}
*Alamat:* ${t.address}

Mohon balas pesan ini untuk mengkonfirmasi detail di atas sudah benar. Terima kasih.`;return`https://wa.me/${s}?text=${encodeURIComponent(c)}`};return e.jsxs("a",{href:x(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-green-600 transition-colors",title:`Chat ${t.name} di WhatsApp`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.459l-6.354 1.654zm.791-6.938c.323.517.76 1.002 1.251 1.431.987.842 2.197 1.298 3.51 1.298 5.421 0 9.811-4.39 9.811-9.811 0-2.651-1.04-5.14-2.9-7.001-1.859-1.86-4.35-2.901-7.001-2.901-5.42 0-9.81 4.39-9.81 9.81 0 2.05.61 3.992 1.698 5.688l-.299 1.093zM9.262 7.176c-.23-.487-.474-.487-.698-.487-.203 0-.428.02-.638.211-.23.19-.813.78-.813 1.901 0 1.12.831 2.201.946 2.36.116.161 1.638 2.542 4.004 3.53.585.24 1.045.38 1.41.496.535.169.97.143 1.324-.087.419-.27.813-.981.928-1.342.116-.361.116-.671.083-.758-.032-.087-.23-.142-.487-.27-.257-.128-1.515-.748-1.758-.831-.243-.083-.419-.083-.595.083-.176.166-.66.831-.813.981-.152.152-.291.178-.487.05-.196-.128-.831-.289-1.587-.961-.595-.541-.97-1.221-1.085-1.428-.116-.208-.017-.323.07-.43.087-.107.196-.178.291-.269.1-.096.143-.15.211-.243.068-.092.032-.178-.017-.258-.05-.082-.464-1.113-.638-1.515z"})}),"Chat"]})};function ye(t){if(!t)return"-";if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);const x=new Date(t);return Number.isNaN(x.getTime())?t:x.toISOString().slice(0,10)}const r=t;return Number.isNaN(r.getTime())?"-":r.toISOString().slice(0,10)}function _e(t){if(!t)return"-";const r=typeof t=="string"?new Date(t):t;if(Number.isNaN(r.getTime()))return"-";const x=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0");return`${x}:${s}`}function ct(t){return t==null||Number.isNaN(t)?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(t)}const mt=({paginatedBookings:t,currentPage:r,totalPages:x,goToPage:s,searchTerm:g,setSearchTerm:c,statusFilter:d,setStatusFilter:N,technicianFilter:S,setTechnicianFilter:I,technicians:y,statuses:C,expandedBookingId:$,setExpandedBookingId:v,statusDraft:A,onTechnicianChange:P})=>{const j=i=>{v($===i?null:i)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[e.jsx("input",{value:g,onChange:i=>c(i.target.value),placeholder:"Cari nama pelanggan...",className:"w-full md:w-1/3 rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:d,onChange:i=>N(i.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Status"}),C.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsxs("select",{value:S,onChange:i=>I(i.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Teknisi"}),e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),y.map(i=>e.jsx("option",{value:String(i.id),children:i.name},i.id))]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700 text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Layanan"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jadwal"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Teknisi"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[t.map(i=>{var w,h,M;const T=ye(i.startDate),O=$===i.id,L=[(w=i.photos)==null?void 0:w.arrival,(h=i.photos)==null?void 0:h.before,(M=i.photos)==null?void 0:M.after].filter(Boolean);return e.jsxs(Ta.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsx("div",{className:"text-xs text-gray-500",children:i.whatsapp})]}),e.jsx("td",{className:"px-4 py-3",children:i.service}),e.jsxs("td",{className:"px-4 py-3",children:[T," • ",i.time]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:i.technicianUserId==null?"unassigned":String(i.technicianUserId),onChange:m=>P(i.id,"technician",m.target.value),className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs",children:[e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),y.map(m=>e.jsx("option",{value:String(m.id),children:m.name},m.id))]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("select",{value:A[i.id]??i.status,disabled:!0,className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs opacity-70 cursor-not-allowed",children:C.map(m=>e.jsx("option",{value:m,children:m},m))})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(ot,{booking:i}),e.jsx("button",{type:"button",onClick:()=>j(i.id),className:"inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700","aria-label":O?"Tutup detail":"Buka detail",title:O?"Tutup detail":"Buka detail",children:O?e.jsx(Za,{size:18}):e.jsx(Qa,{size:18})})]})})]}),O&&e.jsx("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:e.jsx("td",{colSpan:6,className:"px-4 py-4 bg-gray-50/60 dark:bg-slate-900/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Detail Pelanggan"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Nama"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:i.name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"WhatsApp"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:i.whatsapp||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Alamat"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:i.address||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Laporan Kerja"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Tiba"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:i.arrival_time?`${ye(i.arrival_time)} ${_e(i.arrival_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Mulai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:i.start_time?`${ye(i.start_time)} ${_e(i.start_time)}`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Selesai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:i.end_time?`${ye(i.end_time)} ${_e(i.end_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Durasi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:i.work_duration_minutes!=null?`${i.work_duration_minutes} mnt`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Biaya Tambahan"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:ct(i.additional_cost??0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Teknisi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:i.technician||"Belum Ditugaskan"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Catatan"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:i.note||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Bukti Foto"}),L.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((m,B)=>e.jsx("a",{href:m,target:"_blank",rel:"noreferrer",className:"block",title:"Klik untuk membuka",children:e.jsx("img",{src:`https://api-homeservice.viniela.id${m}`,alt:`Bukti foto ${B+1}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200 dark:border-slate-600 hover:opacity-90",loading:"lazy"})},`${i.id}-photo-${B}`))}):e.jsx("div",{className:"text-sm text-gray-500",children:"Belum ada foto."})]})]})})})]},i.id)}),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada data booking."})})]})]})}),x>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(r-1),disabled:r===1,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Prev"}),e.jsxs("span",{className:"text-xs py-1",children:["Halaman ",r," dari ",x]}),e.jsx("button",{onClick:()=>s(r+1),disabled:r===x,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Next"})]})]})},ut=({currentUserName:t,onOpenSidebar:r})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:r,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),xt=[{name:"Dashboard KPI",icon:Xa,section:"kpi"},{name:"Daftar Booking",icon:Ia,section:"bookings"},{name:"Jadwal Teknisi",icon:Va,section:"schedule"},{name:"Peta Lokasi",icon:$a,section:"map"},{name:"Manajemen Tim/User",icon:rt,section:"technicians"},{name:"Manajemen Layanan",icon:Ie,section:"services"},{name:"Atur Ketersediaan",icon:Ie,section:"availability"}],ht=({activeSection:t,onSectionChange:r,isOpen:x,onClose:s,onLogout:g})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${x?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Admin Viniela"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:xt.map(c=>e.jsxs("button",{onClick:()=>{r(c.section),s()},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${t===c.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(c.icon,{size:20}),c.name]},c.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:g,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(Oa,{size:20}),"Logout"]})})]}),gt=({isOpen:t,onClose:r,onSave:x,technicianToEdit:s,existingUsernames:g,roles:c})=>{const[d,N]=n.useState({}),[S,I]=n.useState({});n.useEffect(()=>{var v,A;if(t){const P=(s==null?void 0:s.role)||((v=c.find(j=>j.name==="technician"))==null?void 0:v.name)||((A=c[0])==null?void 0:A.name)||"";N(s?{...s,password:""}:{name:"",username:"",role:P,password:""}),I({})}},[t,s,c]);const y=v=>{const{name:A,value:P}=v.target;N(j=>({...j,[A]:P})),S[A]&&I(j=>({...j,[A]:""}))},C=()=>{var A,P,j,i;const v={};return(A=d.name)!=null&&A.trim()||(v.name="Nama wajib diisi."),(P=d.username)!=null&&P.trim()||(v.username="Username wajib diisi."),(j=d.role)!=null&&j.trim()||(v.role="Peran wajib diisi."),s||((i=d.password)!=null&&i.trim()||(v.password="Password wajib diisi untuk user baru."),g.includes(d.username.trim())&&(v.username="Username sudah digunakan.")),I(v),Object.keys(v).length===0},$=v=>{v.preventDefault(),C()&&x({...d})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:r,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg transform transition-all",onClick:v=>v.stopPropagation(),children:e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:s?"Edit User":"Tambah User Baru"}),e.jsx("button",{type:"button",onClick:r,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Ye,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Lengkap"}),e.jsx("input",{type:"text",name:"name",value:d.name||"",onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),S.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:S.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:d.username||"",onChange:y,readOnly:!!s,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary read-only:bg-gray-100 dark:read-only:bg-slate-600"}),S.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:S.username})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role User"}),e.jsxs("select",{name:"role",value:d.role||"",onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Pilih role"}),c.map(v=>e.jsx("option",{value:v.name,children:v.name},v.id))]}),S.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:S.role})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:d.password||"",onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),S.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:S.password}),s&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Kosongkan jika tidak ingin mengubah password."})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:r,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-5 00",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan"})]})]})})}):null},pt=({availableTimes:t,selectedDate:r,onSelectedDateChange:x,draftFullyBooked:s,draftBookedSlots:g,onToggleFullDay:c,onToggleSlot:d,onRemoveBlockedDate:N,hasUnsavedChanges:S,showSaveSuccess:I,onSaveChanges:y})=>e.jsxs("div",{children:[e.jsxs("div",{className:"sticky top-4 lg:top-20 z-10 flex justify-end items-center mb-4 p-3 bg-light-bg/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-lg",children:[I&&e.jsx("span",{className:"text-green-600 font-semibold mr-4",children:"Perubahan berhasil disimpan!"}),e.jsx("button",{onClick:y,disabled:!S,className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Simpan Perubahan"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk mengatur slot waktu atau memblokir sepanjang hari."}),e.jsx($e,{selectedDate:r,onDateSelect:C=>x(C),fullyBookedDates:s})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-1 xl:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Atur Slot Waktu"}),r?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"font-semibold text-lg text-secondary dark:text-slate-300",children:r.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("button",{onClick:c,className:`px-3 py-1.5 text-xs font-bold rounded-full ${s.has(E(r))?"bg-red-100 text-red-700":"bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-200"}`,children:s.has(E(r))?"Buka Blokir Hari Ini":"Blokir Seharian"})]}),e.jsx("div",{className:`grid grid-cols-3 sm:grid-cols-4 gap-3 ${s.has(E(r))?"opacity-40 pointer-events-none":""}`,children:t.map(C=>{const $=`${E(r)}-${C}`,v=g.has($);return e.jsx("button",{onClick:()=>d(C),className:`text-center font-semibold px-4 py-2.5 rounded-lg border-2 transition-colors duration-200 ${v?"bg-red-500 border-red-500 text-white":"bg-white dark:bg-slate-700 border-gray-200 dark:border-gray-600 hover:border-primary"}`,children:C},C)})}),s.has(E(r))&&e.jsx("p",{className:"text-center mt-4 text-sm text-red-500 font-medium",children:"Semua slot tidak tersedia karena hari ini diblokir."})]}):e.jsx("div",{className:"text-center py-20 text-gray-500 dark:text-gray-400",children:"Pilih tanggal dari kalender untuk memulai."})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-2 xl:col-span-3 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Daftar Tanggal yang Diblokir Penuh"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Berikut adalah daftar tanggal yang telah Anda tandai sebagai penuh (tidak termasuk slot individual)."}),Array.from(s).length>0?e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:Array.from(s).sort((C,$)=>Te(C).getTime()-Te($).getTime()).map(C=>e.jsxs("li",{className:"flex justify-between items-center bg-light-bg dark:bg-slate-700 p-3 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:Te(C).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("button",{onClick:()=>N(C),className:"text-red-500 hover:text-red-700 text-sm font-bold",children:"Hapus"})]},C))}):e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada tanggal yang diblokir penuh."})]})]})]}),bt=({data:t,title:r})=>{const x=Math.max(...t.map(g=>g.value),1),s=["#14B8A6","#2DD4BF","#5EEAD4","#99F6E4","#CCFBF1"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:r}),e.jsx("div",{className:"space-y-3",children:t.map((g,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200 truncate pr-2",children:g.label}),e.jsx("span",{className:"font-bold text-primary",children:g.value})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-4 rounded-full",style:{width:`${g.value/x*100}%`,backgroundColor:s[c%s.length]},title:`${g.label}: ${g.value}`})})]},g.label))})]})},qe={Confirmed:"#3B82F6","On Site":"#06B6D4","In Progress":"#EAB308",Completed:"#22C55E",Cancelled:"#9CA3AF"},yt=({data:t,title:r})=>{const x=t.reduce((c,d)=>c+d.value,0);if(x===0)return null;let s=0;const g=t.map(c=>{const d=qe[c.label]||"#CCCCCC",N=c.value/x*100,S=s;return s+=N,`${d} ${S}% ${s}%`});return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:r}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"w-40 h-40 rounded-full mx-auto",style:{background:`conic-gradient(${g.join(", ")})`}}),e.jsx("div",{className:"space-y-2",children:t.map(c=>{const d=qe[c.label]||"#9CA3AF";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:d}}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:c.label})]}),e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:c.value})]},c.label)})})]})]})},ft=t=>{if(!t)return"-";if(t<60)return`${t} mnt`;const r=Math.floor(t/60),x=t%60;return x===0?`${r} jam`:`${r} jam ${x} mnt`},kt=({kpiData:t})=>{var g;const r=((g=t==null?void 0:t.popularServices)==null?void 0:g.length)??0,x=((t==null?void 0:t.popularServices)??[]).reduce((c,d)=>c+(Number(d.value)||0),0),s=r>0?`${r} Layanan Terlaris (Selesai) • Total ${x} selesai`:"Layanan Terlaris (Selesai)";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(bt,{data:t.popularServices,title:s}),e.jsx(yt,{data:t.statusDistribution,title:"Distribusi Status Pesanan"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Performa Teknisi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.technicianPerformance.length>0?t.technicianPerformance.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white",children:c.name}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pekerjaan Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:c.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Waktu Kerja"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:ft(c.totalMinutes)})]})]})]},c.name)):e.jsx("p",{className:"col-span-full text-center py-10 text-gray-500 dark:text-gray-400",children:"Belum ada data KPI yang bisa ditampilkan."})})]})]})},jt=({upcomingJobs:t,selectedLocation:r,onSelectLocation:x})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white p-2 sticky top-0 bg-white dark:bg-slate-800 z-10",children:"Pekerjaan Akan Datang"}),t.length>0?t.map(s=>e.jsxs("button",{onClick:()=>x({lat:s.lat,lng:s.lng,title:s.name}),className:`w-full text-left p-4 rounded-lg transition-all duration-200 border-l-4 ${(r==null?void 0:r.title)===s.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent hover:bg-gray-50 dark:hover:bg-slate-700/50 border-transparent"}`,children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300",children:s.service}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:s.address}),e.jsxs("div",{className:"text-sm font-semibold text-primary mt-2",children:[new Date(s.startDate).toLocaleDateString("id-ID",{day:"numeric",month:"long"})," ","- ",s.time]})]},s.id)):e.jsx("p",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada pekerjaan akan datang."})]}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-slate-700 flex-shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:["Lokasi: ",r.title]}),e.jsxs("a",{href:`https://www.google.com/maps?q=${r.lat},${r.lng}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:["Buka di Google Maps ",e.jsx(at,{size:14})]})]}),e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${r.lat},${r.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${r.lat}-${r.lng}`)]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(Pa,{className:"mb-4 text-gray-300 dark:text-gray-600",size:48}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Pekerjaan"}),e.jsx("p",{children:"Pilih pekerjaan dari daftar untuk melihat lokasinya di peta."})]})})]}),vt={Confirmed:"bg-blue-500 border-blue-700","On Site":"bg-cyan-500 border-cyan-700","In Progress":"bg-yellow-500 border-yellow-700",Completed:"bg-green-500 border-green-700",Cancelled:"bg-gray-400 border-gray-600"},Nt=({bookings:t,selectedDate:r,technicians:x})=>{const[N,S]=n.useState(()=>new Map),[I,y]=n.useState(!1),[C,$]=n.useState(null);n.useEffect(()=>{(async()=>{try{y(!0),$(null);const i=await Xe(),T=new Map;i.forEach(O=>{T.set(O.name,O)}),S(T)}catch(i){console.error("Gagal memuat services dari API:",i),$("Gagal memuat data layanan dari server.")}finally{y(!1)}})()},[]);const v=n.useMemo(()=>{const j=E(r);return t.filter(i=>{const T=E(new Date(i.startDate)),O=E(new Date(i.endDate));return j>=T&&j<=O&&i.status!=="Cancelled"})},[t,r]),A=Array.from({length:10},(j,i)=>8+i),P=j=>j>80?"bg-red-500":j>50?"bg-yellow-400":"bg-green-500";return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:["Jadwal Teknisi untuk"," ",r.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})]}),I&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Memuat data layanan..."}),C&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 mb-2",children:C}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"flex border-b-2 border-gray-200 dark:border-slate-700 pb-2",children:[e.jsx("div",{className:"w-48 flex-shrink-0"}),e.jsx("div",{className:"flex-1 grid grid-cols-10",children:A.map(j=>e.jsxs("div",{className:"text-center text-xs font-semibold text-gray-500 dark:text-gray-400",children:[String(j).padStart(2,"0"),":00"]},j))})]}),x.map(j=>{const i=v.filter(w=>w.technician===j.name),T=i.reduce((w,h)=>{const M=N.get(h.service);if(!M)return w;const m=M.duration_days&&M.duration_days>1,B=E(new Date(h.startDate))===E(r);if(m&&!B)return w+540;const U=M.duration??60;return w+U},0),O=Math.min(T/540*100,100),L=P(O);return e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-slate-700/50",children:[e.jsxs("div",{className:"w-48 flex-shrink-0 py-3 px-2 border-r border-gray-100 dark:border-slate-700/50",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-700 dark:text-gray-200 truncate",children:j.name}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5",children:[e.jsx("span",{children:"Beban Kerja"}),e.jsxs("span",{children:[(T/60).toFixed(1)," /"," ",540/60," jam"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-slate-700",title:`${O.toFixed(0)}% terisi`,children:e.jsx("div",{className:`${L} h-2 rounded-full transition-all duration-500`,style:{width:`${O}%`}})})]})]}),e.jsxs("div",{className:"flex-1 h-20 relative",children:[A.map(w=>e.jsx("div",{className:"absolute h-full border-l border-gray-100 dark:border-slate-700/50",style:{left:`${(w-8)/10*100}%`}},`line-${w}`)),i.map(w=>{const h=N.get(w.service),M=w.startDate!==w.endDate,m=E(new Date(w.startDate))===E(r);let B,U;if(M&&!m)B=0,U=600;else{const[K,J]=w.time.split(":").map(Number);B=(K-8)*60+(J||0),U=h?h.duration??60:60}const Y=B/600*100,G=U/600*100;if(Y<0||Y>=100)return null;const V=vt[w.status]||"bg-gray-500 border-gray-700";return e.jsxs("div",{className:`absolute top-2 h-16 ${V} rounded-lg p-2 text-white shadow-md overflow-hidden border-l-4`,style:{left:`${Y}%`,width:`${G}%`},title:`${w.name} - ${w.service} @ ${w.time} [Status: ${w.status}]`,children:[e.jsx("p",{className:"text-xs font-bold truncate",children:w.name}),e.jsx("p",{className:"text-[10px] opacity-80 truncate",children:w.service})]},w.id)})]})]},j.id)})]})}),v.length===0&&!I&&e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal pekerjaan untuk tanggal ini."})]})},wt=({scheduleDate:t,onScheduleDateChange:r,isLoading:x,error:s,bookings:g,technicians:c})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk melihat jadwal teknisi dari sistem backend."}),e.jsx($e,{selectedDate:t,onDateSelect:r,fullyBookedDates:new Set})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[x&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow rounded-xl p-3 text-sm text-gray-500 dark:text-gray-300",children:["Memuat jadwal teknisi untuk"," ",t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),"..."]}),s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl p-3",children:s}),e.jsx(Nt,{bookings:g,selectedDate:t,technicians:c})]})]})}),St=({services:t,onAddService:r,onEditService:x,onRequestDelete:s})=>{const g=n.useMemo(()=>{const c=new Map;return t.forEach(d=>{const N=d.category||"Layanan Umum";c.has(N)||c.set(N,[]),c.get(N).push(d)}),Array.from(c.entries()).sort(([d],[N])=>d.localeCompare(N)).map(([d,N])=>({categoryName:d,services:N}))},[t]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Layanan"}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(et,{size:20}),"Tambah Layanan"]})]}),g.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6 text-center text-gray-500 dark:text-gray-400",children:"Belum ada layanan. Silakan tambah layanan baru."}):e.jsx("div",{className:"space-y-8",children:g.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:c.categoryName}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:c.services.map(d=>{const N=Number(d.price)||0;return e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-full bg-primary/10 items-center justify-center text-primary text-sm font-bold uppercase",children:d.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rp",N.toLocaleString("id-ID")," /"," ",d.unit_price]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(d,c.categoryName),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit Layanan",children:e.jsx(Ie,{size:18})}),e.jsx("button",{onClick:()=>s({serviceId:d.id,serviceName:d.name,categoryName:c.categoryName}),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus Layanan",children:e.jsx(Qe,{size:18})})]})]},d.id)})})]},c.categoryName))})]})},Ct=({users:t,onAddTechnician:r,onEditTechnician:x,onRequestDelete:s})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Tim/User"}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(st,{size:20}),"Tambah User Baru"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl",children:[e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:t.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:g.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:g.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",g.username," • ",g.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(g),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit User",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>s(g),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus User",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]},g.id))}),t.length===0&&e.jsx("p",{className:"text-center py-10 text-gray-500",children:"Belum ada data user."})]})]}),Dt=["Confirmed","On Site","In Progress","Completed","Cancelled"],$t=()=>{const[t,r]=n.useState([]),[x,s]=n.useState([]),[g,c]=n.useState([]),[d,N]=n.useState([]),[S,I]=n.useState([]),[y,C]=n.useState("kpi"),[$,v]=n.useState(null),[A,P]=n.useState(1),[j,i]=n.useState(""),[T,O]=n.useState("all"),[L,w]=n.useState("all"),[h,M]=n.useState(!1),{addNotification:m}=Ba(),{logout:B,currentUser:U}=_a(),Y=5,[G,V]=n.useState(new Set),[K,J]=n.useState(new Set),[W,re]=n.useState(new Set),[X,ie]=n.useState(new Set),[Q,xe]=n.useState(null),[fe,ke]=n.useState(!1),[je,u]=n.useState(!1),[D,R]=n.useState(null),[H,q]=n.useState(!1),[ee,Oe]=n.useState(null),[Ze,Pe]=n.useState(null),[he,ve]=n.useState(null),[ea,de]=n.useState(!1),[Ne,Ue]=n.useState(null),[ae,ge]=n.useState(null),[aa,we]=n.useState(!1),[oe,Le]=n.useState({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""}),[pe,ta]=n.useState(new Date),[ce,Fe]=n.useState([]),[sa,Ee]=n.useState(!1),[ra,He]=n.useState(null),Se=Y,[Ce,De]=n.useState({}),na=n.useMemo(()=>Ve(9,17,12,13,30),[]),ne=n.useMemo(()=>g.filter(a=>a.role==="technician"),[g]),me=n.useCallback(async()=>{try{const a=await Ua();r(a)}catch(a){console.error("Gagal memuat data booking dari server",a),r([])}try{const a=await Xe();s(a)}catch(a){console.error("Gagal memuat data layanan dari server",a),s([])}try{const a=await La();c(a)}catch(a){console.error("Gagal memuat data user dari server",a),c([])}try{const a=await Fa();N(a)}catch(a){console.error("Gagal memuat data role dari server",a),N([])}try{const a=await Ea();I(a)}catch(a){console.error("Gagal memuat master kategori layanan dari server",a),I([])}try{const a=await Ha(),l=new Set(a.fullyBookedDates||[]),o=new Set(a.bookedSlots||[]);V(l),re(l),J(o),ie(o)}catch(a){console.error("Gagal memuat availability dari server",a),V(new Set),re(new Set),J(new Set),ie(new Set)}},[]),Re=n.useCallback(async a=>{try{Ee(!0),He(null);const l=await Ra(a);Fe(l)}catch(l){console.error("Error loadTechSchedule:",l),Fe([]),He((l==null?void 0:l.message)||"Gagal memuat jadwal teknisi")}finally{Ee(!1)}},[]);n.useEffect(()=>(me(),window.addEventListener("focus",me),()=>{window.removeEventListener("focus",me)}),[me]),n.useEffect(()=>{De(a=>{const l={...a};return t.forEach(o=>{l[o.id]||(l[o.id]=o.status)}),l})},[t]),n.useEffect(()=>{const a=JSON.stringify(Array.from(G).sort())!==JSON.stringify(Array.from(W).sort()),l=JSON.stringify(Array.from(K).sort())!==JSON.stringify(Array.from(X).sort());ke(a||l)},[W,X,G,K]),n.useEffect(()=>{y==="schedule"&&pe&&Re(pe)},[y,pe,Re]);const Ae=n.useMemo(()=>t.filter(a=>{const l=(j||"").toLowerCase(),f=((a==null?void 0:a.name)||"").toLowerCase().includes(l),k=T==="all"||a.status===T,_=L==="all"||a.technician===L;return f&&k&&_}).sort((a,l)=>l.id-a.id),[t,j,T,L]),la=n.useMemo(()=>{const a=(A-1)*Se;return Ae.slice(a,a+Se)},[Ae,A]),ze=Math.ceil(Ae.length/Se),ia=a=>{P(Math.max(1,Math.min(a,ze)))};n.useEffect(()=>{P(1)},[j,T,L]);const le=n.useMemo(()=>t.filter(a=>a.status==="Confirmed"||a.status==="On Site").sort((a,l)=>new Date(a.startDate).getTime()-new Date(l.startDate).getTime()),[t]);n.useEffect(()=>{y==="map"&&le.length>0&&!D?R({lat:le[0].lat,lng:le[0].lng,title:le[0].name}):y!=="map"&&R(null)},[y,le,D]);const da=async(a,l,o)=>{if(l!=="technician")return;const f=t.find(p=>p.id===a);if(!f)return;const k=o==="unassigned"?null:Number(o);if(o!=="unassigned"&&(!Number.isFinite(k)||k<=0)){m("Teknisi tidak valid (user_id harus angka).","error");return}const _=k==null?null:g.find(p=>p.id===k),b=(_==null?void 0:_.name)??"Belum Ditugaskan";try{if(!f.formId){m("form_id tidak ditemukan untuk booking ini.","error");return}await We(f.formId,f.status,k);const p=t.map(F=>F.id===a?{...F,technician:b,technicianUserId:k}:F);r(p),m(`Teknisi untuk ${f.name} berhasil diubah.`,"success")}catch(p){console.error(p),m((p==null?void 0:p.message)||"Gagal mengubah teknisi di server.","error")}},oa=a=>{const l=t.find(_=>_.id===a);if(!l)return;const o=Ce[a]??l.status;if(o===l.status){m("Status belum berubah, tidak ada yang perlu diupdate.","info");return}let f="Ubah Status Booking?",k=`Apakah Anda yakin ingin mengubah status pesanan untuk ${l.name} dari "${l.status}" menjadi "${o}"?`;o==="Completed"?(f="Selesaikan Pesanan?",k=`Apakah Anda yakin ingin menyelesaikan pesanan untuk ${l.name}?`):o==="Cancelled"&&(f="Batalkan Pesanan?",k=`Apakah Anda yakin ingin membatalkan pesanan untuk ${l.name}? Tindakan ini tidak dapat diurungkan.`),Le({isOpen:!0,bookingId:a,field:"status",value:o,title:f,message:k})},te=()=>{Le({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""})},ca=async()=>{const{bookingId:a,field:l,value:o}=oe;if(!a||!l){te();return}if(l==="status"){const f=t.find(b=>b.id===a);if(!f){te();return}const k=o??Ce[a]??f.status,_=f.technicianUserId??null;try{if(!f.formId){m("form_id tidak ditemukan untuk booking ini.","error"),te();return}if(!_){m("Teknisi belum dipilih. Pilih teknisi dulu.","error"),te();return}await We(f.formId,k,_);const b=g.find(F=>Number(F.id)===Number(_)),p=t.map(F=>F.id===a?{...F,status:k,technicianUserId:_,technician:(b==null?void 0:b.name)??"Belum Ditugaskan"}:F);r(p),De(F=>({...F,[a]:k})),m(`Booking ${f.name} berhasil diupdate.`,"success")}catch(b){console.error(b),m((b==null?void 0:b.message)||"Gagal mengubah status/teknisi di server.","error")}finally{te()}return}te()},ma=()=>{if(!Q)return;const a=E(Q),l=new Set(W);l.has(a)?l.delete(a):l.add(a),re(l)},ua=a=>{if(!Q)return;const l=`${E(Q)}-${a}`,o=new Set(X);o.has(l)?o.delete(l):o.add(l),ie(o)},xa=async()=>{try{await Ya({fullyBookedDates:Array.from(W),bookedSlots:Array.from(X)}),V(new Set(W)),J(new Set(X)),u(!0),setTimeout(()=>u(!1),3e3),m("Availability berhasil disimpan ke server.","success")}catch(a){console.error(a),m((a==null?void 0:a.message)||"Gagal menyimpan availability ke server.","error")}},ha=a=>{const l=new Set(W);l.delete(a),re(l)},ga=()=>{Oe(null),Pe(null),q(!0)},pa=(a,l)=>{Oe(a),Pe(l),q(!0)},ba=(a,l)=>{const o=!!ee,f=l&&!Number.isNaN(Number(l))?Number(l):a.service_category,k=S.find(p=>p.id===f),_={...a,service_category:f,category:(k==null?void 0:k.name)??a.category},b=p=>{s(F=>{let se=[...F];o&&ee&&(se=se.filter(Me=>Me.id!==ee.id));const ue=se.findIndex(Me=>Me.id===p.id);return ue>-1?se[ue]=p:se.push(p),se})};(async()=>{try{if(o){const p=ee==null?void 0:ee.id;if(!p){m("ID layanan tidak ditemukan dari API.","error");return}await Ka(p,_),b({..._,id:p})}else{const p=await Wa(_,_.category,S),F=x.length>0?Math.max(...x.map(ue=>ue.id?Number(ue.id):0))+1:1;b({..._,id:p??F})}q(!1),m(`Layanan "${a.name}" berhasil ${o?"diperbarui":"disimpan ke server"}.`,"success")}catch(p){console.error(p),m("Gagal menyimpan layanan ke server.","error")}})()},ya=async()=>{if(!he)return;const{serviceId:a,serviceName:l}=he;try{await Ja(a),s(o=>o.filter(f=>f.id!==a)),ve(null),m(`Layanan "${l}" telah dihapus.`,"success")}catch(o){console.error(o),m(`Gagal menghapus layanan "${l}" di server.`,"error")}},fa=()=>{Ue(null),de(!0)},ka=a=>{Ue(a),de(!0)},ja=async a=>{var o;const l=d.find(f=>f.name===a.role);if(!l){m("Role user tidak valid. Silakan refresh halaman.","error");return}if(Ne){const f=g.map(k=>k.id===Ne.id?{...k,...a,password:a.password||k.password}:k);c(f),de(!1),m(`User "${a.name}" berhasil diperbarui.`,"success")}else try{const f=await fetch("https://api-homeservice.viniela.id/api/v1/admin/user-management-store",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fullname:a.name,username:a.username,password:a.password,role_id:l.id})});if(!f.ok)throw new Error(`Gagal menyimpan user: ${f.status}`);const k=await f.json(),b={id:(k==null?void 0:k.data)&&k.data.id||k.id||(g.length>0?Math.max(...g.map(p=>p.id))+1:1),name:a.name,username:a.username,role:a.role||l.name,created_at:(o=k==null?void 0:k.data)==null?void 0:o.created_at};c(p=>[...p,b]),de(!1),m(`User "${b.name}" berhasil disimpan ke server.`,"success")}catch(f){console.error("Error saat menyimpan user baru:",f),m("Gagal menyimpan user ke server. Silakan cek koneksi atau coba lagi.","error")}},va=async()=>{if(!ae)return;const a=U==null?void 0:U.id;if(a&&ae.id===a){m("Tidak bisa menghapus akun yang sedang login.","error"),ge(null);return}try{await qa(ae.id),c(l=>l.filter(o=>o.id!==ae.id)),m(`User "${ae.name}" telah dihapus.`,"success")}catch(l){console.error(l),m((l==null?void 0:l.message)||"Gagal menghapus user di server.","error")}finally{ge(null)}},Na=async a=>{try{const l=a.status||"Confirmed",o=Ke[l]||Ke.Confirmed,f={...a,status:o};await Ga(f),m(`Booking baru untuk ${a.fullname} berhasil disimpan.`,"success"),await me(),we(!1)}catch(l){console.error(l),m(`Gagal menyimpan booking: ${(l==null?void 0:l.message)||"Unknown error"}`,"error")}},wa=n.useMemo(()=>{const a={};ne.forEach(b=>a[b.name]={completed:0,totalMinutes:0}),t.forEach(b=>{b.technician!=="Belum Ditugaskan"&&b.status==="Completed"&&(a[b.technician]||(a[b.technician]={completed:0,totalMinutes:0}),a[b.technician].completed+=1,a[b.technician].totalMinutes+=b.workDurationMinutes||0)});const l=Object.entries(a).map(([b,p])=>({name:b,...p})),o=t.reduce((b,p)=>(p.status==="Completed"&&(b[p.service]=(b[p.service]||0)+1),b),{}),f=Object.entries(o).sort(([,b],[,p])=>p-b).slice(0,5).map(([b,p])=>({label:b,value:p})),k=t.reduce((b,p)=>(b[p.status]=(b[p.status]||0)+1,b),{}),_=Object.entries(k).map(([b,p])=>({label:b,value:p}));return{technicianPerformance:l,popularServices:f,statusDistribution:_}},[t,ne]),Sa=n.useMemo(()=>{const a=[];return ce.forEach(l=>{l.schedules.forEach(o=>{const f=o.schedule_date,k=o.schedule_date;a.push({id:o.apply_id,formId:o.form_id,applyId:o.apply_id,name:o.fullname,whatsapp:o.wa,service:o.service,address:o.address,startDate:f,endDate:k,time:o.schedule_time,technician:l.fullname,technicianUserId:l.user_id,status:za(o.status),lat:0,lng:0,arrival_time:o.arrival_time,start_time:o.start_time,end_time:o.end_time,work_duration_minutes:o.work_duration_minutes,additional_cost:o.additional_cost,note:o.note,photos:{arrival:void 0,before:void 0,after:void 0}})})}),a},[ce]),Ca=n.useMemo(()=>ce.length>0?ce.map(a=>({id:a.user_id,name:a.fullname,username:"",role:"technician"})):ne,[ce,ne]),Da=n.useMemo(()=>{const a=S.map(o=>o.name);if(a.length>0)return a;const l=x.map(o=>o.category);return Array.from(new Set(l))},[S,x]),Aa={kpi:"Dashboard KPI",bookings:"Daftar Booking",schedule:"Jadwal Teknisi",map:"Peta Lokasi Tugas",technicians:"Manajemen Tim/User",services:"Manajemen Layanan",availability:"Atur Ketersediaan Jadwal"},Ma=()=>{switch(y){case"bookings":return e.jsx(mt,{paginatedBookings:la,currentPage:A,totalPages:ze,goToPage:ia,searchTerm:j,setSearchTerm:i,statusFilter:T,setStatusFilter:O,technicianFilter:L,setTechnicianFilter:w,technicians:ne,statuses:Dt,expandedBookingId:$,setExpandedBookingId:v,statusDraft:Ce,setStatusDraft:De,onStatusSubmit:oa,onTechnicianChange:da});case"schedule":return e.jsx(wt,{scheduleDate:pe,onScheduleDateChange:ta,isLoading:sa,error:ra,bookings:Sa,technicians:Ca});case"map":return e.jsx(jt,{upcomingJobs:le,selectedLocation:D,onSelectLocation:R});case"technicians":return e.jsx(Ct,{users:g,onAddTechnician:fa,onEditTechnician:ka,onRequestDelete:ge});case"services":return e.jsx(St,{services:x,onAddService:ga,onEditService:pa,onRequestDelete:ve});case"availability":return e.jsx(pt,{availableTimes:na,selectedDate:Q,onSelectedDateChange:xe,draftFullyBooked:W,draftBookedSlots:X,onToggleFullDay:ma,onToggleSlot:ua,onRemoveBlockedDate:ha,hasUnsavedChanges:fe,showSaveSuccess:je,onSaveChanges:xa});case"kpi":return e.jsx(kt,{kpiData:wa});default:return null}};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx(ht,{activeSection:y,onSectionChange:a=>{C(a),M(!1)},isOpen:h,onClose:()=>M(!1),onLogout:B}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(ut,{currentUserName:U==null?void 0:U.name,onOpenSidebar:()=>M(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white",children:Aa[y]}),y==="bookings"&&e.jsx("button",{onClick:()=>we(!0),className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:"Tambah Booking"})]}),Ma()]})]})]}),h&&e.jsx("div",{onClick:()=>M(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"}),e.jsx(nt,{isOpen:aa,onClose:()=>we(!1),onSave:Na,services:x,technicians:ne,availability:{fullyBookedDates:Array.from(G),bookedSlots:Array.from(K)}}),e.jsx(dt,{isOpen:H,onClose:()=>q(!1),onSave:ba,serviceToEdit:ee,categoryToEdit:Ze,allCategories:Da,serviceCategories:S}),e.jsx(gt,{isOpen:ea,onClose:()=>de(!1),onSave:ja,technicianToEdit:Ne,existingUsernames:g.map(a=>a.username),roles:d}),e.jsx(Be,{isOpen:oe.isOpen,onClose:te,onConfirm:ca,title:oe.title,confirmText:"Ya, Lanjutkan",confirmButtonClass:oe.value==="Cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary-dark focus:ring-primary",children:e.jsx("p",{children:oe.message})}),he&&e.jsx(Be,{isOpen:!0,onClose:()=>ve(null),onConfirm:ya,title:"Hapus Layanan?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus layanan"," ",e.jsxs("span",{className:"font-bold",children:['"',he.serviceName,'"']}),"? Tindakan ini tidak dapat diurungkan."]})}),ae&&e.jsx(Be,{isOpen:!0,onClose:()=>ge(null),onConfirm:va,title:"Hapus User?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus user"," ",e.jsxs("span",{className:"font-bold",children:['"',ae.name,'"']}),"? Tindakan ini tidak dapat diurungkan."]})})]})};export{$t as default};
