import{T as r,F as Ha,c as qa,M as e,N as ra,R as Ze,g as W,_ as Ra}from"./index-DG-X5MhE.js";import{k as la,S as H,_ as Ue}from"./storage-Cnls39ez-BBYBvF2Y.js";import{O as Ge}from"./Calendar-BOLuvjCe-B3xBvF4T.js";import{f as pe,u as Ka,p as Ja,h as Wa,g as Va}from"./GenericConfirmationModal-VeCxLLv1-DvtuwBiU.js";import{I as Ya,D as na,A as Qa,O as Xa,N as Za,R as et,P as at,v as tt,S as ea,j as st,F as rt,B as lt,k as nt,$ as it,U as aa,J as dt,E as ot,T as ct,w as mt}from"./admin-D_k_XYxw-DVuoVK0-.js";import{c as He}from"./trash-2-BqYj59hA-C2-lXu8e.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=W("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const xt=W("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const gt=W("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ht=W("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ia=W("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const pt=W("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const bt=W("PencilLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ta=W("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $e=W("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const yt=W("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const kt=W("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Z={lat:-6.175392,lng:106.827153,mapSrc:"https://maps.google.com/maps?q=-6.175392,106.827153&z=16&output=embed"},ft=({isOpen:t,onClose:l,onSave:u,services:s,technicians:x,availability:c})=>{const[i,w]=r.useState({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),[k,D]=r.useState({lat:Z.lat,lng:Z.lng}),[f,C]=r.useState({}),[N,p]=r.useState(Z.mapSrc),S=c||{fullyBookedDates:[],bookedSlots:[]},M=r.useMemo(()=>new Set(S.fullyBookedDates||[]),[S.fullyBookedDates]),A=r.useMemo(()=>new Set(S.bookedSlots||[]),[S.bookedSlots]),v=r.useMemo(()=>la(9,17,12,13,30),[]);r.useEffect(()=>{t&&(w({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),C({}),D({lat:Z.lat,lng:Z.lng}),p(Z.mapSrc))},[t]);const _=h=>{const{name:E,value:b}=h.target;C(L=>({...L,[E]:void 0})),w(L=>({...L,[E]:b}))},$=h=>{const E=new Date(h);E.setDate(E.getDate()),w(b=>({...b,startDate:h,endDate:E,time:""})),C(b=>({...b,startDate:void 0,time:void 0}))},o=()=>{const h={};return i.name.trim()||(h.name="Nama wajib diisi."),i.whatsapp.trim()||(h.whatsapp="Nomor WhatsApp wajib diisi."),i.address.trim()||(h.address="Alamat wajib diisi."),i.service||(h.service="Layanan wajib dipilih."),i.startDate||(h.startDate="Tanggal wajib dipilih."),i.time||(h.time="Waktu wajib dipilih."),C(h),Object.keys(h).length===0},F=h=>{if(h.preventDefault(),!o()||!i.startDate)return;const E=i.startDate.toISOString().slice(0,10),b=Number(i.service),L=i.technician&&i.technician!==""?Number(i.technician):null,U={fullname:i.name,whatsapp:i.whatsapp,address:i.address,service:b,user_id:L,status:i.status,lat:k.lat,lng:k.lng,schedule_date:E,schedule_time:i.time};u(U)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-5xl transform transition-all",onClick:h=>h.stopPropagation(),children:e.jsxs("form",{onSubmit:F,noValidate:!0,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Tambah Booking Manual"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(ra,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Pelanggan"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",name:"whatsapp",value:i.whatsapp,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.whatsapp&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.whatsapp})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alamat Lengkap"}),e.jsx("textarea",{name:"address",rows:2,value:i.address,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.address&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Layanan"}),e.jsxs("select",{name:"service",value:i.service,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih Layanan --"}),s.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),f.service&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.service})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Teknisi"}),e.jsxs("select",{name:"technician",value:i.technician,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Belum Ditugaskan"}),x.map(h=>e.jsx("option",{value:h.id,children:h.name||h.fullname||h.username},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status Awal"}),e.jsx("select",{name:"status",value:i.status,onChange:_,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:["Confirmed","On Site","In Progress","Completed","Cancelled"].map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Jadwal"}),e.jsx(Ge,{selectedDate:i.startDate,onDateSelect:$,fullyBookedDates:M}),f.startDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.startDate})]}),i.startDate?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(h=>{const E=`${H(i.startDate)}-${h}`,b=A.has(E);return e.jsx("button",{type:"button",onClick:()=>w(L=>({...L,time:h})),disabled:b,className:`p-2 rounded-md text-sm font-semibold border-2 transition-colors ${i.time===h?"bg-primary text-white border-primary":"bg-transparent border-gray-300 dark:border-slate-600"} ${b?"bg-gray-200 dark:bg-slate-600 text-gray-400 dark:text-gray-500 line-through cursor-not-allowed":"hover:border-primary"}`,children:h},h)})}),f.time&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.time})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"h-48 flex items-center justify-center bg-gray-50 dark:bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Pilih tanggal dahulu"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lokasi (sementara default: Monas, Jakarta)"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Untuk sekarang, lokasi booking akan tersimpan di sekitar Monas (lat: ",Z.lat,", lng: ",Z.lng,")."]}),e.jsx("div",{className:"mt-2 h-64 w-full rounded-lg overflow-hidden border dark:border-slate-600",children:e.jsx("iframe",{title:"Booking Location Default Monas",width:"100%",height:"100%",style:{border:0},src:N,allowFullScreen:!1,loading:"lazy"},N)})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-500",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan Booking"})]})]})})}):null},vt=({booking:t})=>{const l=s=>s.startsWith("0")?`62${s.substring(1)}`:s,u=()=>{const s=l(t.whatsapp),x=new Date(t.startDate).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),c=`Halo ${t.name}, kami dari Viniela Home & Service ingin mengkonfirmasi pesanan Anda:

*Layanan:* ${t.service}
*Jadwal:* ${x}, pukul ${t.time}
*Alamat:* ${t.address}

Mohon balas pesan ini untuk mengkonfirmasi detail di atas sudah benar. Terima kasih.`;return`https://wa.me/${s}?text=${encodeURIComponent(c)}`};return e.jsxs("a",{href:u(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-green-600 transition-colors",title:`Chat ${t.name} di WhatsApp`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.459l-6.354 1.654zm.791-6.938c.323.517.76 1.002 1.251 1.431.987.842 2.197 1.298 3.51 1.298 5.421 0 9.811-4.39 9.811-9.811 0-2.651-1.04-5.14-2.9-7.001-1.859-1.86-4.35-2.901-7.001-2.901-5.42 0-9.81 4.39-9.81 9.81 0 2.05.61 3.992 1.698 5.688l-.299 1.093zM9.262 7.176c-.23-.487-.474-.487-.698-.487-.203 0-.428.02-.638.211-.23.19-.813.78-.813 1.901 0 1.12.831 2.201.946 2.36.116.161 1.638 2.542 4.004 3.53.585.24 1.045.38 1.41.496.535.169.97.143 1.324-.087.419-.27.813-.981.928-1.342.116-.361.116-.671.083-.758-.032-.087-.23-.142-.487-.27-.257-.128-1.515-.748-1.758-.831-.243-.083-.419-.083-.595.083-.176.166-.66.831-.813.981-.152.152-.291.178-.487.05-.196-.128-.831-.289-1.587-.961-.595-.541-.97-1.221-1.085-1.428-.116-.208-.017-.323.07-.43.087-.107.196-.178.291-.269.1-.096.143-.15.211-.243.068-.092.032-.178-.017-.258-.05-.082-.464-1.113-.638-1.515z"})}),"Chat"]})};function Ce(t){if(!t)return"-";if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);const u=new Date(t);return Number.isNaN(u.getTime())?t:u.toISOString().slice(0,10)}const l=t;return Number.isNaN(l.getTime())?"-":l.toISOString().slice(0,10)}function ze(t){if(!t)return"-";const l=typeof t=="string"?new Date(t):t;if(Number.isNaN(l.getTime()))return"-";const u=String(l.getHours()).padStart(2,"0"),s=String(l.getMinutes()).padStart(2,"0");return`${u}:${s}`}function jt(t){return t==null||Number.isNaN(t)?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(t)}const Nt="https://api-homeservice.viniela.id",wt=t=>t.startsWith("http")?t:`${Nt}${t}`,St=({paginatedBookings:t,currentPage:l,totalPages:u,goToPage:s,searchTerm:x,setSearchTerm:c,statusFilter:i,setStatusFilter:w,technicianFilter:k,setTechnicianFilter:D,technicians:f,statuses:C,expandedBookingId:N,setExpandedBookingId:p,statusDraft:S,onTechnicianChange:M})=>{const[A,v]=r.useState(null),_=o=>{p(N===o?null:o)},$=()=>v(null);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[e.jsx("input",{value:x,onChange:o=>c(o.target.value),placeholder:"Cari nama pelanggan...",className:"w-full md:w-1/3 rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:i,onChange:o=>w(o.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Status"}),C.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsxs("select",{value:k,onChange:o=>D(o.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Teknisi"}),e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),f.map(o=>e.jsx("option",{value:String(o.id),children:o.name},o.id))]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700 text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Layanan"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jadwal"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Teknisi"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[t.map(o=>{var F,h,E;const b=Ce(o.startDate),L=N===o.id,U=[(F=o.photos)==null?void 0:F.arrival,(h=o.photos)==null?void 0:h.before,(E=o.photos)==null?void 0:E.after].filter(Boolean);return e.jsxs(Ra.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500",children:o.whatsapp})]}),e.jsx("td",{className:"px-4 py-3",children:o.service}),e.jsxs("td",{className:"px-4 py-3",children:[b," • ",o.time]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.technicianUserId==null?"unassigned":String(o.technicianUserId),onChange:O=>M(o.id,"technician",O.target.value),className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs",children:[e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),f.map(O=>e.jsx("option",{value:String(O.id),children:O.name},O.id))]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("select",{value:S[o.id]??o.status,disabled:!0,className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs opacity-70 cursor-not-allowed",children:C.map(O=>e.jsx("option",{value:O,children:O},O))})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(vt,{booking:o}),e.jsx("button",{type:"button",onClick:()=>_(o.id),className:"inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700","aria-label":L?"Tutup detail":"Buka detail",title:L?"Tutup detail":"Buka detail",children:L?e.jsx(ht,{size:18}):e.jsx(gt,{size:18})})]})})]}),L&&e.jsx("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:e.jsx("td",{colSpan:6,className:"px-4 py-4 bg-gray-50/60 dark:bg-slate-900/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Detail Pelanggan"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Nama"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"WhatsApp"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.whatsapp||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Alamat"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.address||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Laporan Kerja"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Tiba"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.arrival_time?`${Ce(o.arrival_time)} ${ze(o.arrival_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Mulai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.start_time?`${Ce(o.start_time)} ${ze(o.start_time)}`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Selesai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.end_time?`${Ce(o.end_time)} ${ze(o.end_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Durasi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.work_duration_minutes!=null?`${o.work_duration_minutes} mnt`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Biaya Tambahan"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:jt(o.additional_cost??0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Teknisi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.technician||"Belum Ditugaskan"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Catatan"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.note||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Bukti Foto"}),U.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map((O,K)=>{const V=wt(O);return e.jsx("button",{type:"button",onClick:()=>v(V),className:"block",title:"Klik untuk preview",children:e.jsx("img",{src:V,alt:`Bukti foto ${K+1}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200 dark:border-slate-600 hover:opacity-90",loading:"lazy"})},`${o.id}-photo-${K}`)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Belum ada foto."})]})]})})})]},o.id)}),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada data booking."})})]})]})}),u>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(l-1),disabled:l===1,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Prev"}),e.jsxs("span",{className:"text-xs py-1",children:["Halaman ",l," dari ",u]}),e.jsx("button",{onClick:()=>s(l+1),disabled:l===u,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Next"})]}),A&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4",onClick:$,children:e.jsxs("div",{className:"relative max-w-5xl w-full",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:$,className:"absolute -top-3 -right-3 w-10 h-10 rounded-full bg-white text-gray-900 shadow flex items-center justify-center","aria-label":"Tutup",title:"Tutup",children:"✕"}),e.jsx("img",{src:A,alt:"Preview",className:"w-full max-h-[85vh] object-contain rounded-xl bg-black"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("a",{href:A,target:"_blank",rel:"noreferrer",className:"px-3 py-2 text-sm rounded-lg bg-white/90 hover:bg-white",children:"Buka tab baru"}),e.jsx("a",{href:A,download:!0,className:"px-3 py-2 text-sm rounded-lg bg-white/90 hover:bg-white",children:"Download"})]})]})})]})},Ct=({currentUserName:t,onOpenSidebar:l})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:l,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),Dt=[{name:"Dashboard KPI",icon:xt,section:"kpi"},{name:"Daftar Booking",icon:Ka,section:"bookings"},{name:"Jadwal Teknisi",icon:ut,section:"schedule"},{name:"Peta Lokasi",icon:Ja,section:"map"},{name:"Manajemen Tim/User",icon:kt,section:"technicians"},{name:"Manajemen Layanan",icon:$e,section:"services"},{name:"Atur Ketersediaan",icon:$e,section:"availability"}],$t=({activeSection:t,onSectionChange:l,isOpen:u,onClose:s,onLogout:x})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${u?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Admin Viniela"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:Dt.map(c=>e.jsxs("button",{onClick:()=>{l(c.section),s()},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${t===c.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(c.icon,{size:20}),c.name]},c.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:x,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(Wa,{size:20}),"Logout"]})})]}),Tt=({isOpen:t,onClose:l,onSave:u,technicianToEdit:s,existingUsernames:x,roles:c})=>{const[i,w]=r.useState({}),[k,D]=r.useState({});r.useEffect(()=>{var p,S;if(t){const M=(s==null?void 0:s.role)||((p=c.find(A=>A.name==="technician"))==null?void 0:p.name)||((S=c[0])==null?void 0:S.name)||"";w(s?{...s,password:""}:{name:"",username:"",role:M,password:""}),D({})}},[t,s,c]);const f=p=>{const{name:S,value:M}=p.target;w(A=>({...A,[S]:M})),k[S]&&D(A=>({...A,[S]:""}))},C=()=>{var p,S,M,A;const v={};return(p=i.name)!=null&&p.trim()||(v.name="Nama wajib diisi."),(S=i.username)!=null&&S.trim()||(v.username="Username wajib diisi."),(M=i.role)!=null&&M.trim()||(v.role="Peran wajib diisi."),s||((A=i.password)!=null&&A.trim()||(v.password="Password wajib diisi untuk user baru."),x.includes(i.username.trim())&&(v.username="Username sudah digunakan.")),D(v),Object.keys(v).length===0},N=p=>{p.preventDefault(),C()&&u({...i})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg transform transition-all",onClick:p=>p.stopPropagation(),children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:s?"Edit User":"Tambah User Baru"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(ra,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Lengkap"}),e.jsx("input",{type:"text",name:"name",value:i.name||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),k.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:k.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:i.username||"",onChange:f,readOnly:!!s,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary read-only:bg-gray-100 dark:read-only:bg-slate-600"}),k.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:k.username})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role User"}),e.jsxs("select",{name:"role",value:i.role||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Pilih role"}),c.map(p=>e.jsx("option",{value:p.name,children:p.name},p.id))]}),k.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:k.role})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:i.password||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),k.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:k.password}),s&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Kosongkan jika tidak ingin mengubah password."})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-5 00",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan"})]})]})})}):null},Mt=({availableTimes:t,selectedDate:l,onSelectedDateChange:u,draftFullyBooked:s,draftBookedSlots:x,onToggleFullDay:c,onToggleSlot:i,onRemoveBlockedDate:w,hasUnsavedChanges:k,showSaveSuccess:D,onSaveChanges:f})=>e.jsxs("div",{children:[e.jsxs("div",{className:"sticky top-4 lg:top-20 z-10 flex justify-end items-center mb-4 p-3 bg-light-bg/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-lg",children:[D&&e.jsx("span",{className:"text-green-600 font-semibold mr-4",children:"Perubahan berhasil disimpan!"}),e.jsx("button",{onClick:f,disabled:!k,className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Simpan Perubahan"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk mengatur slot waktu atau memblokir sepanjang hari."}),e.jsx(Ge,{selectedDate:l,onDateSelect:C=>u(C),fullyBookedDates:s})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-1 xl:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Atur Slot Waktu"}),l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"font-semibold text-lg text-secondary dark:text-slate-300",children:l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("button",{onClick:c,className:`px-3 py-1.5 text-xs font-bold rounded-full ${s.has(H(l))?"bg-red-100 text-red-700":"bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-200"}`,children:s.has(H(l))?"Buka Blokir Hari Ini":"Blokir Seharian"})]}),e.jsx("div",{className:`grid grid-cols-3 sm:grid-cols-4 gap-3 ${s.has(H(l))?"opacity-40 pointer-events-none":""}`,children:t.map(C=>{const N=`${H(l)}-${C}`,p=x.has(N);return e.jsx("button",{onClick:()=>i(C),className:`text-center font-semibold px-4 py-2.5 rounded-lg border-2 transition-colors duration-200 ${p?"bg-red-500 border-red-500 text-white":"bg-white dark:bg-slate-700 border-gray-200 dark:border-gray-600 hover:border-primary"}`,children:C},C)})}),s.has(H(l))&&e.jsx("p",{className:"text-center mt-4 text-sm text-red-500 font-medium",children:"Semua slot tidak tersedia karena hari ini diblokir."})]}):e.jsx("div",{className:"text-center py-20 text-gray-500 dark:text-gray-400",children:"Pilih tanggal dari kalender untuk memulai."})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-2 xl:col-span-3 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Daftar Tanggal yang Diblokir Penuh"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Berikut adalah daftar tanggal yang telah Anda tandai sebagai penuh (tidak termasuk slot individual)."}),Array.from(s).length>0?e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:Array.from(s).sort((C,N)=>Ue(C).getTime()-Ue(N).getTime()).map(C=>e.jsxs("li",{className:"flex justify-between items-center bg-light-bg dark:bg-slate-700 p-3 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:Ue(C).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("button",{onClick:()=>w(C),className:"text-red-500 hover:text-red-700 text-sm font-bold",children:"Hapus"})]},C))}):e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada tanggal yang diblokir penuh."})]})]})]}),Bt=({data:t,title:l})=>{const u=Math.max(...t.map(x=>x.value),1),s=["#14B8A6","#2DD4BF","#5EEAD4","#99F6E4","#CCFBF1"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsx("div",{className:"space-y-3",children:t.map((x,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200 truncate pr-2",children:x.label}),e.jsx("span",{className:"font-bold text-primary",children:x.value})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-4 rounded-full",style:{width:`${x.value/u*100}%`,backgroundColor:s[c%s.length]},title:`${x.label}: ${x.value}`})})]},x.label))})]})},sa={Confirmed:"#3B82F6","On Site":"#06B6D4","In Progress":"#EAB308",Completed:"#22C55E",Cancelled:"#9CA3AF"},At=({data:t,title:l})=>{const u=t.reduce((c,i)=>c+i.value,0);if(u===0)return null;let s=0;const x=t.map(c=>{const i=sa[c.label]||"#CCCCCC",w=c.value/u*100,k=s;return s+=w,`${i} ${k}% ${s}%`});return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"w-40 h-40 rounded-full mx-auto",style:{background:`conic-gradient(${x.join(", ")})`}}),e.jsx("div",{className:"space-y-2",children:t.map(c=>{const i=sa[c.label]||"#9CA3AF";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:i}}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:c.label})]}),e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:c.value})]},c.label)})})]})]})},_t=t=>{if(!t)return"-";if(t<60)return`${t} mnt`;const l=Math.floor(t/60),u=t%60;return u===0?`${l} jam`:`${l} jam ${u} mnt`},Pt=({kpiData:t})=>{var l;const u=((l=t==null?void 0:t.popularServices)==null?void 0:l.length)??0,s=((t==null?void 0:t.popularServices)??[]).reduce((c,i)=>c+(Number(i.value)||0),0),x=u>0?`${u} Layanan Terlaris (Selesai) • Total ${s} selesai`:"Layanan Terlaris (Selesai)";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Bt,{data:t.popularServices,title:x}),e.jsx(At,{data:t.statusDistribution,title:"Distribusi Status Pesanan"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Performa Teknisi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.technicianPerformance.length>0?t.technicianPerformance.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white",children:c.name}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pekerjaan Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:c.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Waktu Kerja"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:_t(c.totalMinutes)})]})]})]},c.name)):e.jsx("p",{className:"col-span-full text-center py-10 text-gray-500 dark:text-gray-400",children:"Belum ada data KPI yang bisa ditampilkan."})})]})]})},Et=({upcomingJobs:t,selectedLocation:l,onSelectLocation:u})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white p-2 sticky top-0 bg-white dark:bg-slate-800 z-10",children:"Pekerjaan Akan Datang"}),t.length>0?t.map(s=>e.jsxs("button",{onClick:()=>u({lat:s.lat,lng:s.lng,title:s.name}),className:`w-full text-left p-4 rounded-lg transition-all duration-200 border-l-4 ${(l==null?void 0:l.title)===s.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent hover:bg-gray-50 dark:hover:bg-slate-700/50 border-transparent"}`,children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300",children:s.service}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:s.address}),e.jsxs("div",{className:"text-sm font-semibold text-primary mt-2",children:[new Date(s.startDate).toLocaleDateString("id-ID",{day:"numeric",month:"long"})," ","- ",s.time]})]},s.id)):e.jsx("p",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada pekerjaan akan datang."})]}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-slate-700 flex-shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:["Lokasi: ",l.title]}),e.jsxs("a",{href:`https://www.google.com/maps?q=${l.lat},${l.lng}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:["Buka di Google Maps ",e.jsx(pt,{size:14})]})]}),e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${l.lat},${l.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${l.lat}-${l.lng}`)]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(Va,{className:"mb-4 text-gray-300 dark:text-gray-600",size:48}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Pekerjaan"}),e.jsx("p",{children:"Pilih pekerjaan dari daftar untuk melihat lokasinya di peta."})]})})]}),Lt={Confirmed:"bg-blue-500 border-blue-700","On Site":"bg-cyan-500 border-cyan-700","In Progress":"bg-yellow-500 border-yellow-700",Completed:"bg-green-500 border-green-700",Cancelled:"bg-gray-400 border-gray-600"},It=({bookings:t,selectedDate:l,technicians:u})=>{const[s,x]=r.useState(()=>new Map),[c,i]=r.useState(!1),[w,k]=r.useState(null);r.useEffect(()=>{(async()=>{try{i(!0),k(null);const N=await na(),p=new Map;N.forEach(S=>{p.set(S.name,S)}),x(p)}catch(N){console.error("Gagal memuat services dari API:",N),k("Gagal memuat data layanan dari server.")}finally{i(!1)}})()},[]);const D=r.useMemo(()=>{const N=H(l);return t.filter(p=>{const S=H(new Date(p.startDate)),M=H(new Date(p.endDate));return N>=S&&N<=M&&p.status!=="Cancelled"})},[t,l]),f=Array.from({length:10},(N,p)=>8+p),C=N=>N>80?"bg-red-500":N>50?"bg-yellow-400":"bg-green-500";return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:["Jadwal Teknisi untuk"," ",l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})]}),c&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Memuat data layanan..."}),w&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 mb-2",children:w}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"flex border-b-2 border-gray-200 dark:border-slate-700 pb-2",children:[e.jsx("div",{className:"w-48 flex-shrink-0"}),e.jsx("div",{className:"flex-1 grid grid-cols-10",children:f.map(N=>e.jsxs("div",{className:"text-center text-xs font-semibold text-gray-500 dark:text-gray-400",children:[String(N).padStart(2,"0"),":00"]},N))})]}),u.map(N=>{const p=D.filter(v=>v.technician===N.name),S=p.reduce((v,_)=>{const $=s.get(_.service);if(!$)return v;const o=$.duration_days&&$.duration_days>1,F=H(new Date(_.startDate))===H(l);if(o&&!F)return v+540;const h=$.duration??60;return v+h},0),M=Math.min(S/540*100,100),A=C(M);return e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-slate-700/50",children:[e.jsxs("div",{className:"w-48 flex-shrink-0 py-3 px-2 border-r border-gray-100 dark:border-slate-700/50",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-700 dark:text-gray-200 truncate",children:N.name}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5",children:[e.jsx("span",{children:"Beban Kerja"}),e.jsxs("span",{children:[(S/60).toFixed(1)," /"," ",540/60," jam"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-slate-700",title:`${M.toFixed(0)}% terisi`,children:e.jsx("div",{className:`${A} h-2 rounded-full transition-all duration-500`,style:{width:`${M}%`}})})]})]}),e.jsxs("div",{className:"flex-1 h-20 relative",children:[f.map(v=>e.jsx("div",{className:"absolute h-full border-l border-gray-100 dark:border-slate-700/50",style:{left:`${(v-8)/10*100}%`}},`line-${v}`)),p.map(v=>{const _=s.get(v.service),$=v.startDate!==v.endDate,o=H(new Date(v.startDate))===H(l);let F,h;if($&&!o)F=0,h=600;else{const[U,O]=v.time.split(":").map(Number);F=(U-8)*60+(O||0),h=_?_.duration??60:60}const E=F/600*100,b=h/600*100;if(E<0||E>=100)return null;const L=Lt[v.status]||"bg-gray-500 border-gray-700";return e.jsxs("div",{className:`absolute top-2 h-16 ${L} rounded-lg p-2 text-white shadow-md overflow-hidden border-l-4`,style:{left:`${E}%`,width:`${b}%`},title:`${v.name} - ${v.service} @ ${v.time} [Status: ${v.status}]`,children:[e.jsx("p",{className:"text-xs font-bold truncate",children:v.name}),e.jsx("p",{className:"text-[10px] opacity-80 truncate",children:v.service})]},v.id)})]})]},N.id)})]})}),D.length===0&&!c&&e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal pekerjaan untuk tanggal ini."})]})},Ot=({scheduleDate:t,onScheduleDateChange:l,isLoading:u,error:s,bookings:x,technicians:c})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk melihat jadwal teknisi dari sistem backend."}),e.jsx(Ge,{selectedDate:t,onDateSelect:l,fullyBookedDates:new Set})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[u&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow rounded-xl p-3 text-sm text-gray-500 dark:text-gray-300",children:["Memuat jadwal teknisi untuk"," ",t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),"..."]}),s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl p-3",children:s}),e.jsx(It,{bookings:x,selectedDate:t,technicians:c})]})]})}),Ut=({services:t,onAddService:l,onEditService:u,onRequestDelete:s})=>{const x=r.useMemo(()=>{const c=new Map;return t.forEach(i=>{const w=i.category||"Layanan Umum";c.has(w)||c.set(w,[]),c.get(w).push(i)}),Array.from(c.entries()).sort(([i],[w])=>i.localeCompare(w)).map(([i,w])=>({categoryName:i,services:w}))},[t]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Layanan"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(ia,{size:20}),"Tambah Layanan"]})]}),x.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6 text-center text-gray-500 dark:text-gray-400",children:"Belum ada layanan. Silakan tambah layanan baru."}):e.jsx("div",{className:"space-y-8",children:x.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:c.categoryName}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:c.services.map(i=>{const w=Number(i.price)||0;return e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-full bg-primary/10 items-center justify-center text-primary text-sm font-bold uppercase",children:i.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rp",w.toLocaleString("id-ID")," /"," ",i.unit_price]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(i,c.categoryName),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit Layanan",children:e.jsx($e,{size:18})}),e.jsx("button",{onClick:()=>s({serviceId:i.id,serviceName:i.name,categoryName:c.categoryName}),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus Layanan",children:e.jsx(He,{size:18})})]})]},i.id)})})]},c.categoryName))})]})},zt=({users:t,onAddTechnician:l,onEditTechnician:u,onRequestDelete:s})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Tim/User"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(yt,{size:20}),"Tambah User Baru"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl",children:[e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:t.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:x.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:x.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",x.username," • ",x.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(x),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit User",children:e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>s(x),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus User",children:e.jsx(He,{className:"w-4 h-4"})})]})]},x.id))}),t.length===0&&e.jsx("p",{className:"text-center py-10 text-gray-500",children:"Belum ada data user."})]})]}),Ft=({categories:t,servicesCountByCategoryId:l={},onAdd:u,onEdit:s,onRequestDelete:x})=>{const[c,i]=r.useState(""),w=r.useMemo(()=>{const k=(c||"").toLowerCase();return[...t].filter(D=>(D.name||"").toLowerCase().includes(k)).sort((D,f)=>f.id-D.id)},[t,c]);return e.jsx("section",{className:"mb-6",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:"Master Kategori Layanan"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:"Tambah / edit / hapus kategori yang dipakai oleh layanan."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:c,onChange:k=>i(k.target.value),placeholder:"Cari kategori...",className:"w-full md:w-64 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-gray-800 dark:text-white outline-none focus:ring-2 focus:ring-primary"}),e.jsxs("button",{onClick:u,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(ia,{size:20}),"Tambah Kategori"]})]})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-gray-200 dark:border-slate-700",children:[e.jsx("th",{className:"py-2 pr-4 text-gray-600 dark:text-gray-300",children:"ID"}),e.jsx("th",{className:"py-2 pr-4 text-gray-600 dark:text-gray-300",children:"Nama"}),e.jsx("th",{className:"py-2 pr-4 text-gray-600 dark:text-gray-300",children:"Dipakai"}),e.jsx("th",{className:"py-2 pr-2 text-gray-600 dark:text-gray-300 text-right",children:"Aksi"})]})}),e.jsx("tbody",{children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-6 text-center text-gray-500 dark:text-gray-400",children:"Tidak ada kategori."})}):w.map(k=>{const D=l[k.id]??0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-700/60",children:[e.jsx("td",{className:"py-3 pr-4 text-gray-700 dark:text-gray-200",children:k.id}),e.jsx("td",{className:"py-3 pr-4 font-semibold text-gray-800 dark:text-white",children:k.name}),e.jsxs("td",{className:"py-3 pr-4 text-gray-700 dark:text-gray-200",children:[D," layanan"]}),e.jsx("td",{className:"py-3 pr-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>s(k),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",children:e.jsx($e,{size:18})}),e.jsx("button",{onClick:()=>x(k),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",children:e.jsx(He,{size:18})})]})})]},k.id)})})]})})]})})},Gt=({isOpen:t,onClose:l,onSave:u,categoryToEdit:s,existingNames:x=[]})=>{const[c,i]=r.useState(""),[w,k]=r.useState(null),D=!!s;r.useEffect(()=>{t&&(i((s==null?void 0:s.name)??""),k(null))},[t,s]);const f=r.useMemo(()=>new Set(x.map(p=>(p||"").trim().toLowerCase())),[x]),C=p=>{const S=(p||"").trim();if(!S)return"Nama kategori wajib diisi.";if(S.length<2)return"Nama kategori minimal 2 karakter.";const M=S.toLowerCase(),A=((s==null?void 0:s.name)||"").trim().toLowerCase();return f.has(M)&&(!D||D&&M!==A)?"Nama kategori sudah ada.":null},N=()=>{const p=C(c);k(p),!p&&u({name:(c||"").trim()})};return e.jsx(pe,{isOpen:t,onClose:l,onConfirm:N,title:D?"Edit Kategori Layanan":"Tambah Kategori Layanan",confirmText:D?"Simpan Perubahan":"Tambah",confirmButtonClass:"bg-primary hover:bg-primary-dark focus:ring-primary",children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("input",{value:c,onChange:p=>{i(p.target.value),w&&k(null)},placeholder:"Contoh: AC, Cleaning, Plumbing...",className:"w-full rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-gray-800 dark:text-white outline-none focus:ring-2 focus:ring-primary"}),w&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:w})]})})})};function Ht(t,l){r.useEffect(()=>{const u=s=>{t.current&&(t.current.contains(s.target)||l())};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[t,l])}function Fe({value:t,options:l,placeholder:u="Pilih...",searchPlaceholder:s="Cari...",emptyText:x="Tidak ada data.",disabled:c,required:i,onChange:w,className:k}){const D=r.useRef(null),f=r.useRef(null),[C,N]=r.useState(!1),[p,S]=r.useState("");Ht(D,()=>N(!1));const M=r.useMemo(()=>t===""||t==null?null:l.find($=>String($.value)===String(t))??null,[t,l]),A=r.useMemo(()=>{const $=(p||"").toLowerCase();return $?l.filter(o=>`${o.label} ${o.meta??""}`.toLowerCase().includes($)):l},[l,p]);r.useEffect(()=>{if(!C)return;const $=setTimeout(()=>{var o;return(o=f.current)==null?void 0:o.focus()},0);return()=>clearTimeout($)},[C]);const v=()=>{c||N($=>!$)},_=$=>{w($.value),N(!1),S("")};return e.jsxs("div",{ref:D,className:`relative ${k??""}`,children:[e.jsxs("button",{type:"button",onClick:v,disabled:c,className:["w-full rounded-lg border px-3 py-2 text-sm text-left","bg-white dark:bg-slate-900","border-slate-300 dark:border-slate-600","text-slate-900 dark:text-slate-100","focus:outline-none focus:ring-2 focus:ring-primary",c?"opacity-60 cursor-not-allowed":"hover:bg-slate-50 dark:hover:bg-slate-800"].join(" "),"aria-haspopup":"listbox","aria-expanded":C,children:[e.jsx("span",{className:M?"":"text-slate-400 dark:text-slate-400",children:M?M.label:u}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"▾"})]}),i&&e.jsx("input",{tabIndex:-1,autoComplete:"off",className:"sr-only",required:!0,value:t==null?"":String(t),onChange:()=>{}}),C&&e.jsxs("div",{className:"absolute z-50 mt-2 w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b border-slate-100 dark:border-slate-800",children:e.jsx("input",{ref:f,value:p,onChange:$=>S($.target.value),placeholder:s,className:"w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 outline-none focus:ring-2 focus:ring-primary"})}),e.jsx("div",{className:"max-h-64 overflow-auto",children:A.length===0?e.jsx("div",{className:"px-3 py-3 text-sm text-slate-500 dark:text-slate-400",children:x}):A.map($=>{const o=M&&String(M.value)===String($.value);return e.jsxs("button",{type:"button",onClick:()=>_($),className:["w-full text-left px-3 py-2 text-sm","hover:bg-slate-100 dark:hover:bg-slate-800",o?"bg-slate-100 dark:bg-slate-800 font-semibold":""].join(" "),role:"option","aria-selected":o,children:[e.jsx("div",{className:"text-slate-900 dark:text-slate-100",children:$.label}),$.meta?e.jsx("div",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:$.meta}):null]},String($.value))})})]})]})}function qt(t){const l={includes:[],excludes:[]};if(!t)return l;if(typeof t=="object")return{includes:Array.isArray(t.includes)?t.includes.map(String):[],excludes:Array.isArray(t.excludes)?t.excludes.map(String):[]};if(typeof t=="string"){const u=t.trim();if(!u)return l;try{const s=JSON.parse(u);return{includes:Array.isArray(s==null?void 0:s.includes)?s.includes.map(String):[],excludes:Array.isArray(s==null?void 0:s.excludes)?s.excludes.map(String):[]}}catch{return{includes:[u],excludes:[]}}}return l}function De(t){const l=t.map(u=>(u??"").trim()).filter(Boolean);return Array.from(new Set(l))}const Rt=({isOpen:t,onClose:l,onSave:u,serviceToEdit:s,categoryToEdit:x,serviceCategories:c})=>{const i=!!s,w=["unit","jam","kg","m²"],k=r.useMemo(()=>w.map(m=>({value:m,label:m})),[]),[D,f]=r.useState(""),[C,N]=r.useState(""),[p,S]=r.useState("unit"),[M,A]=r.useState(""),[v,_]=r.useState(""),[$,o]=r.useState(""),[F,h]=r.useState(""),[E,b]=r.useState(!1),[L,U]=r.useState([]),[O,K]=r.useState([]),[V,Q]=r.useState(""),[re,R]=r.useState(""),[X,Y]=r.useState(!1),le=r.useMemo(()=>c.map(m=>({value:m.id,label:m.name})),[c]),J=r.useRef("");r.useEffect(()=>{if(!t)return;const m=s?`edit:${s.id}`:"add:new";if(J.current!==m)if(J.current=m,s){f(s.name??""),N(typeof s.price=="number"?String(s.price):s.price??""),S(s.unit_price||"unit");const P=s.service_category?String(s.service_category):"";_(P),A(x||s.category||"");const z=s.duration_minute,G=s.duration_hour;o(z!=null&&String(z)!=="0"?String(z):""),h(G!=null&&String(G)!=="0"?String(G):"");const ee=s.is_guarantee;b(!!Number(ee??0));const fe=s.point,ae=qt(fe);U(ae.includes),K(ae.excludes),Q(""),R("")}else f(""),N(""),S("unit"),A(""),_(""),o(""),h(""),b(!1),U([]),K([]),Q(""),R("")},[t,s,x]),r.useEffect(()=>{const m=s?`edit:${s.id}`:"add:new";J.current&&J.current!==m&&(J.current="")},[s]),r.useEffect(()=>{if(!t)return;const m=P=>{P.key==="Escape"&&l()};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[t,l]);const Te=m=>{const P=m.target.value;_(P);const z=Number(P),G=c.find(ee=>ee.id===z);G&&A(G.name)},Me=m=>{A(m.target.value)},be=()=>{const m=V.trim();m&&(U(P=>De([...P,m])),Q(""))},ye=()=>{const m=re.trim();m&&(K(P=>De([...P,m])),R(""))},ke=m=>{U(P=>P.filter((z,G)=>G!==m))},de=m=>{K(P=>P.filter((z,G)=>G!==m))},oe=async m=>{if(m.preventDefault(),!!D.trim()&&C.trim()&&!(!i&&!M.trim())&&!(i&&!v)){Y(!0);try{const P=i?Number(v):0,z=JSON.stringify({includes:De(L),excludes:De(O)}),G={id:(s==null?void 0:s.id)??0,name:D.trim(),price:C.trim(),unit_price:p,service_category:P,category:M.trim(),duration_minute:$.trim()||"",duration_hour:F.trim()||"",is_guarantee:E,icon:"",point:z},ee=i?"":M.trim();u(G,ee)}finally{Y(!1)}}};return e.jsx("div",{className:["fixed inset-0 z-50 flex items-center justify-center bg-black/40 transition-opacity duration-200",t?"opacity-100":"opacity-0 pointer-events-none"].join(" "),"aria-hidden":!t,onMouseDown:m=>{m.target===m.currentTarget&&l()},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-3xl",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:i?"Edit Layanan":"Tambah Layanan Baru"}),e.jsx("button",{type:"button",onClick:l,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:"✕"})]}),e.jsxs("form",{onSubmit:oe,className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Nama Layanan"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:D,onChange:m=>f(m.target.value),placeholder:"Contoh: Cuci AC 1 PK",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Harga"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:C,onChange:m=>N(m.target.value),placeholder:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Satuan Harga"}),e.jsx(Fe,{value:p,options:k,placeholder:"Pilih satuan...",searchPlaceholder:"Cari satuan...",emptyText:"Satuan tidak ditemukan",onChange:m=>S(m)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("input",{id:"isGuarantee",type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary",checked:E,onChange:m=>b(m.target.checked)}),e.jsx("label",{htmlFor:"isGuarantee",className:"text-sm text-slate-700 dark:text-slate-200",children:"Bergaransi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Kategori"}),i?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{value:v?Number(v):"",options:le,placeholder:"Pilih kategori...",searchPlaceholder:"Cari kategori...",emptyText:"Kategori tidak ditemukan",required:!0,onChange:m=>{_(String(m)),Te({target:{value:String(m)}})}}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Edit mode: hanya bisa pilih kategori yang sudah ada (tidak membuat kategori baru)."})]}):e.jsx(e.Fragment,{children:e.jsx(Fe,{value:M,options:le.map(m=>({value:String(m.label),label:m.label})),placeholder:"Pilih kategori...",searchPlaceholder:"Cari kategori...",emptyText:"Kategori tidak ditemukan",required:!0,onChange:m=>{Me({target:{value:m}})}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (menit)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:$,onChange:m=>o(m.target.value),placeholder:"60"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (hari/jam)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:F,onChange:m=>h(m.target.value),placeholder:"1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:V,onChange:m=>Q(m.target.value),onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),be())}}),e.jsx("button",{type:"button",onClick:be,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin termasuk",children:e.jsx(ta,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:L.map((m,P)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:m}),e.jsx("button",{type:"button",onClick:()=>ke(P),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Ze,{size:18})})]},`${m}-${P}`))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Tidak Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:re,onChange:m=>R(m.target.value),onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),ye())}}),e.jsx("button",{type:"button",onClick:ye,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin tidak termasuk",children:e.jsx(ta,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:O.map((m,P)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:m}),e.jsx("button",{type:"button",onClick:()=>de(P),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Ze,{size:18})})]},`${m}-${P}`))})]})]}),e.jsxs("div",{className:"pt-2 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",disabled:X,children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark disabled:opacity-60",disabled:X,children:X?"Menyimpan...":i?"Simpan Layanan":"Tambah Layanan"})]})]})]})})},Kt=["Confirmed","On Site","In Progress","Completed","Cancelled"],Zt=()=>{const[t,l]=r.useState([]),[u,s]=r.useState([]),[x,c]=r.useState([]),[i,w]=r.useState([]),[k,D]=r.useState([]),[f,C]=r.useState("kpi"),[N,p]=r.useState(null),[S,M]=r.useState(1),[A,v]=r.useState(""),[_,$]=r.useState("all"),[o,F]=r.useState("all"),[h,E]=r.useState(!1),{addNotification:b}=Ha(),{logout:L,currentUser:U}=qa(),O=5,[K,V]=r.useState(new Set),[Q,re]=r.useState(new Set),[R,X]=r.useState(new Set),[Y,le]=r.useState(new Set),[J,Te]=r.useState(null),[Me,be]=r.useState(!1),[ye,ke]=r.useState(!1),[de,oe]=r.useState(null),[m,P]=r.useState(!1),[z,G]=r.useState(null),[ee,fe]=r.useState(null),[ae,Be]=r.useState(null),[da,ve]=r.useState(!1),[ce,je]=r.useState(null),[me,Ae]=r.useState(null),[oa,ue]=r.useState(!1),[Ne,qe]=r.useState(null),[te,we]=r.useState(null),[ca,_e]=r.useState(!1),[xe,Re]=r.useState({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""}),[Se,ma]=r.useState(new Date),[ge,Ke]=r.useState([]),[ua,Je]=r.useState(!1),[xa,We]=r.useState(null),Pe=O,[Ee,Le]=r.useState({}),ga=r.useMemo(()=>la(9,17,12,13,30),[]),ne=r.useMemo(()=>x.filter(a=>a.role==="technician"),[x]),he=r.useCallback(async()=>{try{const a=await Ya();l(a)}catch(a){console.error("Gagal memuat data booking dari server",a),l([])}try{const a=await na();s(a)}catch(a){console.error("Gagal memuat data layanan dari server",a),s([])}try{const a=await Qa();c(a)}catch(a){console.error("Gagal memuat data user dari server",a),c([])}try{const a=await Xa();w(a)}catch(a){console.error("Gagal memuat data role dari server",a),w([])}try{const a=await Za();D(a)}catch(a){console.error("Gagal memuat master kategori layanan dari server",a),D([])}try{const a=await et(),n=new Set(a.fullyBookedDates||[]),d=new Set(a.bookedSlots||[]);V(n),X(n),re(d),le(d)}catch(a){console.error("Gagal memuat availability dari server",a),V(new Set),X(new Set),re(new Set),le(new Set)}},[]),Ve=r.useCallback(async a=>{try{Je(!0),We(null);const n=await at(a);Ke(n)}catch(n){console.error("Error loadTechSchedule:",n),Ke([]),We((n==null?void 0:n.message)||"Gagal memuat jadwal teknisi")}finally{Je(!1)}},[]);r.useEffect(()=>(he(),window.addEventListener("focus",he),()=>{window.removeEventListener("focus",he)}),[he]),r.useEffect(()=>{Le(a=>{const n={...a};return t.forEach(d=>{n[d.id]||(n[d.id]=d.status)}),n})},[t]),r.useEffect(()=>{const a=JSON.stringify(Array.from(K).sort())!==JSON.stringify(Array.from(R).sort()),n=JSON.stringify(Array.from(Q).sort())!==JSON.stringify(Array.from(Y).sort());be(a||n)},[R,Y,K,Q]),r.useEffect(()=>{f==="schedule"&&Se&&Ve(Se)},[f,Se,Ve]);const Ie=r.useMemo(()=>t.filter(a=>{const n=(A||"").toLowerCase(),d=((a==null?void 0:a.name)||"").toLowerCase().includes(n),T=_==="all"||a.status===_,j=o==="all"||a.technician===o;return d&&T&&j}).sort((a,n)=>n.id-a.id),[t,A,_,o]),ha=r.useMemo(()=>{const a=(S-1)*Pe;return Ie.slice(a,a+Pe)},[Ie,S]),Ye=Math.ceil(Ie.length/Pe),pa=a=>{M(Math.max(1,Math.min(a,Ye)))};r.useEffect(()=>{M(1)},[A,_,o]);const ie=r.useMemo(()=>t.filter(a=>a.status==="Confirmed"||a.status==="On Site").sort((a,n)=>new Date(a.startDate).getTime()-new Date(n.startDate).getTime()),[t]);r.useEffect(()=>{f==="map"&&ie.length>0&&!de?oe({lat:ie[0].lat,lng:ie[0].lng,title:ie[0].name}):f!=="map"&&oe(null)},[f,ie,de]);const ba=async(a,n,d)=>{if(n!=="technician")return;const T=t.find(y=>y.id===a);if(!T)return;const j=d==="unassigned"?null:Number(d);if(d!=="unassigned"&&(!Number.isFinite(j)||j<=0)){b("Teknisi tidak valid (user_id harus angka).","error");return}const B=j==null?null:x.find(y=>y.id===j),g=(B==null?void 0:B.name)??"Belum Ditugaskan";try{if(!T.formId){b("form_id tidak ditemukan untuk booking ini.","error");return}await aa(T.formId,T.status,j);const y=t.map(I=>I.id===a?{...I,technician:g,technicianUserId:j}:I);l(y),b(`Teknisi untuk ${T.name} berhasil diubah.`,"success")}catch(y){console.error(y),b((y==null?void 0:y.message)||"Gagal mengubah teknisi di server.","error")}},ya=a=>{const n=t.find(B=>B.id===a);if(!n)return;const d=Ee[a]??n.status;if(d===n.status){b("Status belum berubah, tidak ada yang perlu diupdate.","info");return}let T="Ubah Status Booking?",j=`Apakah Anda yakin ingin mengubah status pesanan untuk ${n.name} dari "${n.status}" menjadi "${d}"?`;d==="Completed"?(T="Selesaikan Pesanan?",j=`Apakah Anda yakin ingin menyelesaikan pesanan untuk ${n.name}?`):d==="Cancelled"&&(T="Batalkan Pesanan?",j=`Apakah Anda yakin ingin membatalkan pesanan untuk ${n.name}? Tindakan ini tidak dapat diurungkan.`),Re({isOpen:!0,bookingId:a,field:"status",value:d,title:T,message:j})},se=()=>{Re({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""})},ka=async()=>{const{bookingId:a,field:n,value:d}=xe;if(!a||!n){se();return}if(n==="status"){const T=t.find(g=>g.id===a);if(!T){se();return}const j=d??Ee[a]??T.status,B=T.technicianUserId??null;try{if(!T.formId){b("form_id tidak ditemukan untuk booking ini.","error"),se();return}if(!B){b("Teknisi belum dipilih. Pilih teknisi dulu.","error"),se();return}await aa(T.formId,j,B);const g=x.find(I=>Number(I.id)===Number(B)),y=t.map(I=>I.id===a?{...I,status:j,technicianUserId:B,technician:(g==null?void 0:g.name)??"Belum Ditugaskan"}:I);l(y),Le(I=>({...I,[a]:j})),b(`Booking ${T.name} berhasil diupdate.`,"success")}catch(g){console.error(g),b((g==null?void 0:g.message)||"Gagal mengubah status/teknisi di server.","error")}finally{se()}return}se()},fa=()=>{if(!J)return;const a=H(J),n=new Set(R);n.has(a)?n.delete(a):n.add(a),X(n)},va=a=>{if(!J)return;const n=`${H(J)}-${a}`,d=new Set(Y);d.has(n)?d.delete(n):d.add(n),le(d)},ja=async()=>{try{await mt({fullyBookedDates:Array.from(R),bookedSlots:Array.from(Y)}),V(new Set(R)),re(new Set(Y)),ke(!0),setTimeout(()=>ke(!1),3e3),b("Availability berhasil disimpan ke server.","success")}catch(a){console.error(a),b((a==null?void 0:a.message)||"Gagal menyimpan availability ke server.","error")}},Na=a=>{const n=new Set(R);n.delete(a),X(n)},wa=()=>{G(null),fe(null),P(!0)},Sa=(a,n)=>{G(a),fe(n),P(!0)},Ca=(a,n)=>{const d=!!z,T=n&&!Number.isNaN(Number(n))?Number(n):a.service_category,j=k.find(y=>y.id===T),B={...a,service_category:T,category:(j==null?void 0:j.name)??a.category},g=y=>{s(I=>{let q=[...I];d&&z&&(q=q.filter(Oe=>Oe.id!==z.id));const Xe=q.findIndex(Oe=>Oe.id===y.id);return Xe>-1?q[Xe]=y:q.push(y),q})};(async()=>{try{if(d){const y=z==null?void 0:z.id;if(!y){b("ID layanan tidak ditemukan dari API.","error");return}await rt(y,B),g({...B,id:y})}else{const y=await lt(B,B.category,k),I=u.length>0?Math.max(...u.map(q=>q.id?Number(q.id):0))+1:1;g({...B,id:y??I})}P(!1),b(`Layanan "${a.name}" berhasil ${d?"diperbarui":"disimpan ke server"}.`,"success")}catch(y){console.error(y),b("Gagal menyimpan layanan ke server.","error")}})()},Da=async()=>{if(!ae)return;const{serviceId:a,serviceName:n}=ae;try{await dt(a),s(d=>d.filter(T=>T.id!==a)),Be(null),b(`Layanan "${n}" telah dihapus.`,"success")}catch(d){console.error(d),b(`Gagal menghapus layanan "${n}" di server.`,"error")}},Qe=r.useMemo(()=>{const a={};return u.forEach(n=>{const d=Number(n==null?void 0:n.service_category);Number.isFinite(d)&&(a[d]=(a[d]||0)+1)}),a},[u]),$a=()=>{je(null),ve(!0)},Ta=a=>{je(a),ve(!0)},Ma=async a=>{const n=!!ce;try{if(n&&ce){const d=ce.id,T=ce.name,j=await nt(d,{name:a.name});D(B=>B.map(g=>g.id===d?{...g,name:j.name}:g)),s(B=>B.map(g=>Number(g.service_category)===d?{...g,category:j.name}:g)),b(`Kategori "${T}" berhasil diubah jadi "${j.name}".`,"success")}else{const d=await it({name:a.name});D(T=>[...T,d].sort((j,B)=>(B.id||0)-(j.id||0))),b(`Kategori "${d.name}" berhasil ditambahkan.`,"success")}ve(!1),je(null)}catch(d){console.error(d),b((d==null?void 0:d.message)||"Gagal menyimpan kategori ke server.","error")}},Ba=async()=>{if(!me)return;const a=me;try{await ot(a.id),D(n=>n.filter(d=>d.id!==a.id)),s(n=>n.map(d=>Number(d.service_category)===a.id?{...d,category:"-"}:d)),b(`Kategori "${a.name}" berhasil dihapus.`,"success")}catch(n){console.error(n),b((n==null?void 0:n.message)||`Gagal menghapus kategori "${a.name}".`,"error")}finally{Ae(null)}},Aa=()=>{qe(null),ue(!0)},_a=a=>{qe(a),ue(!0)},Pa=async a=>{var n;const d=i.find(j=>j.name===a.role);if(!d){b("Role user tidak valid. Silakan refresh halaman.","error");return}const T=()=>({fullname:a.name,username:a.username,role_id:d.id});if(Ne){try{const j={id:Ne.id,...T()},B=String(a.password||"").trim();B&&(j.password=B);const g=await fetch("https://api-homeservice.viniela.id/api/v1/admin/user-management-update",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(j)});let y=null;try{y=await g.json()}catch{}if(!g.ok){const I=(y==null?void 0:y.message)||(y==null?void 0:y.error)||`Gagal update user (status ${g.status}).`;throw new Error(I)}c(I=>I.map(q=>q.id===Ne.id?{...q,name:a.name,username:a.username,role:a.role||d.name}:q)),ue(!1),b(`User "${a.name}" berhasil diperbarui.`,"success")}catch(j){console.error("Error saat update user:",j),b("Gagal update user ke server. Silakan cek koneksi atau coba lagi.","error")}return}try{const j=await fetch("https://api-homeservice.viniela.id/api/v1/admin/user-management-store",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...T(),password:a.password})});if(!j.ok)throw new Error(`Gagal menyimpan user: ${j.status}`);const B=await j.json(),g={id:(B==null?void 0:B.data)&&B.data.id||B.id||(x.length>0?Math.max(...x.map(y=>y.id))+1:1),name:a.name,username:a.username,role:a.role||d.name,created_at:(n=B==null?void 0:B.data)==null?void 0:n.created_at};c(y=>[...y,g]),ue(!1),b(`User "${g.name}" berhasil disimpan ke server.`,"success")}catch(j){console.error("Error saat menyimpan user baru:",j),b("Gagal menyimpan user ke server. Silakan cek koneksi atau coba lagi.","error")}},Ea=async()=>{if(!te)return;const a=U==null?void 0:U.id;if(a&&te.id===a){b("Tidak bisa menghapus akun yang sedang login.","error"),we(null);return}try{await ct(te.id),c(n=>n.filter(d=>d.id!==te.id)),b(`User "${te.name}" telah dihapus.`,"success")}catch(n){console.error(n),b((n==null?void 0:n.message)||"Gagal menghapus user di server.","error")}finally{we(null)}},La=async a=>{try{const n=a.status||"Confirmed",d=ea[n]||ea.Confirmed,T={...a,status:d};await st(T),b(`Booking baru untuk ${a.fullname} berhasil disimpan.`,"success"),await he(),_e(!1)}catch(n){console.error(n),b(`Gagal menyimpan booking: ${(n==null?void 0:n.message)||"Unknown error"}`,"error")}},Ia=r.useMemo(()=>{const a={};ne.forEach(g=>a[g.name]={completed:0,totalMinutes:0}),t.forEach(g=>{g.technician!=="Belum Ditugaskan"&&g.status==="Completed"&&(a[g.technician]||(a[g.technician]={completed:0,totalMinutes:0}),a[g.technician].completed+=1,a[g.technician].totalMinutes+=g.work_duration_minutes||0)});const n=Object.entries(a).map(([g,y])=>({name:g,...y})),d=t.reduce((g,y)=>(y.status==="Completed"&&(g[y.service]=(g[y.service]||0)+1),g),{}),T=Object.entries(d).sort(([,g],[,y])=>y-g).slice(0,5).map(([g,y])=>({label:g,value:y})),j=t.reduce((g,y)=>(g[y.status]=(g[y.status]||0)+1,g),{}),B=Object.entries(j).map(([g,y])=>({label:g,value:y}));return{technicianPerformance:n,popularServices:T,statusDistribution:B}},[t,ne]),Oa=r.useMemo(()=>{const a=[];return ge.forEach(n=>{n.schedules.forEach(d=>{const T=d.schedule_date,j=d.schedule_date;a.push({id:d.apply_id,formId:d.form_id,applyId:d.apply_id,name:d.fullname,whatsapp:d.wa,service:d.service,address:d.address,startDate:T,endDate:j,time:d.schedule_time,technician:n.fullname,technicianUserId:n.user_id,status:tt(d.status),lat:0,lng:0,arrival_time:d.arrival_time,start_time:d.start_time,end_time:d.end_time,work_duration_minutes:d.work_duration_minutes,additional_cost:d.additional_cost,note:d.note,photos:{arrival:void 0,before:void 0,after:void 0}})})}),a},[ge]),Ua=r.useMemo(()=>ge.length>0?ge.map(a=>({id:a.user_id,name:a.fullname,username:"",role:"technician"})):ne,[ge,ne]),za=r.useMemo(()=>{const a=k.map(d=>d.name);if(a.length>0)return a;const n=u.map(d=>d.category);return Array.from(new Set(n))},[k,u]),Fa={kpi:"Dashboard KPI",bookings:"Daftar Booking",schedule:"Jadwal Teknisi",map:"Peta Lokasi Tugas",technicians:"Manajemen Tim/User",services:"Manajemen Layanan",availability:"Atur Ketersediaan Jadwal"},Ga=()=>{switch(f){case"bookings":return e.jsx(St,{paginatedBookings:ha,currentPage:S,totalPages:Ye,goToPage:pa,searchTerm:A,setSearchTerm:v,statusFilter:_,setStatusFilter:$,technicianFilter:o,setTechnicianFilter:F,technicians:ne,statuses:Kt,expandedBookingId:N,setExpandedBookingId:p,statusDraft:Ee,setStatusDraft:Le,onStatusSubmit:ya,onTechnicianChange:ba});case"schedule":return e.jsx(Ot,{scheduleDate:Se,onScheduleDateChange:ma,isLoading:ua,error:xa,bookings:Oa,technicians:Ua});case"map":return e.jsx(Et,{upcomingJobs:ie,selectedLocation:de,onSelectLocation:oe});case"technicians":return e.jsx(zt,{users:x,onAddTechnician:Aa,onEditTechnician:_a,onRequestDelete:we});case"services":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ft,{categories:k,servicesCountByCategoryId:Qe,onAdd:$a,onEdit:Ta,onRequestDelete:Ae}),e.jsx(Ut,{services:u,onAddService:wa,onEditService:Sa,onRequestDelete:Be})]});case"availability":return e.jsx(Mt,{availableTimes:ga,selectedDate:J,onSelectedDateChange:Te,draftFullyBooked:R,draftBookedSlots:Y,onToggleFullDay:fa,onToggleSlot:va,onRemoveBlockedDate:Na,hasUnsavedChanges:Me,showSaveSuccess:ye,onSaveChanges:ja});case"kpi":return e.jsx(Pt,{kpiData:Ia});default:return null}};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx($t,{activeSection:f,onSectionChange:a=>{C(a),E(!1)},isOpen:h,onClose:()=>E(!1),onLogout:L}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(Ct,{currentUserName:U==null?void 0:U.name,onOpenSidebar:()=>E(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white",children:Fa[f]}),f==="bookings"&&e.jsx("button",{onClick:()=>_e(!0),className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:"Tambah Booking"})]}),Ga()]})]})]}),h&&e.jsx("div",{onClick:()=>E(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"}),e.jsx(ft,{isOpen:ca,onClose:()=>_e(!1),onSave:La,services:u,technicians:ne,availability:{fullyBookedDates:Array.from(K),bookedSlots:Array.from(Q)}}),e.jsx(Rt,{isOpen:m,onClose:()=>P(!1),onSave:Ca,serviceToEdit:z,categoryToEdit:ee,allCategories:za,serviceCategories:k}),e.jsx(Gt,{isOpen:da,onClose:()=>{ve(!1),je(null)},onSave:Ma,categoryToEdit:ce,existingNames:k.map(a=>a.name)}),e.jsx(Tt,{isOpen:oa,onClose:()=>ue(!1),onSave:Pa,technicianToEdit:Ne,existingUsernames:x.map(a=>a.username),roles:i}),e.jsx(pe,{isOpen:xe.isOpen,onClose:se,onConfirm:ka,title:xe.title,confirmText:"Ya, Lanjutkan",confirmButtonClass:xe.value==="Cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary-dark focus:ring-primary",children:e.jsx("p",{children:xe.message})}),ae&&e.jsx(pe,{isOpen:!0,onClose:()=>Be(null),onConfirm:Da,title:"Hapus Layanan?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus layanan"," ",e.jsxs("span",{className:"font-bold",children:['"',ae.serviceName,'"']}),"? Tindakan ini tidak dapat diurungkan."]})}),me&&e.jsxs(pe,{isOpen:!0,onClose:()=>Ae(null),onConfirm:Ba,title:"Hapus Kategori?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:[e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus kategori"," ",e.jsxs("span",{className:"font-bold",children:['"',me.name,'"']}),"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:["Dipakai oleh:"," ",e.jsx("span",{className:"font-bold",children:Qe[me.id]??0})," ","layanan."]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:"Tindakan ini tidak dapat diurungkan."})]}),te&&e.jsx(pe,{isOpen:!0,onClose:()=>we(null),onConfirm:Ea,title:"Hapus User?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus user"," ",e.jsxs("span",{className:"font-bold",children:['"',te.name,'"']}),"? Tindakan ini tidak dapat diurungkan."]})})]})};export{Zt as default};
