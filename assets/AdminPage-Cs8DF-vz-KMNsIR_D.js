import{T as r,F as Ma,c as Ba,M as e,N as Ye,R as Re,g as J,_ as Aa}from"./index-AIUiU-lP.js";import{k as Ze,S as G,_ as Ae}from"./storage-Cnls39ez-BBYBvF2Y.js";import{O as Le}from"./Calendar-Bi4q2nLu-ia0igBYS.js";import{f as _e,u as _a,p as Pa,h as Ea,g as La}from"./GenericConfirmationModal-FaoixSU1-y1I-o90h.js";import{E as Oa,I as Qe,O as Ia,k as Ua,T as za,B as Fa,N as Ga,v as qa,S as Je,D as Ha,P as Ra,U as Ja,$ as Ke,j as Ka,C as Wa,R as Va}from"./admin-aGzBrZSh-BsO7MkfQ.js";import{c as Xe}from"./trash-2-dXRA_Cg5-cuIi9uH2.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=J("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Za=J("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qa=J("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Xa=J("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const et=J("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const at=J("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const tt=J("PencilLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const We=J("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ee=J("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const st=J("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
* @license lucide-react v0.417.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const rt=J("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),X={lat:-6.175392,lng:106.827153,mapSrc:"https://maps.google.com/maps?q=-6.175392,106.827153&z=16&output=embed"},lt=({isOpen:t,onClose:l,onSave:u,services:s,technicians:g,availability:m})=>{const[n,N]=r.useState({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),[C,P]=r.useState({lat:X.lat,lng:X.lng}),[f,D]=r.useState({}),[v,y]=r.useState(X.mapSrc),w=m||{fullyBookedDates:[],bookedSlots:[]},_=r.useMemo(()=>new Set(w.fullyBookedDates||[]),[w.fullyBookedDates]),$=r.useMemo(()=>new Set(w.bookedSlots||[]),[w.bookedSlots]),k=r.useMemo(()=>Ze(9,17,12,13,30),[]);r.useEffect(()=>{t&&(N({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),D({}),P({lat:X.lat,lng:X.lng}),y(X.mapSrc))},[t]);const B=x=>{const{name:M,value:p}=x.target;D(E=>({...E,[M]:void 0})),N(E=>({...E,[M]:p}))},U=x=>{const M=new Date(x);M.setDate(M.getDate()),N(p=>({...p,startDate:x,endDate:M,time:""})),D(p=>({...p,startDate:void 0,time:void 0}))},o=()=>{const x={};return n.name.trim()||(x.name="Nama wajib diisi."),n.whatsapp.trim()||(x.whatsapp="Nomor WhatsApp wajib diisi."),n.address.trim()||(x.address="Alamat wajib diisi."),n.service||(x.service="Layanan wajib dipilih."),n.startDate||(x.startDate="Tanggal wajib dipilih."),n.time||(x.time="Waktu wajib dipilih."),D(x),Object.keys(x).length===0},F=x=>{if(x.preventDefault(),!o()||!n.startDate)return;const M=n.startDate.toISOString().slice(0,10),p=Number(n.service),E=n.technician&&n.technician!==""?Number(n.technician):null,z={fullname:n.name,whatsapp:n.whatsapp,address:n.address,service:p,user_id:E,status:n.status,lat:C.lat,lng:C.lng,schedule_date:M,schedule_time:n.time};u(z)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-5xl transform transition-all",onClick:x=>x.stopPropagation(),children:e.jsxs("form",{onSubmit:F,noValidate:!0,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Tambah Booking Manual"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Ye,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Pelanggan"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",name:"whatsapp",value:n.whatsapp,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.whatsapp&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.whatsapp})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alamat Lengkap"}),e.jsx("textarea",{name:"address",rows:2,value:n.address,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),f.address&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Layanan"}),e.jsxs("select",{name:"service",value:n.service,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih Layanan --"}),s.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]}),f.service&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.service})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Teknisi"}),e.jsxs("select",{name:"technician",value:n.technician,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Belum Ditugaskan"}),g.map(x=>e.jsx("option",{value:x.id,children:x.name||x.fullname||x.username},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status Awal"}),e.jsx("select",{name:"status",value:n.status,onChange:B,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:["Confirmed","On Site","In Progress","Completed","Cancelled"].map(x=>e.jsx("option",{value:x,children:x},x))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Jadwal"}),e.jsx(Le,{selectedDate:n.startDate,onDateSelect:U,fullyBookedDates:_}),f.startDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.startDate})]}),n.startDate?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:k.map(x=>{const M=`${G(n.startDate)}-${x}`,p=$.has(M);return e.jsx("button",{type:"button",onClick:()=>N(E=>({...E,time:x})),disabled:p,className:`p-2 rounded-md text-sm font-semibold border-2 transition-colors ${n.time===x?"bg-primary text-white border-primary":"bg-transparent border-gray-300 dark:border-slate-600"} ${p?"bg-gray-200 dark:bg-slate-600 text-gray-400 dark:text-gray-500 line-through cursor-not-allowed":"hover:border-primary"}`,children:x},x)})}),f.time&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:f.time})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"h-48 flex items-center justify-center bg-gray-50 dark:bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Pilih tanggal dahulu"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lokasi (sementara default: Monas, Jakarta)"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Untuk sekarang, lokasi booking akan tersimpan di sekitar Monas (lat: ",X.lat,", lng: ",X.lng,")."]}),e.jsx("div",{className:"mt-2 h-64 w-full rounded-lg overflow-hidden border dark:border-slate-600",children:e.jsx("iframe",{title:"Booking Location Default Monas",width:"100%",height:"100%",style:{border:0},src:v,allowFullScreen:!1,loading:"lazy"},v)})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-500",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan Booking"})]})]})})}):null},nt=["unit","jam","kg","m²"];function it(t){const l={includes:[],excludes:[]};if(!t)return l;if(typeof t=="object")return{includes:Array.isArray(t.includes)?t.includes.map(String):[],excludes:Array.isArray(t.excludes)?t.excludes.map(String):[]};if(typeof t=="string"){const u=t.trim();if(!u)return l;try{const s=JSON.parse(u);return{includes:Array.isArray(s==null?void 0:s.includes)?s.includes.map(String):[],excludes:Array.isArray(s==null?void 0:s.excludes)?s.excludes.map(String):[]}}catch{return{includes:[u],excludes:[]}}}return l}function xe(t){const l=t.map(u=>(u??"").trim()).filter(Boolean);return Array.from(new Set(l))}const dt=({isOpen:t,onClose:l,onSave:u,serviceToEdit:s,categoryToEdit:g,serviceCategories:m})=>{const n=!!s,[N,C]=r.useState(""),[P,f]=r.useState(""),[D,v]=r.useState("unit"),[y,w]=r.useState(""),[_,$]=r.useState(""),[k,B]=r.useState(""),[U,o]=r.useState(""),[F,x]=r.useState(!1),[M,p]=r.useState([]),[E,z]=r.useState([]),[I,R]=r.useState(""),[W,Y]=r.useState(""),[ee,K]=r.useState(!1),re=r.useMemo(()=>m,[m]),Z=r.useMemo(()=>xe(m.map(d=>String(d.name))),[m]),V=r.useRef("");r.useEffect(()=>{if(!t)return;const d=s?`edit:${s.id}`:"add:new";if(V.current!==d)if(V.current=d,s){C(s.name??""),f(typeof s.price=="number"?String(s.price):s.price??""),v(s.unit_price||"unit");const A=s.service_category?String(s.service_category):"";$(A),w(g||s.category||"");const q=s.duration_minute,L=s.duration_hour;B(q!=null&&String(q)!=="0"?String(q):""),o(L!=null&&String(L)!=="0"?String(L):"");const Q=s.is_guarantee;x(!!Number(Q??0));const we=s.point,de=it(we);p(de.includes),z(de.excludes),R(""),Y("")}else C(""),f(""),v("unit"),w(""),$(""),B(""),o(""),x(!1),p([]),z([]),R(""),Y("")},[t,s,g]),r.useEffect(()=>{const d=s?`edit:${s.id}`:"add:new";V.current&&V.current!==d&&(V.current="")},[s]),r.useEffect(()=>{if(!t)return;const d=A=>{A.key==="Escape"&&l()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[t,l]);const ae=d=>{const A=d.target.value;$(A);const q=Number(A),L=m.find(Q=>Q.id===q);L&&w(L.name)},ve=d=>{w(d.target.value)},ge=()=>{const d=I.trim();d&&(p(A=>xe([...A,d])),R(""))},he=()=>{const d=W.trim();d&&(z(A=>xe([...A,d])),Y(""))},Ne=d=>{p(A=>A.filter((q,L)=>L!==d))},pe=d=>{z(A=>A.filter((q,L)=>L!==d))},ie=async d=>{if(d.preventDefault(),!!N.trim()&&P.trim()&&!(!n&&!y.trim())&&!(n&&!_)){K(!0);try{const A=n?Number(_):0,q=JSON.stringify({includes:xe(M),excludes:xe(E)}),L={id:(s==null?void 0:s.id)??0,name:N.trim(),price:P.trim(),unit_price:D,service_category:A,category:y.trim(),duration_minute:k.trim()||"",duration_hour:U.trim()||"",is_guarantee:F,icon:"",point:q},Q=n?"":y.trim();u(L,Q)}finally{K(!1)}}};return e.jsx("div",{className:["fixed inset-0 z-50 flex items-center justify-center bg-black/40 transition-opacity duration-200",t?"opacity-100":"opacity-0 pointer-events-none"].join(" "),"aria-hidden":!t,onMouseDown:d=>{d.target===d.currentTarget&&l()},children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-3xl",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:n?"Edit Layanan":"Tambah Layanan Baru"}),e.jsx("button",{type:"button",onClick:l,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:"✕"})]}),e.jsxs("form",{onSubmit:ie,className:"px-6 py-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Nama Layanan"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:N,onChange:d=>C(d.target.value),placeholder:"Contoh: Cuci AC 1 PK",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Harga"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:P,onChange:d=>f(d.target.value),placeholder:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Satuan Harga"}),e.jsx("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:D,onChange:d=>v(d.target.value),children:nt.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("input",{id:"isGuarantee",type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary",checked:F,onChange:d=>x(d.target.checked)}),e.jsx("label",{htmlFor:"isGuarantee",className:"text-sm text-slate-700 dark:text-slate-200",children:"Bergaransi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Kategori"}),n?e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:_,onChange:ae,required:!0,children:[e.jsx("option",{value:"",children:"-- Pilih kategori --"}),re.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Edit mode: hanya bisa pilih kategori yang sudah ada (tidak membuat kategori baru)."})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",list:"service-category-suggestions",className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Ketik kategori... (contoh: AC, Elektronik, Plumbing)",value:y,onChange:ve,required:!0}),e.jsx("datalist",{id:"service-category-suggestions",children:Z.map(d=>e.jsx("option",{value:d},d))}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Tambah mode: kamu bisa ketik kategori baru. List hanya sebagai suggestion."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (menit)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:k,onChange:d=>B(d.target.value),placeholder:"60"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (hari/jam)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:U,onChange:d=>o(d.target.value),placeholder:"1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:I,onChange:d=>R(d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),ge())}}),e.jsx("button",{type:"button",onClick:ge,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin termasuk",children:e.jsx(We,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:M.map((d,A)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:d}),e.jsx("button",{type:"button",onClick:()=>Ne(A),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Re,{size:18})})]},`${d}-${A}`))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Tidak Termasuk"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Tambahkan poin...",value:W,onChange:d=>Y(d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),he())}}),e.jsx("button",{type:"button",onClick:he,className:"h-10 w-10 inline-flex items-center justify-center rounded-lg bg-primary text-white hover:bg-primary-dark","aria-label":"Tambah poin tidak termasuk",children:e.jsx(We,{size:18})})]}),e.jsx("div",{className:"mt-3 space-y-2",children:E.map((d,A)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-700 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200",children:d}),e.jsx("button",{type:"button",onClick:()=>pe(A),className:"text-red-500 hover:text-red-600","aria-label":"Hapus poin",children:e.jsx(Re,{size:18})})]},`${d}-${A}`))})]})]}),e.jsxs("div",{className:"pt-2 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",disabled:ee,children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark disabled:opacity-60",disabled:ee,children:ee?"Menyimpan...":n?"Simpan Layanan":"Tambah Layanan"})]})]})]})})},ot=({booking:t})=>{const l=s=>s.startsWith("0")?`62${s.substring(1)}`:s,u=()=>{const s=l(t.whatsapp),g=new Date(t.startDate).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),m=`Halo ${t.name}, kami dari Viniela Home & Service ingin mengkonfirmasi pesanan Anda:

*Layanan:* ${t.service}
*Jadwal:* ${g}, pukul ${t.time}
*Alamat:* ${t.address}

Mohon balas pesan ini untuk mengkonfirmasi detail di atas sudah benar. Terima kasih.`;return`https://wa.me/${s}?text=${encodeURIComponent(m)}`};return e.jsxs("a",{href:u(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-green-600 transition-colors",title:`Chat ${t.name} di WhatsApp`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.459l-6.354 1.654zm.791-6.938c.323.517.76 1.002 1.251 1.431.987.842 2.197 1.298 3.51 1.298 5.421 0 9.811-4.39 9.811-9.811 0-2.651-1.04-5.14-2.9-7.001-1.859-1.86-4.35-2.901-7.001-2.901-5.42 0-9.81 4.39-9.81 9.81 0 2.05.61 3.992 1.698 5.688l-.299 1.093zM9.262 7.176c-.23-.487-.474-.487-.698-.487-.203 0-.428.02-.638.211-.23.19-.813.78-.813 1.901 0 1.12.831 2.201.946 2.36.116.161 1.638 2.542 4.004 3.53.585.24 1.045.38 1.41.496.535.169.97.143 1.324-.087.419-.27.813-.981.928-1.342.116-.361.116-.671.083-.758-.032-.087-.23-.142-.487-.27-.257-.128-1.515-.748-1.758-.831-.243-.083-.419-.083-.595.083-.176.166-.66.831-.813.981-.152.152-.291.178-.487.05-.196-.128-.831-.289-1.587-.961-.595-.541-.97-1.221-1.085-1.428-.116-.208-.017-.323.07-.43.087-.107.196-.178.291-.269.1-.096.143-.15.211-.243.068-.092.032-.178-.017-.258-.05-.082-.464-1.113-.638-1.515z"})}),"Chat"]})};function je(t){if(!t)return"-";if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);const u=new Date(t);return Number.isNaN(u.getTime())?t:u.toISOString().slice(0,10)}const l=t;return Number.isNaN(l.getTime())?"-":l.toISOString().slice(0,10)}function Pe(t){if(!t)return"-";const l=typeof t=="string"?new Date(t):t;if(Number.isNaN(l.getTime()))return"-";const u=String(l.getHours()).padStart(2,"0"),s=String(l.getMinutes()).padStart(2,"0");return`${u}:${s}`}function ct(t){return t==null||Number.isNaN(t)?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(t)}const mt="https://api-homeservice.viniela.id",ut=t=>t.startsWith("http")?t:`${mt}${t}`,xt=({paginatedBookings:t,currentPage:l,totalPages:u,goToPage:s,searchTerm:g,setSearchTerm:m,statusFilter:n,setStatusFilter:N,technicianFilter:C,setTechnicianFilter:P,technicians:f,statuses:D,expandedBookingId:v,setExpandedBookingId:y,statusDraft:w,onTechnicianChange:_})=>{const[$,k]=r.useState(null),B=o=>{y(v===o?null:o)},U=()=>k(null);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[e.jsx("input",{value:g,onChange:o=>m(o.target.value),placeholder:"Cari nama pelanggan...",className:"w-full md:w-1/3 rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:n,onChange:o=>N(o.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Status"}),D.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsxs("select",{value:C,onChange:o=>P(o.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Teknisi"}),e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),f.map(o=>e.jsx("option",{value:String(o.id),children:o.name},o.id))]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700 text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Layanan"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jadwal"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Teknisi"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[t.map(o=>{var F,x,M;const p=je(o.startDate),E=v===o.id,z=[(F=o.photos)==null?void 0:F.arrival,(x=o.photos)==null?void 0:x.before,(M=o.photos)==null?void 0:M.after].filter(Boolean);return e.jsxs(Aa.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500",children:o.whatsapp})]}),e.jsx("td",{className:"px-4 py-3",children:o.service}),e.jsxs("td",{className:"px-4 py-3",children:[p," • ",o.time]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.technicianUserId==null?"unassigned":String(o.technicianUserId),onChange:I=>_(o.id,"technician",I.target.value),className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs",children:[e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),f.map(I=>e.jsx("option",{value:String(I.id),children:I.name},I.id))]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("select",{value:w[o.id]??o.status,disabled:!0,className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs opacity-70 cursor-not-allowed",children:D.map(I=>e.jsx("option",{value:I,children:I},I))})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(ot,{booking:o}),e.jsx("button",{type:"button",onClick:()=>B(o.id),className:"inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700","aria-label":E?"Tutup detail":"Buka detail",title:E?"Tutup detail":"Buka detail",children:E?e.jsx(Xa,{size:18}):e.jsx(Qa,{size:18})})]})})]}),E&&e.jsx("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:e.jsx("td",{colSpan:6,className:"px-4 py-4 bg-gray-50/60 dark:bg-slate-900/20",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Detail Pelanggan"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Nama"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"WhatsApp"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.whatsapp||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Alamat"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.address||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Laporan Kerja"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Tiba"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.arrival_time?`${je(o.arrival_time)} ${Pe(o.arrival_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Mulai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.start_time?`${je(o.start_time)} ${Pe(o.start_time)}`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Selesai"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.end_time?`${je(o.end_time)} ${Pe(o.end_time)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Durasi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.work_duration_minutes!=null?`${o.work_duration_minutes} mnt`:"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Biaya Tambahan"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:ct(o.additional_cost??0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Teknisi"}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:o.technician||"Belum Ditugaskan"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Catatan"}),e.jsx("div",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.note||"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-slate-700 p-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-gray-500 mb-3",children:"Bukti Foto"}),z.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map((I,R)=>{const W=ut(I);return e.jsx("button",{type:"button",onClick:()=>k(W),className:"block",title:"Klik untuk preview",children:e.jsx("img",{src:W,alt:`Bukti foto ${R+1}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200 dark:border-slate-600 hover:opacity-90",loading:"lazy"})},`${o.id}-photo-${R}`)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Belum ada foto."})]})]})})})]},o.id)}),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada data booking."})})]})]})}),u>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(l-1),disabled:l===1,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Prev"}),e.jsxs("span",{className:"text-xs py-1",children:["Halaman ",l," dari ",u]}),e.jsx("button",{onClick:()=>s(l+1),disabled:l===u,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Next"})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4",onClick:U,children:e.jsxs("div",{className:"relative max-w-5xl w-full",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:U,className:"absolute -top-3 -right-3 w-10 h-10 rounded-full bg-white text-gray-900 shadow flex items-center justify-center","aria-label":"Tutup",title:"Tutup",children:"✕"}),e.jsx("img",{src:$,alt:"Preview",className:"w-full max-h-[85vh] object-contain rounded-xl bg-black"}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("a",{href:$,target:"_blank",rel:"noreferrer",className:"px-3 py-2 text-sm rounded-lg bg-white/90 hover:bg-white",children:"Buka tab baru"}),e.jsx("a",{href:$,download:!0,className:"px-3 py-2 text-sm rounded-lg bg-white/90 hover:bg-white",children:"Download"})]})]})})]})},gt=({currentUserName:t,onOpenSidebar:l})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:l,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),ht=[{name:"Dashboard KPI",icon:Za,section:"kpi"},{name:"Daftar Booking",icon:_a,section:"bookings"},{name:"Jadwal Teknisi",icon:Ya,section:"schedule"},{name:"Peta Lokasi",icon:Pa,section:"map"},{name:"Manajemen Tim/User",icon:rt,section:"technicians"},{name:"Manajemen Layanan",icon:Ee,section:"services"},{name:"Atur Ketersediaan",icon:Ee,section:"availability"}],pt=({activeSection:t,onSectionChange:l,isOpen:u,onClose:s,onLogout:g})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${u?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Admin Viniela"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:ht.map(m=>e.jsxs("button",{onClick:()=>{l(m.section),s()},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${t===m.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(m.icon,{size:20}),m.name]},m.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:g,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(Ea,{size:20}),"Logout"]})})]}),bt=({isOpen:t,onClose:l,onSave:u,technicianToEdit:s,existingUsernames:g,roles:m})=>{const[n,N]=r.useState({}),[C,P]=r.useState({});r.useEffect(()=>{var y,w;if(t){const _=(s==null?void 0:s.role)||((y=m.find($=>$.name==="technician"))==null?void 0:y.name)||((w=m[0])==null?void 0:w.name)||"";N(s?{...s,password:""}:{name:"",username:"",role:_,password:""}),P({})}},[t,s,m]);const f=y=>{const{name:w,value:_}=y.target;N($=>({...$,[w]:_})),C[w]&&P($=>({...$,[w]:""}))},D=()=>{var y,w,_,$;const k={};return(y=n.name)!=null&&y.trim()||(k.name="Nama wajib diisi."),(w=n.username)!=null&&w.trim()||(k.username="Username wajib diisi."),(_=n.role)!=null&&_.trim()||(k.role="Peran wajib diisi."),s||(($=n.password)!=null&&$.trim()||(k.password="Password wajib diisi untuk user baru."),g.includes(n.username.trim())&&(k.username="Username sudah digunakan.")),P(k),Object.keys(k).length===0},v=y=>{y.preventDefault(),D()&&u({...n})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg transform transition-all",onClick:y=>y.stopPropagation(),children:e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:s?"Edit User":"Tambah User Baru"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Ye,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Lengkap"}),e.jsx("input",{type:"text",name:"name",value:n.name||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),C.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:n.username||"",onChange:f,readOnly:!!s,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary read-only:bg-gray-100 dark:read-only:bg-slate-600"}),C.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.username})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role User"}),e.jsxs("select",{name:"role",value:n.role||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Pilih role"}),m.map(y=>e.jsx("option",{value:y.name,children:y.name},y.id))]}),C.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.role})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:n.password||"",onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),C.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.password}),s&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Kosongkan jika tidak ingin mengubah password."})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-5 00",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan"})]})]})})}):null},yt=({availableTimes:t,selectedDate:l,onSelectedDateChange:u,draftFullyBooked:s,draftBookedSlots:g,onToggleFullDay:m,onToggleSlot:n,onRemoveBlockedDate:N,hasUnsavedChanges:C,showSaveSuccess:P,onSaveChanges:f})=>e.jsxs("div",{children:[e.jsxs("div",{className:"sticky top-4 lg:top-20 z-10 flex justify-end items-center mb-4 p-3 bg-light-bg/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-lg",children:[P&&e.jsx("span",{className:"text-green-600 font-semibold mr-4",children:"Perubahan berhasil disimpan!"}),e.jsx("button",{onClick:f,disabled:!C,className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Simpan Perubahan"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk mengatur slot waktu atau memblokir sepanjang hari."}),e.jsx(Le,{selectedDate:l,onDateSelect:D=>u(D),fullyBookedDates:s})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-1 xl:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Atur Slot Waktu"}),l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"font-semibold text-lg text-secondary dark:text-slate-300",children:l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("button",{onClick:m,className:`px-3 py-1.5 text-xs font-bold rounded-full ${s.has(G(l))?"bg-red-100 text-red-700":"bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-200"}`,children:s.has(G(l))?"Buka Blokir Hari Ini":"Blokir Seharian"})]}),e.jsx("div",{className:`grid grid-cols-3 sm:grid-cols-4 gap-3 ${s.has(G(l))?"opacity-40 pointer-events-none":""}`,children:t.map(D=>{const v=`${G(l)}-${D}`,y=g.has(v);return e.jsx("button",{onClick:()=>n(D),className:`text-center font-semibold px-4 py-2.5 rounded-lg border-2 transition-colors duration-200 ${y?"bg-red-500 border-red-500 text-white":"bg-white dark:bg-slate-700 border-gray-200 dark:border-gray-600 hover:border-primary"}`,children:D},D)})}),s.has(G(l))&&e.jsx("p",{className:"text-center mt-4 text-sm text-red-500 font-medium",children:"Semua slot tidak tersedia karena hari ini diblokir."})]}):e.jsx("div",{className:"text-center py-20 text-gray-500 dark:text-gray-400",children:"Pilih tanggal dari kalender untuk memulai."})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-2 xl:col-span-3 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Daftar Tanggal yang Diblokir Penuh"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Berikut adalah daftar tanggal yang telah Anda tandai sebagai penuh (tidak termasuk slot individual)."}),Array.from(s).length>0?e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:Array.from(s).sort((D,v)=>Ae(D).getTime()-Ae(v).getTime()).map(D=>e.jsxs("li",{className:"flex justify-between items-center bg-light-bg dark:bg-slate-700 p-3 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:Ae(D).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("button",{onClick:()=>N(D),className:"text-red-500 hover:text-red-700 text-sm font-bold",children:"Hapus"})]},D))}):e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada tanggal yang diblokir penuh."})]})]})]}),kt=({data:t,title:l})=>{const u=Math.max(...t.map(g=>g.value),1),s=["#14B8A6","#2DD4BF","#5EEAD4","#99F6E4","#CCFBF1"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsx("div",{className:"space-y-3",children:t.map((g,m)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200 truncate pr-2",children:g.label}),e.jsx("span",{className:"font-bold text-primary",children:g.value})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-4 rounded-full",style:{width:`${g.value/u*100}%`,backgroundColor:s[m%s.length]},title:`${g.label}: ${g.value}`})})]},g.label))})]})},Ve={Confirmed:"#3B82F6","On Site":"#06B6D4","In Progress":"#EAB308",Completed:"#22C55E",Cancelled:"#9CA3AF"},ft=({data:t,title:l})=>{const u=t.reduce((m,n)=>m+n.value,0);if(u===0)return null;let s=0;const g=t.map(m=>{const n=Ve[m.label]||"#CCCCCC",N=m.value/u*100,C=s;return s+=N,`${n} ${C}% ${s}%`});return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"w-40 h-40 rounded-full mx-auto",style:{background:`conic-gradient(${g.join(", ")})`}}),e.jsx("div",{className:"space-y-2",children:t.map(m=>{const n=Ve[m.label]||"#9CA3AF";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:n}}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:m.label})]}),e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:m.value})]},m.label)})})]})]})},jt=t=>{if(!t)return"-";if(t<60)return`${t} mnt`;const l=Math.floor(t/60),u=t%60;return u===0?`${l} jam`:`${l} jam ${u} mnt`},vt=({kpiData:t})=>{var l;const u=((l=t==null?void 0:t.popularServices)==null?void 0:l.length)??0,s=((t==null?void 0:t.popularServices)??[]).reduce((m,n)=>m+(Number(n.value)||0),0),g=u>0?`${u} Layanan Terlaris (Selesai) • Total ${s} selesai`:"Layanan Terlaris (Selesai)";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(kt,{data:t.popularServices,title:g}),e.jsx(ft,{data:t.statusDistribution,title:"Distribusi Status Pesanan"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Performa Teknisi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.technicianPerformance.length>0?t.technicianPerformance.map(m=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white",children:m.name}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pekerjaan Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Waktu Kerja"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:jt(m.totalMinutes)})]})]})]},m.name)):e.jsx("p",{className:"col-span-full text-center py-10 text-gray-500 dark:text-gray-400",children:"Belum ada data KPI yang bisa ditampilkan."})})]})]})},Nt=({upcomingJobs:t,selectedLocation:l,onSelectLocation:u})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white p-2 sticky top-0 bg-white dark:bg-slate-800 z-10",children:"Pekerjaan Akan Datang"}),t.length>0?t.map(s=>e.jsxs("button",{onClick:()=>u({lat:s.lat,lng:s.lng,title:s.name}),className:`w-full text-left p-4 rounded-lg transition-all duration-200 border-l-4 ${(l==null?void 0:l.title)===s.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent hover:bg-gray-50 dark:hover:bg-slate-700/50 border-transparent"}`,children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300",children:s.service}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:s.address}),e.jsxs("div",{className:"text-sm font-semibold text-primary mt-2",children:[new Date(s.startDate).toLocaleDateString("id-ID",{day:"numeric",month:"long"})," ","- ",s.time]})]},s.id)):e.jsx("p",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada pekerjaan akan datang."})]}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-slate-700 flex-shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:["Lokasi: ",l.title]}),e.jsxs("a",{href:`https://www.google.com/maps?q=${l.lat},${l.lng}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:["Buka di Google Maps ",e.jsx(at,{size:14})]})]}),e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${l.lat},${l.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${l.lat}-${l.lng}`)]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(La,{className:"mb-4 text-gray-300 dark:text-gray-600",size:48}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Pekerjaan"}),e.jsx("p",{children:"Pilih pekerjaan dari daftar untuk melihat lokasinya di peta."})]})})]}),wt={Confirmed:"bg-blue-500 border-blue-700","On Site":"bg-cyan-500 border-cyan-700","In Progress":"bg-yellow-500 border-yellow-700",Completed:"bg-green-500 border-green-700",Cancelled:"bg-gray-400 border-gray-600"},St=({bookings:t,selectedDate:l,technicians:u})=>{const[s,g]=r.useState(()=>new Map),[m,n]=r.useState(!1),[N,C]=r.useState(null);r.useEffect(()=>{(async()=>{try{n(!0),C(null);const v=await Qe(),y=new Map;v.forEach(w=>{y.set(w.name,w)}),g(y)}catch(v){console.error("Gagal memuat services dari API:",v),C("Gagal memuat data layanan dari server.")}finally{n(!1)}})()},[]);const P=r.useMemo(()=>{const v=G(l);return t.filter(y=>{const w=G(new Date(y.startDate)),_=G(new Date(y.endDate));return v>=w&&v<=_&&y.status!=="Cancelled"})},[t,l]),f=Array.from({length:10},(v,y)=>8+y),D=v=>v>80?"bg-red-500":v>50?"bg-yellow-400":"bg-green-500";return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:["Jadwal Teknisi untuk"," ",l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})]}),m&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Memuat data layanan..."}),N&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 mb-2",children:N}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"flex border-b-2 border-gray-200 dark:border-slate-700 pb-2",children:[e.jsx("div",{className:"w-48 flex-shrink-0"}),e.jsx("div",{className:"flex-1 grid grid-cols-10",children:f.map(v=>e.jsxs("div",{className:"text-center text-xs font-semibold text-gray-500 dark:text-gray-400",children:[String(v).padStart(2,"0"),":00"]},v))})]}),u.map(v=>{const y=P.filter(k=>k.technician===v.name),w=y.reduce((k,B)=>{const U=s.get(B.service);if(!U)return k;const o=U.duration_days&&U.duration_days>1,F=G(new Date(B.startDate))===G(l);if(o&&!F)return k+540;const x=U.duration??60;return k+x},0),_=Math.min(w/540*100,100),$=D(_);return e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-slate-700/50",children:[e.jsxs("div",{className:"w-48 flex-shrink-0 py-3 px-2 border-r border-gray-100 dark:border-slate-700/50",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-700 dark:text-gray-200 truncate",children:v.name}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5",children:[e.jsx("span",{children:"Beban Kerja"}),e.jsxs("span",{children:[(w/60).toFixed(1)," /"," ",540/60," jam"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-slate-700",title:`${_.toFixed(0)}% terisi`,children:e.jsx("div",{className:`${$} h-2 rounded-full transition-all duration-500`,style:{width:`${_}%`}})})]})]}),e.jsxs("div",{className:"flex-1 h-20 relative",children:[f.map(k=>e.jsx("div",{className:"absolute h-full border-l border-gray-100 dark:border-slate-700/50",style:{left:`${(k-8)/10*100}%`}},`line-${k}`)),y.map(k=>{const B=s.get(k.service),U=k.startDate!==k.endDate,o=G(new Date(k.startDate))===G(l);let F,x;if(U&&!o)F=0,x=600;else{const[z,I]=k.time.split(":").map(Number);F=(z-8)*60+(I||0),x=B?B.duration??60:60}const M=F/600*100,p=x/600*100;if(M<0||M>=100)return null;const E=wt[k.status]||"bg-gray-500 border-gray-700";return e.jsxs("div",{className:`absolute top-2 h-16 ${E} rounded-lg p-2 text-white shadow-md overflow-hidden border-l-4`,style:{left:`${M}%`,width:`${p}%`},title:`${k.name} - ${k.service} @ ${k.time} [Status: ${k.status}]`,children:[e.jsx("p",{className:"text-xs font-bold truncate",children:k.name}),e.jsx("p",{className:"text-[10px] opacity-80 truncate",children:k.service})]},k.id)})]})]},v.id)})]})}),P.length===0&&!m&&e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal pekerjaan untuk tanggal ini."})]})},Ct=({scheduleDate:t,onScheduleDateChange:l,isLoading:u,error:s,bookings:g,technicians:m})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk melihat jadwal teknisi dari sistem backend."}),e.jsx(Le,{selectedDate:t,onDateSelect:l,fullyBookedDates:new Set})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[u&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow rounded-xl p-3 text-sm text-gray-500 dark:text-gray-300",children:["Memuat jadwal teknisi untuk"," ",t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),"..."]}),s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl p-3",children:s}),e.jsx(St,{bookings:g,selectedDate:t,technicians:m})]})]})}),Dt=({services:t,onAddService:l,onEditService:u,onRequestDelete:s})=>{const g=r.useMemo(()=>{const m=new Map;return t.forEach(n=>{const N=n.category||"Layanan Umum";m.has(N)||m.set(N,[]),m.get(N).push(n)}),Array.from(m.entries()).sort(([n],[N])=>n.localeCompare(N)).map(([n,N])=>({categoryName:n,services:N}))},[t]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Layanan"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(et,{size:20}),"Tambah Layanan"]})]}),g.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6 text-center text-gray-500 dark:text-gray-400",children:"Belum ada layanan. Silakan tambah layanan baru."}):e.jsx("div",{className:"space-y-8",children:g.map(m=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:m.categoryName}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:m.services.map(n=>{const N=Number(n.price)||0;return e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-full bg-primary/10 items-center justify-center text-primary text-sm font-bold uppercase",children:n.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rp",N.toLocaleString("id-ID")," /"," ",n.unit_price]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(n,m.categoryName),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit Layanan",children:e.jsx(Ee,{size:18})}),e.jsx("button",{onClick:()=>s({serviceId:n.id,serviceName:n.name,categoryName:m.categoryName}),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus Layanan",children:e.jsx(Xe,{size:18})})]})]},n.id)})})]},m.categoryName))})]})},Tt=({users:t,onAddTechnician:l,onEditTechnician:u,onRequestDelete:s})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Tim/User"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(st,{size:20}),"Tambah User Baru"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl",children:[e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:t.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:g.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:g.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",g.username," • ",g.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(g),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit User",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>s(g),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus User",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]},g.id))}),t.length===0&&e.jsx("p",{className:"text-center py-10 text-gray-500",children:"Belum ada data user."})]})]}),$t=["Confirmed","On Site","In Progress","Completed","Cancelled"],Lt=()=>{const[t,l]=r.useState([]),[u,s]=r.useState([]),[g,m]=r.useState([]),[n,N]=r.useState([]),[C,P]=r.useState([]),[f,D]=r.useState("kpi"),[v,y]=r.useState(null),[w,_]=r.useState(1),[$,k]=r.useState(""),[B,U]=r.useState("all"),[o,F]=r.useState("all"),[x,M]=r.useState(!1),{addNotification:p}=Ma(),{logout:E,currentUser:z}=Ba(),I=5,[R,W]=r.useState(new Set),[Y,ee]=r.useState(new Set),[K,re]=r.useState(new Set),[Z,V]=r.useState(new Set),[ae,ve]=r.useState(null),[ge,he]=r.useState(!1),[Ne,pe]=r.useState(!1),[ie,d]=r.useState(null),[A,q]=r.useState(!1),[L,Q]=r.useState(null),[we,de]=r.useState(null),[be,Se]=r.useState(null),[ea,oe]=r.useState(!1),[ye,Oe]=r.useState(null),[te,ke]=r.useState(null),[aa,Ce]=r.useState(!1),[ce,Ie]=r.useState({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""}),[fe,ta]=r.useState(new Date),[me,Ue]=r.useState([]),[sa,ze]=r.useState(!1),[ra,Fe]=r.useState(null),De=I,[Te,$e]=r.useState({}),la=r.useMemo(()=>Ze(9,17,12,13,30),[]),le=r.useMemo(()=>g.filter(a=>a.role==="technician"),[g]),ue=r.useCallback(async()=>{try{const a=await Oa();l(a)}catch(a){console.error("Gagal memuat data booking dari server",a),l([])}try{const a=await Qe();s(a)}catch(a){console.error("Gagal memuat data layanan dari server",a),s([])}try{const a=await Ia();m(a)}catch(a){console.error("Gagal memuat data user dari server",a),m([])}try{const a=await Ua();N(a)}catch(a){console.error("Gagal memuat data role dari server",a),N([])}try{const a=await za();P(a)}catch(a){console.error("Gagal memuat master kategori layanan dari server",a),P([])}try{const a=await Fa(),i=new Set(a.fullyBookedDates||[]),c=new Set(a.bookedSlots||[]);W(i),re(i),ee(c),V(c)}catch(a){console.error("Gagal memuat availability dari server",a),W(new Set),re(new Set),ee(new Set),V(new Set)}},[]),Ge=r.useCallback(async a=>{try{ze(!0),Fe(null);const i=await Ga(a);Ue(i)}catch(i){console.error("Error loadTechSchedule:",i),Ue([]),Fe((i==null?void 0:i.message)||"Gagal memuat jadwal teknisi")}finally{ze(!1)}},[]);r.useEffect(()=>(ue(),window.addEventListener("focus",ue),()=>{window.removeEventListener("focus",ue)}),[ue]),r.useEffect(()=>{$e(a=>{const i={...a};return t.forEach(c=>{i[c.id]||(i[c.id]=c.status)}),i})},[t]),r.useEffect(()=>{const a=JSON.stringify(Array.from(R).sort())!==JSON.stringify(Array.from(K).sort()),i=JSON.stringify(Array.from(Y).sort())!==JSON.stringify(Array.from(Z).sort());he(a||i)},[K,Z,R,Y]),r.useEffect(()=>{f==="schedule"&&fe&&Ge(fe)},[f,fe,Ge]);const Me=r.useMemo(()=>t.filter(a=>{const i=($||"").toLowerCase(),c=((a==null?void 0:a.name)||"").toLowerCase().includes(i),S=B==="all"||a.status===B,j=o==="all"||a.technician===o;return c&&S&&j}).sort((a,i)=>i.id-a.id),[t,$,B,o]),na=r.useMemo(()=>{const a=(w-1)*De;return Me.slice(a,a+De)},[Me,w]),qe=Math.ceil(Me.length/De),ia=a=>{_(Math.max(1,Math.min(a,qe)))};r.useEffect(()=>{_(1)},[$,B,o]);const ne=r.useMemo(()=>t.filter(a=>a.status==="Confirmed"||a.status==="On Site").sort((a,i)=>new Date(a.startDate).getTime()-new Date(i.startDate).getTime()),[t]);r.useEffect(()=>{f==="map"&&ne.length>0&&!ie?d({lat:ne[0].lat,lng:ne[0].lng,title:ne[0].name}):f!=="map"&&d(null)},[f,ne,ie]);const da=async(a,i,c)=>{if(i!=="technician")return;const S=t.find(h=>h.id===a);if(!S)return;const j=c==="unassigned"?null:Number(c);if(c!=="unassigned"&&(!Number.isFinite(j)||j<=0)){p("Teknisi tidak valid (user_id harus angka).","error");return}const T=j==null?null:g.find(h=>h.id===j),b=(T==null?void 0:T.name)??"Belum Ditugaskan";try{if(!S.formId){p("form_id tidak ditemukan untuk booking ini.","error");return}await Ke(S.formId,S.status,j);const h=t.map(O=>O.id===a?{...O,technician:b,technicianUserId:j}:O);l(h),p(`Teknisi untuk ${S.name} berhasil diubah.`,"success")}catch(h){console.error(h),p((h==null?void 0:h.message)||"Gagal mengubah teknisi di server.","error")}},oa=a=>{const i=t.find(T=>T.id===a);if(!i)return;const c=Te[a]??i.status;if(c===i.status){p("Status belum berubah, tidak ada yang perlu diupdate.","info");return}let S="Ubah Status Booking?",j=`Apakah Anda yakin ingin mengubah status pesanan untuk ${i.name} dari "${i.status}" menjadi "${c}"?`;c==="Completed"?(S="Selesaikan Pesanan?",j=`Apakah Anda yakin ingin menyelesaikan pesanan untuk ${i.name}?`):c==="Cancelled"&&(S="Batalkan Pesanan?",j=`Apakah Anda yakin ingin membatalkan pesanan untuk ${i.name}? Tindakan ini tidak dapat diurungkan.`),Ie({isOpen:!0,bookingId:a,field:"status",value:c,title:S,message:j})},se=()=>{Ie({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""})},ca=async()=>{const{bookingId:a,field:i,value:c}=ce;if(!a||!i){se();return}if(i==="status"){const S=t.find(b=>b.id===a);if(!S){se();return}const j=c??Te[a]??S.status,T=S.technicianUserId??null;try{if(!S.formId){p("form_id tidak ditemukan untuk booking ini.","error"),se();return}if(!T){p("Teknisi belum dipilih. Pilih teknisi dulu.","error"),se();return}await Ke(S.formId,j,T);const b=g.find(O=>Number(O.id)===Number(T)),h=t.map(O=>O.id===a?{...O,status:j,technicianUserId:T,technician:(b==null?void 0:b.name)??"Belum Ditugaskan"}:O);l(h),$e(O=>({...O,[a]:j})),p(`Booking ${S.name} berhasil diupdate.`,"success")}catch(b){console.error(b),p((b==null?void 0:b.message)||"Gagal mengubah status/teknisi di server.","error")}finally{se()}return}se()},ma=()=>{if(!ae)return;const a=G(ae),i=new Set(K);i.has(a)?i.delete(a):i.add(a),re(i)},ua=a=>{if(!ae)return;const i=`${G(ae)}-${a}`,c=new Set(Z);c.has(i)?c.delete(i):c.add(i),V(c)},xa=async()=>{try{await Va({fullyBookedDates:Array.from(K),bookedSlots:Array.from(Z)}),W(new Set(K)),ee(new Set(Z)),pe(!0),setTimeout(()=>pe(!1),3e3),p("Availability berhasil disimpan ke server.","success")}catch(a){console.error(a),p((a==null?void 0:a.message)||"Gagal menyimpan availability ke server.","error")}},ga=a=>{const i=new Set(K);i.delete(a),re(i)},ha=()=>{Q(null),de(null),q(!0)},pa=(a,i)=>{Q(a),de(i),q(!0)},ba=(a,i)=>{const c=!!L,S=i&&!Number.isNaN(Number(i))?Number(i):a.service_category,j=C.find(h=>h.id===S),T={...a,service_category:S,category:(j==null?void 0:j.name)??a.category},b=h=>{s(O=>{let H=[...O];c&&L&&(H=H.filter(Be=>Be.id!==L.id));const He=H.findIndex(Be=>Be.id===h.id);return He>-1?H[He]=h:H.push(h),H})};(async()=>{try{if(c){const h=L==null?void 0:L.id;if(!h){p("ID layanan tidak ditemukan dari API.","error");return}await Ra(h,T),b({...T,id:h})}else{const h=await Ja(T,T.category,C),O=u.length>0?Math.max(...u.map(H=>H.id?Number(H.id):0))+1:1;b({...T,id:h??O})}q(!1),p(`Layanan "${a.name}" berhasil ${c?"diperbarui":"disimpan ke server"}.`,"success")}catch(h){console.error(h),p("Gagal menyimpan layanan ke server.","error")}})()},ya=async()=>{if(!be)return;const{serviceId:a,serviceName:i}=be;try{await Ka(a),s(c=>c.filter(S=>S.id!==a)),Se(null),p(`Layanan "${i}" telah dihapus.`,"success")}catch(c){console.error(c),p(`Gagal menghapus layanan "${i}" di server.`,"error")}},ka=()=>{Oe(null),oe(!0)},fa=a=>{Oe(a),oe(!0)},ja=async a=>{var i;const c=n.find(j=>j.name===a.role);if(!c){p("Role user tidak valid. Silakan refresh halaman.","error");return}const S=()=>({fullname:a.name,username:a.username,role_id:c.id});if(ye){try{const j={id:ye.id,...S()},T=String(a.password||"").trim();T&&(j.password=T);const b=await fetch("https://api-homeservice.viniela.id/api/v1/admin/user-management-update",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(j)});let h=null;try{h=await b.json()}catch{}if(!b.ok){const O=(h==null?void 0:h.message)||(h==null?void 0:h.error)||`Gagal update user (status ${b.status}).`;throw new Error(O)}m(O=>O.map(H=>H.id===ye.id?{...H,name:a.name,username:a.username,role:a.role||c.name}:H)),oe(!1),p(`User "${a.name}" berhasil diperbarui.`,"success")}catch(j){console.error("Error saat update user:",j),p("Gagal update user ke server. Silakan cek koneksi atau coba lagi.","error")}return}try{const j=await fetch("https://api-homeservice.viniela.id/api/v1/admin/user-management-store",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...S(),password:a.password})});if(!j.ok)throw new Error(`Gagal menyimpan user: ${j.status}`);const T=await j.json(),b={id:(T==null?void 0:T.data)&&T.data.id||T.id||(g.length>0?Math.max(...g.map(h=>h.id))+1:1),name:a.name,username:a.username,role:a.role||c.name,created_at:(i=T==null?void 0:T.data)==null?void 0:i.created_at};m(h=>[...h,b]),oe(!1),p(`User "${b.name}" berhasil disimpan ke server.`,"success")}catch(j){console.error("Error saat menyimpan user baru:",j),p("Gagal menyimpan user ke server. Silakan cek koneksi atau coba lagi.","error")}},va=async()=>{if(!te)return;const a=z==null?void 0:z.id;if(a&&te.id===a){p("Tidak bisa menghapus akun yang sedang login.","error"),ke(null);return}try{await Wa(te.id),m(i=>i.filter(c=>c.id!==te.id)),p(`User "${te.name}" telah dihapus.`,"success")}catch(i){console.error(i),p((i==null?void 0:i.message)||"Gagal menghapus user di server.","error")}finally{ke(null)}},Na=async a=>{try{const i=a.status||"Confirmed",c=Je[i]||Je.Confirmed,S={...a,status:c};await Ha(S),p(`Booking baru untuk ${a.fullname} berhasil disimpan.`,"success"),await ue(),Ce(!1)}catch(i){console.error(i),p(`Gagal menyimpan booking: ${(i==null?void 0:i.message)||"Unknown error"}`,"error")}},wa=r.useMemo(()=>{const a={};le.forEach(b=>a[b.name]={completed:0,totalMinutes:0}),t.forEach(b=>{b.technician!=="Belum Ditugaskan"&&b.status==="Completed"&&(a[b.technician]||(a[b.technician]={completed:0,totalMinutes:0}),a[b.technician].completed+=1,a[b.technician].totalMinutes+=b.work_duration_minutes||0)});const i=Object.entries(a).map(([b,h])=>({name:b,...h})),c=t.reduce((b,h)=>(h.status==="Completed"&&(b[h.service]=(b[h.service]||0)+1),b),{}),S=Object.entries(c).sort(([,b],[,h])=>h-b).slice(0,5).map(([b,h])=>({label:b,value:h})),j=t.reduce((b,h)=>(b[h.status]=(b[h.status]||0)+1,b),{}),T=Object.entries(j).map(([b,h])=>({label:b,value:h}));return{technicianPerformance:i,popularServices:S,statusDistribution:T}},[t,le]),Sa=r.useMemo(()=>{const a=[];return me.forEach(i=>{i.schedules.forEach(c=>{const S=c.schedule_date,j=c.schedule_date;a.push({id:c.apply_id,formId:c.form_id,applyId:c.apply_id,name:c.fullname,whatsapp:c.wa,service:c.service,address:c.address,startDate:S,endDate:j,time:c.schedule_time,technician:i.fullname,technicianUserId:i.user_id,status:qa(c.status),lat:0,lng:0,arrival_time:c.arrival_time,start_time:c.start_time,end_time:c.end_time,work_duration_minutes:c.work_duration_minutes,additional_cost:c.additional_cost,note:c.note,photos:{arrival:void 0,before:void 0,after:void 0}})})}),a},[me]),Ca=r.useMemo(()=>me.length>0?me.map(a=>({id:a.user_id,name:a.fullname,username:"",role:"technician"})):le,[me,le]),Da=r.useMemo(()=>{const a=C.map(c=>c.name);if(a.length>0)return a;const i=u.map(c=>c.category);return Array.from(new Set(i))},[C,u]),Ta={kpi:"Dashboard KPI",bookings:"Daftar Booking",schedule:"Jadwal Teknisi",map:"Peta Lokasi Tugas",technicians:"Manajemen Tim/User",services:"Manajemen Layanan",availability:"Atur Ketersediaan Jadwal"},$a=()=>{switch(f){case"bookings":return e.jsx(xt,{paginatedBookings:na,currentPage:w,totalPages:qe,goToPage:ia,searchTerm:$,setSearchTerm:k,statusFilter:B,setStatusFilter:U,technicianFilter:o,setTechnicianFilter:F,technicians:le,statuses:$t,expandedBookingId:v,setExpandedBookingId:y,statusDraft:Te,setStatusDraft:$e,onStatusSubmit:oa,onTechnicianChange:da});case"schedule":return e.jsx(Ct,{scheduleDate:fe,onScheduleDateChange:ta,isLoading:sa,error:ra,bookings:Sa,technicians:Ca});case"map":return e.jsx(Nt,{upcomingJobs:ne,selectedLocation:ie,onSelectLocation:d});case"technicians":return e.jsx(Tt,{users:g,onAddTechnician:ka,onEditTechnician:fa,onRequestDelete:ke});case"services":return e.jsx(Dt,{services:u,onAddService:ha,onEditService:pa,onRequestDelete:Se});case"availability":return e.jsx(yt,{availableTimes:la,selectedDate:ae,onSelectedDateChange:ve,draftFullyBooked:K,draftBookedSlots:Z,onToggleFullDay:ma,onToggleSlot:ua,onRemoveBlockedDate:ga,hasUnsavedChanges:ge,showSaveSuccess:Ne,onSaveChanges:xa});case"kpi":return e.jsx(vt,{kpiData:wa});default:return null}};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx(pt,{activeSection:f,onSectionChange:a=>{D(a),M(!1)},isOpen:x,onClose:()=>M(!1),onLogout:E}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(gt,{currentUserName:z==null?void 0:z.name,onOpenSidebar:()=>M(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white",children:Ta[f]}),f==="bookings"&&e.jsx("button",{onClick:()=>Ce(!0),className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:"Tambah Booking"})]}),$a()]})]})]}),x&&e.jsx("div",{onClick:()=>M(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"}),e.jsx(lt,{isOpen:aa,onClose:()=>Ce(!1),onSave:Na,services:u,technicians:le,availability:{fullyBookedDates:Array.from(R),bookedSlots:Array.from(Y)}}),e.jsx(dt,{isOpen:A,onClose:()=>q(!1),onSave:ba,serviceToEdit:L,categoryToEdit:we,allCategories:Da,serviceCategories:C}),e.jsx(bt,{isOpen:ea,onClose:()=>oe(!1),onSave:ja,technicianToEdit:ye,existingUsernames:g.map(a=>a.username),roles:n}),e.jsx(_e,{isOpen:ce.isOpen,onClose:se,onConfirm:ca,title:ce.title,confirmText:"Ya, Lanjutkan",confirmButtonClass:ce.value==="Cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary-dark focus:ring-primary",children:e.jsx("p",{children:ce.message})}),be&&e.jsx(_e,{isOpen:!0,onClose:()=>Se(null),onConfirm:ya,title:"Hapus Layanan?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus layanan"," ",e.jsxs("span",{className:"font-bold",children:['"',be.serviceName,'"']}),"? Tindakan ini tidak dapat diurungkan."]})}),te&&e.jsx(_e,{isOpen:!0,onClose:()=>ke(null),onConfirm:va,title:"Hapus User?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus user"," ",e.jsxs("span",{className:"font-bold",children:['"',te.name,'"']}),"? Tindakan ini tidak dapat diurungkan."]})})]})};export{Lt as default};
