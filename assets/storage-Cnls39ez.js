const m=n=>{const e=n.getFullYear(),t=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${e}-${t}-${a}`},g=new Date(new Date().setDate(new Date().getDate()+1)),D=new Date(new Date().setDate(new Date().getDate()+5)),w=new Set([`${m(g)}-10:30`]),y=new Set([m(D)]),p="https://api-homeservice.viniela.id",l=`${p}/api/v1/admin`;async function f(n,e={}){const t=await fetch(n,{...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers||{}}}),a=await t.json().catch(()=>null);if(!t.ok){const s=`Request gagal (status ${t.status})`;throw new Error(s)}return(a==null?void 0:a.data)??a}const S=n=>{const e=n.getFullYear(),t=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${e}-${t}-${a}`},_=n=>{const[e,t,a]=n.split("-").map(Number);return new Date(e,t-1,a)},k=(n,e,t,a,s)=>{const i=[],o=new Date;o.setHours(n,0,0,0);const r=new Date;r.setHours(e,0,0,0);const d=new Date;d.setHours(t,0,0,0);const u=new Date;for(u.setHours(a,0,0,0);o<r;)(o<d||o>=u)&&i.push(o.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),o.setMinutes(o.getMinutes()+s);return i};function h(n){const e=(n||"").toLowerCase().trim();return e==="confirmed"||e.includes("confirm")?"Confirmed":e==="onsite"||e==="on site"||e.includes("on site")||e.includes("onsite")||e.includes("arrive")?"On Site":e==="inprogress"||e==="in progress"||e.includes("progress")?"In Progress":e==="completed"||e.includes("complete")||e.includes("done")||e.includes("selesai")?"Completed":e==="cancelled"||e==="canceled"||e.includes("cancel")||e.includes("batal")?"Cancelled":"Confirmed"}function c(n,e=0){const t=Number(n);return Number.isFinite(t)?t:e}const b=async()=>{const e=(await f(`${l}/user-booking-list`)||[]).map(t=>{const a=new Date(t.schedule_date).toISOString(),s=t.lat==null?0:c(t.lat,0),i=t.lng==null?0:c(t.lng,0),o=t.technician_id==null?null:c(t.technician_id,0),r=t.apply_id??null;return{id:Number(r??t.form_id),formId:Number(t.form_id),applyId:r,name:t.customer_name,whatsapp:t.customer_wa,address:t.address,service:t.service,startDate:a,endDate:a,time:t.schedule_time,status:h(t.status),technician:t.technician_name||"Belum Ditugaskan",technicianId:o,technicianUsername:t.technician_username??null,lat:s,lng:i,note:t.note||"",additionalCosts:t.additional_cost==null?0:c(t.additional_cost,0),photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0},arrivalTime:t.arrival_time,startTime:t.start_time,endTime:t.end_time,workDurationMinutes:t.work_duration_minutes}});return e.sort((t,a)=>new Date(a.startDate).getTime()-new Date(t.startDate).getTime()||(a.applyId??a.formId)-(t.applyId??t.formId)),e},v=async()=>{try{const n=await f(`${l}/availability`);return{fullyBookedDates:Array.isArray(n.fullyBookedDates)?n.fullyBookedDates:[],bookedSlots:Array.isArray(n.bookedSlots)?n.bookedSlots:[]}}catch(n){return console.warn("Availability API fallback ke config default:",n),{fullyBookedDates:Array.from(y),bookedSlots:Array.from(w)}}};async function $(n,e,t){const a=new FormData;a.append("form_id",String(n)),a.append("type",e),a.append("file",t);const s=await fetch(`${l}/booking-photo-upload`,{method:"POST",credentials:"include",body:a}),i=await s.json().catch(()=>null);if(!s.ok){const r=`Upload gagal (status ${s.status})`;throw new Error(r)}return(i==null?void 0:i.data)??i}function A(n){return n?/^https?:\/\//i.test(n)?n:`${p}${n}`:null}export{k as a,b,S as f,v as g,_ as p,A as r,$ as u};
