const f="https://api-homeservice.viniela.id";function v(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`}function b(t,e){if(/^https?:\/\//i.test(t))return t;const a=(e??f).replace(/\/+$/,""),n=t.startsWith("/")?t:`/${t}`;return`${a}${n}`}async function s(t,e={}){const a=b(t,e.baseUrl),n=await fetch(a,{credentials:"include",...e,headers:{Accept:"application/json",...e.headers||{}}}),o=(n.headers.get("content-type")||"").includes("application/json")?await n.json().catch(()=>null):await n.text().catch(()=>null);if(!n.ok){const d=o&&(o.message||o.error)||`Request gagal (${n.status}) ${n.statusText}`;throw new Error(d)}return o}async function u(t){var e;const a=await s(t,{method:"GET"});return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray((e=a==null?void 0:a.data)==null?void 0:e.rows)?a.data.rows:[]}const i="/api/v1/admin",r={users:`${i}/user-management-list`,userDelete:`${i}/user-management-delete`,roles:`${i}/user-role-list`,serviceCategories:`${i}/service-category-list`,bookings:`${i}/user-booking-list`,services:`${i}/service-list`,updateBookingStatus:`${i}/update-booking-status`,techSchedule:`${i}/tech-schedule`,serviceCreate:`${i}/service-store`,serviceUpdate:`${i}/service-update`,serviceDelete:`${i}/service-delete`,storeBooking:`${i}/store-booking`,availabilityGet:`${i}/availability`,availabilityUpdate:`${i}/availability-update`},S={INPROGRESS:"In Progress",IN_PROGRESS:"In Progress",DONE:"Completed",COMPLETED:"Completed",CANCELLED:"Cancelled",CANCELED:"Cancelled",ONSITE:"On Site",ON_SITE:"On Site"},w=t=>S[(t||"").toUpperCase()]??"Confirmed",C={Confirmed:"1","On Site":"2","In Progress":"3",Completed:"4",Cancelled:"5"},$={unit:"unit",jam:"jam",hour:"jam",hours:"jam",kg:"kg",m2:"m²","m²":"m²"};function p(t){const e=(t??"").toString().toLowerCase();return $[e]??"unit"}function _(t){const e=t.duration_minute,a=t.duration_hour;if(typeof e=="number"||typeof a=="number"){const n=e??(a??0)*60,o=a??Math.floor(n/60);return{durationMinutes:n,durationHours:o}}return{durationMinutes:0,durationHours:0}}async function T(){return(await u(r.users)).map(t=>({id:t.id,name:t.fullname,username:t.username,role:t.role,created_at:t.created_at}))}async function E(){return(await u(r.roles)).map(t=>({id:t.id,name:t.name}))}async function N(t){const e={id:t};await s(r.userDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function O(){return(await u(r.serviceCategories)).map(t=>({id:t.id,name:t.name}))}async function A(){return(await u(r.bookings)).map(t=>{const e=t.schedule_date,a=w(t.status);return{id:Number(t.form_id),formId:t.form_id,applyId:t.apply_id,name:t.customer_name,whatsapp:t.customer_wa,service:t.service,address:t.address,startDate:e,endDate:e,time:t.schedule_time,technician:t.technician_name||"Belum Ditugaskan",technicianUserId:t.technician_id??null,status:a,lat:Number(t.lat),lng:Number(t.lng),arrivalTime:null,startTime:null,endTime:null,workDurationMinutes:0,additionalCosts:t.additional_cost&&Number(t.additional_cost)||0,note:t.note||"",photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0}}})}async function D(){return(await u(r.services)).map(t=>{const e=p(t.unit_price);return{id:t.id,name:t.name,price:t.price,unit_price:e,service_category:t.service_category,category:t.category,duration_minute:t.duration_minute,duration_hour:t.duration_hour,point:t.point,is_guarantee:t.is_guarantee}})}async function j(t,e,a){const n=C[e];if(!n)throw new Error(`Kode status belum di-mapping untuk status: ${e}`);const o={form_id:String(t),status:n,user_id:a};await s(r.updateBookingStatus,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}async function I(t){const e=v(t);return(await u(`${r.techSchedule}?schedule_date=${encodeURIComponent(e)}`)).map(a=>({user_id:a.user_id,fullname:a.fullname,schedules:Array.isArray(a.schedules)?a.schedules:Array.isArray(a.schedules_json)?a.schedules_json:[]}))}async function P(t){const e=await s(r.storeBooking,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return{error:!!(e!=null&&e.error),message:(e==null?void 0:e.message)??"",data:e==null?void 0:e.data}}async function U(t,e,a){const n=t,{durationMinutes:o,durationHours:d}=_(n),m=a.find(l=>l.id===n.service_category)||a.find(l=>l.name===e),g=(m==null?void 0:m.id)??n.service_category??null,h={name:n.name,price:String(n.price??0),unit_price:p(n.unit_price),point:n.point??0,service_category:g,duration_minute:o,duration_hour:d,is_guarantee:n.is_guarantee??!1},c=await s(r.serviceCreate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),y=(c==null?void 0:c.data)&&c.data.id||(c==null?void 0:c.id)||null;return typeof y=="number"?y:null}async function M(t,e){const a=e,{durationMinutes:n,durationHours:o}=_(a),d={id:t,name:a.name,price:String(a.price??0),unit_price:p(a.unit_price),service_category:a.service_category,duration_minute:n,duration_hour:o,is_guarantee:a.is_guarantee??!1};await s(r.serviceUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}async function B(t){const e={id:String(t)};await s(r.serviceDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function k(t){const e=(t==null?void 0:t.data)??t;return{fullyBookedDates:Array.isArray(e==null?void 0:e.fully_booked_dates)?e.fully_booked_dates:[],bookedSlots:Array.isArray(e==null?void 0:e.booked_slots)?e.booked_slots:[]}}async function J(){const t=await s(r.availabilityGet,{method:"GET"});return k(t)}async function L(t){const e={fully_booked_dates:t.fullyBookedDates,booked_slots:t.bookedSlots};await s(r.availabilityUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}export{A,B,w as C,D,E,I,J,L,M,N,O,P,T,U,j,v,C as w};
