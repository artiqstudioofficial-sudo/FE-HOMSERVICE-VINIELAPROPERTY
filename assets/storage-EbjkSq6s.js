const m=e=>{const o=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${o}-${t}-${a}`},D=new Date(new Date().setDate(new Date().getDate()+1)),f=new Date(new Date().setDate(new Date().getDate()+5)),p=new Set([`${m(D)}-10:30`]),y=new Set([m(f)]),g="https://api-homeservice.viniela.id",l=`${g}/api/v1/admin`;async function c(e,o={}){const t=await fetch(e,{...o,credentials:"include",headers:{"Content-Type":"application/json",...o.headers||{}}}),a=await t.json().catch(()=>null);if(!t.ok){const s=(a==null?void 0:a.message)||(a==null?void 0:a.error)||`Request gagal (status ${t.status})`;throw new Error(s)}return(a==null?void 0:a.data)??a}const h=e=>{const o=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${o}-${t}-${a}`},S=e=>{const[o,t,a]=e.split("-").map(Number);return new Date(o,t-1,a)},b=(e,o,t,a,s)=>{const n=[],i=new Date;i.setHours(e,0,0,0);const r=new Date;r.setHours(o,0,0,0);const u=new Date;u.setHours(t,0,0,0);const d=new Date;for(d.setHours(a,0,0,0);i<r;)(i<u||i>=d)&&n.push(i.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),i.setMinutes(i.getMinutes()+s);return n};function w(e){const o=(e||"").toLowerCase();return o.includes("confirm")?"Confirmed":o.includes("on site")||o.includes("onsite")||o.includes("arrive")?"On Site":o.includes("progress")?"In Progress":o.includes("complete")||o.includes("done")||o.includes("selesai")?"Completed":o.includes("cancel")||o.includes("batal")?"Cancelled":"Confirmed"}const k=async()=>{const o=(await c(`${l}/user-booking-list`)||[]).map(t=>{const a=new Date(t.schedule_date).toISOString(),s=t.lat==null?0:Number(t.lat),n=t.lng==null?0:Number(t.lng);return{id:Number(t.apply_id??t.form_id),name:t.customer_name,whatsapp:t.customer_wa,address:t.address,service:t.service,startDate:a,endDate:a,time:t.schedule_time,status:w(t.status),technician:t.technician_name||"Belum Ditugaskan",lat:Number.isFinite(s)?s:0,lng:Number.isFinite(n)?n:0,note:t.note||"",additionalCosts:t.additional_cost==null?0:Number(t.additional_cost)||0,photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0},arrivalTime:null,startTime:null,endTime:null,workDurationMinutes:null}});return o.sort((t,a)=>new Date(a.startDate).getTime()-new Date(t.startDate).getTime()||a.id-t.id),o},v=async()=>{try{const e=await c(`${l}/availability`);return{fullyBookedDates:Array.isArray(e.fullyBookedDates)?e.fullyBookedDates:[],bookedSlots:Array.isArray(e.bookedSlots)?e.bookedSlots:[]}}catch(e){return console.warn("Availability API fallback ke config default:",e),{fullyBookedDates:Array.from(y),bookedSlots:Array.from(p)}}},$=async e=>{await c(`${l}/availability`,{method:"PUT",body:JSON.stringify({fullyBookedDates:e.fullyBookedDates??[],bookedSlots:e.bookedSlots??[]})})};async function A(e,o,t){const a=new FormData;a.append("form_id",String(e)),a.append("type",o),a.append("file",t);const s=await fetch(`${l}/booking-photo-upload`,{method:"POST",credentials:"include",body:a}),n=await s.json().catch(()=>null);if(!s.ok){const r=(n==null?void 0:n.message)||(n==null?void 0:n.error)||`Upload gagal (status ${s.status})`;throw new Error(r)}return(n==null?void 0:n.data)??n}function _(e){return e?/^https?:\/\//i.test(e)?e:`${g}${e}`:null}export{b as a,k as b,h as f,v as g,S as p,_ as r,$ as s,A as u};
