const m=e=>{const t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${n}-${a}`},f=new Date(new Date().setDate(new Date().getDate()+1)),w=new Date(new Date().setDate(new Date().getDate()+5)),h=new Set([`${m(f)}-10:30`]),D=new Set([m(w)]),p="https://api-homeservice.viniela.id",l=`${p}/api/v1/admin`;async function g(e,t={}){const n=await fetch(e,{...t,credentials:"include",headers:{"Content-Type":"application/json",...t.headers||{}}}),a=await n.json().catch(()=>null);if(!n.ok){const i=`Request gagal (status ${n.status})`;throw new Error(i)}return(a==null?void 0:a.data)??a}const _=e=>{const t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${n}-${a}`},S=e=>{const[t,n,a]=e.split("-").map(Number);return new Date(t,n-1,a)},b=(e,t,n,a,i)=>{const r=[],o=new Date;o.setHours(e,0,0,0);const c=new Date;c.setHours(t,0,0,0);const d=new Date;d.setHours(n,0,0,0);const u=new Date;for(u.setHours(a,0,0,0);o<c;)(o<d||o>=u)&&r.push(o.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),o.setMinutes(o.getMinutes()+i);return r};function y(e){const t=(e||"").toLowerCase().trim();return t==="confirmed"||t.includes("confirm")?"Confirmed":t==="onsite"||t==="on site"||t.includes("on site")||t.includes("onsite")||t.includes("arrive")?"On Site":t==="inprogress"||t==="in progress"||t.includes("progress")?"In Progress":t==="completed"||t.includes("complete")||t.includes("done")||t.includes("selesai")?"Completed":t==="cancelled"||t==="canceled"||t.includes("cancel")||t.includes("batal")?"Cancelled":"Confirmed"}function s(e,t=0){const n=Number(e);return Number.isFinite(n)?n:t}const k=async()=>{const e=(await g(`${l}/user-booking-list`)||[]).map(t=>{const n=new Date(t.schedule_date).toISOString(),a=t.lat==null?0:s(t.lat,0),i=t.lng==null?0:s(t.lng,0),r=t.technician_id==null?null:s(t.technician_id,0),o=t.apply_id??null;return{id:Number(o??t.form_id),formId:Number(t.form_id),applyId:o,name:t.customer_name,whatsapp:t.customer_wa,address:t.address,service:t.service,startDate:n,endDate:n,time:t.schedule_time,status:y(t.status),technician:t.technician_name||"Belum Ditugaskan",technicianId:r,technicianUsername:t.technician_username??null,lat:a,lng:i,note:t.note||"",additionalCosts:t.additional_cost==null?0:s(t.additional_cost,0),photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0},arrivalTime:t.arrival_time,startTime:t.start_time,endTime:t.end_time,workDurationMinutes:t.work_duration_minutes}});return e.sort((t,n)=>new Date(n.startDate).getTime()-new Date(t.startDate).getTime()||(n.applyId??n.formId)-(t.applyId??t.formId)),e},v=async()=>{try{const e=await g(`${l}/availability`);return{fullyBookedDates:Array.isArray(e.fullyBookedDates)?e.fullyBookedDates:[],bookedSlots:Array.isArray(e.bookedSlots)?e.bookedSlots:[]}}catch(e){return console.warn("Availability API fallback ke config default:",e),{fullyBookedDates:Array.from(D),bookedSlots:Array.from(h)}}};async function $(e,t,n){const a=new FormData;a.append("form_id",String(e)),a.append("type",t),a.append("file",n);const i=await fetch(`${l}/booking-photo-upload`,{method:"POST",credentials:"include",body:a}),r=await i.json().catch(()=>null);if(!i.ok){const o=`Upload gagal (status ${i.status})`;throw new Error(o)}return(r==null?void 0:r.data)??r}function I(e){return e?/^https?:\/\//i.test(e)?e:`${p}${e}`:null}export{$,I,S,_,b,k,v};
