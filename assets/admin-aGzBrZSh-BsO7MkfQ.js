const _="https://api-homeservice.viniela.id";function g(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`}function h(e,t){if(/^https?:\/\//i.test(e))return e;const a=(t??_).replace(/\/+$/,""),n=e.startsWith("/")?e:`/${e}`;return`${a}${n}`}async function s(e,t={}){const a=h(e,t.baseUrl),n=await fetch(a,{credentials:"include",...t,headers:{Accept:"application/json",...t.headers||{}}}),o=(n.headers.get("content-type")||"").includes("application/json")?await n.json().catch(()=>null):await n.text().catch(()=>null);if(!n.ok){const c=o&&(o.message||o.error)||`Request gagal (${n.status}) ${n.statusText}`;throw new Error(c)}return o}async function u(e){var t;const a=await s(e,{method:"GET"});return Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray((t=a==null?void 0:a.data)==null?void 0:t.rows)?a.data.rows:[]}const i="/api/v1/admin",r={users:`${i}/user-management-list`,userDelete:`${i}/user-management-delete`,roles:`${i}/user-role-list`,serviceCategories:`${i}/service-category-list`,bookings:`${i}/user-booking-list`,services:`${i}/service-list`,updateBookingStatus:`${i}/update-booking-status`,techSchedule:`${i}/tech-schedule`,serviceCreate:`${i}/service-store`,serviceUpdate:`${i}/service-update`,serviceDelete:`${i}/service-delete`,storeBooking:`${i}/store-booking`,availabilityGet:`${i}/availability`,availabilityUpdate:`${i}/availability-update`},f={INPROGRESS:"In Progress",IN_PROGRESS:"In Progress",DONE:"Completed",COMPLETED:"Completed",CANCELLED:"Cancelled",CANCELED:"Cancelled",ONSITE:"On Site",ON_SITE:"On Site"},v=e=>f[(e||"").toUpperCase()]??"Confirmed",b={Confirmed:"1","On Site":"2","In Progress":"3",Completed:"4",Cancelled:"5"},S={unit:"unit",jam:"jam",hour:"jam",hours:"jam",kg:"kg",m2:"m²","m²":"m²"};function m(e){const t=(e??"").toString().toLowerCase();return S[t]??"unit"}async function C(){return(await u(r.users)).map(e=>({id:e.id,name:e.fullname,username:e.username,role:e.role,created_at:e.created_at}))}async function k(){return(await u(r.roles)).map(e=>({id:e.id,name:e.name}))}async function $(e){const t={id:e};await s(r.userDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async function E(){return(await u(r.serviceCategories)).map(e=>({id:e.id,name:e.name}))}async function T(){return(await u(r.bookings)).map(e=>{const t=e.schedule_date,a=v(e.status);return{id:Number(e.form_id),formId:e.form_id,applyId:e.apply_id,name:e.customer_name,whatsapp:e.customer_wa,service:e.service,address:e.address,startDate:t,endDate:t,time:e.schedule_time,technician:e.technician_name||"Belum Ditugaskan",technicianUserId:e.technician_id??null,status:a,lat:Number(e.lat),lng:Number(e.lng),arrival_time:e.arrival_time,start_time:e.start_time,end_time:e.end_time,work_duration_minutes:e.work_duration_minutes,additional_cost:e.additional_cost&&Number(e.additional_cost)||0,note:e.note||"",photos:{arrival:e.arrive_photo||void 0,before:e.before_photo||void 0,after:e.after_photo||void 0}}})}async function N(){return(await u(r.services)).map(e=>{const t=m(e.unit_price);return{id:e.id,name:e.name,price:e.price,unit_price:t,service_category:e.service_category,category:e.category,duration_minute:e.duration_minute,duration_hour:e.duration_hour,point:e.point,is_guarantee:e.is_guarantee}})}async function O(e,t,a){const n=b[t];if(!n)throw new Error(`Kode status belum di-mapping untuk status: ${t}`);const o={form_id:String(e),status:n,user_id:a};await s(r.updateBookingStatus,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}async function A(e){const t=g(e);return(await u(`${r.techSchedule}?schedule_date=${encodeURIComponent(t)}`)).map(a=>({user_id:a.user_id,fullname:a.fullname,schedules:Array.isArray(a.schedules)?a.schedules:Array.isArray(a.schedules_json)?a.schedules_json:[]}))}async function j(e){const t=await s(r.storeBooking,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return{error:!!(t!=null&&t.error),message:(t==null?void 0:t.message)??"",data:t==null?void 0:t.data}}async function D(e,t,a){const n=e,o=a.find(l=>l.id===n.service_category)||a.find(l=>l.name===t),c=(o==null?void 0:o.id)??n.service_category??null,y={name:n.name,price:String(n.price??0),unit_price:m(n.unit_price),point:n.point??0,service_category:c,category:n.category,duration_minute:n.duration_minute,duration_hour:n.duration_hour,is_guarantee:n.is_guarantee??!1},d=await s(r.serviceCreate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}),p=(d==null?void 0:d.data)&&d.data.id||(d==null?void 0:d.id)||null;return typeof p=="number"?p:null}async function I(e,t){const a=t,n={id:e,name:a.name,price:String(a.price??0),unit_price:m(a.unit_price),service_category:a.service_category,category:a.category,duration_minute:a.duration_minute,duration_hour:a.duration_hour,is_guarantee:a.is_guarantee??!1};await s(r.serviceUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}async function P(e){const t={id:String(e)};await s(r.serviceDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}function w(e){const t=(e==null?void 0:e.data)??e;return{fullyBookedDates:Array.isArray(t==null?void 0:t.fully_booked_dates)?t.fully_booked_dates:[],bookedSlots:Array.isArray(t==null?void 0:t.booked_slots)?t.booked_slots:[]}}async function U(){const e=await s(r.availabilityGet,{method:"GET"});return w(e)}async function B(e){const t={fully_booked_dates:e.fullyBookedDates,booked_slots:e.bookedSlots};await s(r.availabilityUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}export{O as $,U as B,$ as C,j as D,T as E,N as I,A as N,C as O,I as P,B as R,b as S,E as T,D as U,g,P as j,k,v};
