const m=e=>{const t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${n}-${a}`},g=new Date(new Date().setDate(new Date().getDate()+1)),D=new Date(new Date().setDate(new Date().getDate()+5)),w=new Set([`${m(g)}-10:30`]),f=new Set([m(D)]),p="https://api-homeservice.viniela.id",r=`${p}/api/v1/admin`;async function l(e,t={}){const n=await fetch(e,{...t,credentials:"include",headers:{"Content-Type":"application/json",...t.headers||{}}}),a=await n.json().catch(()=>null);if(!n.ok){const o=(a==null?void 0:a.message)||(a==null?void 0:a.error)||`Request gagal (status ${n.status})`;throw new Error(o)}return(a==null?void 0:a.data)??a}const y=e=>{const t=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t}-${n}-${a}`},b=e=>{const[t,n,a]=e.split("-").map(Number);return new Date(t,n-1,a)},S=(e,t,n,a,o)=>{const s=[],i=new Date;i.setHours(e,0,0,0);const u=new Date;u.setHours(t,0,0,0);const d=new Date;d.setHours(n,0,0,0);const c=new Date;for(c.setHours(a,0,0,0);i<u;)(i<d||i>=c)&&s.push(i.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),i.setMinutes(i.getMinutes()+o);return s};function h(e){const t=(e||"").toLowerCase();return t.includes("confirm")?"Confirmed":t.includes("on site")||t.includes("onsite")||t.includes("arrive")?"On Site":t.includes("progress")?"In Progress":t.includes("complete")||t.includes("done")||t.includes("selesai")?"Completed":t.includes("cancel")||t.includes("batal")?"Cancelled":"Confirmed"}const v=async()=>{const e=(await l(`${r}/user-booking-list`)||[]).map(t=>{const n=new Date(t.schedule_date).toISOString(),a=t.lat==null?0:Number(t.lat),o=t.lng==null?0:Number(t.lng);return{id:Number(t.apply_id??t.form_id),name:t.customer_name,whatsapp:t.customer_wa,address:t.address,service:t.service,startDate:n,endDate:n,time:t.schedule_time,status:h(t.status),technician:t.technician_name||"Belum Ditugaskan",lat:Number.isFinite(a)?a:0,lng:Number.isFinite(o)?o:0,note:t.note||"",additionalCosts:t.additional_cost==null?0:Number(t.additional_cost)||0,photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0},arrivalTime:null,startTime:null,endTime:null,workDurationMinutes:null}});return e.sort((t,n)=>new Date(n.startDate).getTime()-new Date(t.startDate).getTime()||n.id-t.id),e},k=async()=>{try{const e=await l(`${r}/availability`);return{fullyBookedDates:Array.isArray(e.fullyBookedDates)?e.fullyBookedDates:[],bookedSlots:Array.isArray(e.bookedSlots)?e.bookedSlots:[]}}catch(e){return console.warn("Availability API fallback ke config default:",e),{fullyBookedDates:Array.from(f),bookedSlots:Array.from(w)}}},$=async e=>{await l(`${r}/availability`,{method:"PUT",body:JSON.stringify({fullyBookedDates:e.fullyBookedDates??[],bookedSlots:e.bookedSlots??[]})})};async function _(e,t,n){const a=new FormData;a.append("form_id",String(e)),a.append("type",t),a.append("file",n);const o=await fetch(`${r}/booking-photo-upload`,{method:"POST",credentials:"include",body:a}),s=await o.json().catch(()=>null);if(!o.ok){const i=(s==null?void 0:s.message)||(s==null?void 0:s.error)||`Upload gagal (status ${o.status})`;throw new Error(i)}return(s==null?void 0:s.data)??s}function A(e){return e?/^https?:\/\//i.test(e)?e:`${p}${e}`:null}export{$,A,S,_,b,k,v,y};
