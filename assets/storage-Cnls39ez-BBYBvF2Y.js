const m=t=>{const e=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${e}-${a}-${n}`},f=new Date(new Date().setDate(new Date().getDate()+1)),w=new Date(new Date().setDate(new Date().getDate()+5)),h=new Set([`${m(f)}-10:30`]),D=new Set([m(w)]),p="https://api-homeservice.viniela.id",l=`${p}/api/v1/admin`;async function g(t,e={}){const a=await fetch(t,{...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers||{}}}),n=await a.json().catch(()=>null);if(!a.ok){const i=`Request gagal (status ${a.status})`;throw new Error(i)}return(n==null?void 0:n.data)??n}const _=t=>{const e=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${e}-${a}-${n}`},S=t=>{const[e,a,n]=t.split("-").map(Number);return new Date(e,a-1,n)},b=(t,e,a,n,i)=>{const r=[],o=new Date;o.setHours(t,0,0,0);const c=new Date;c.setHours(e,0,0,0);const d=new Date;d.setHours(a,0,0,0);const u=new Date;for(u.setHours(n,0,0,0);o<c;)(o<d||o>=u)&&r.push(o.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),o.setMinutes(o.getMinutes()+i);return r};function y(t){const e=(t||"").toLowerCase().trim();return e==="confirmed"||e.includes("confirm")?"Confirmed":e==="onsite"||e==="on site"||e.includes("on site")||e.includes("onsite")||e.includes("arrive")?"On Site":e==="inprogress"||e==="in progress"||e.includes("progress")?"In Progress":e==="completed"||e.includes("complete")||e.includes("done")||e.includes("selesai")?"Completed":e==="cancelled"||e==="canceled"||e.includes("cancel")||e.includes("batal")?"Cancelled":"Confirmed"}function s(t,e=0){const a=Number(t);return Number.isFinite(a)?a:e}const k=async()=>{const t=(await g(`${l}/user-booking-list`)||[]).map(e=>{const a=new Date(e.schedule_date).toISOString(),n=e.lat==null?0:s(e.lat,0),i=e.lng==null?0:s(e.lng,0),r=e.technician_id==null?null:s(e.technician_id,0),o=e.apply_id??null;return{id:Number(o??e.form_id),formId:Number(e.form_id),applyId:o,name:e.customer_name,whatsapp:e.customer_wa,address:e.address,service:e.service,startDate:a,endDate:a,time:e.schedule_time,status:y(e.status),technician:e.technician_name||"Belum Ditugaskan",technicianId:r,technicianUsername:e.technician_username??null,lat:n,lng:i,note:e.note||"",additionalCosts:e.additional_cost==null?0:s(e.additional_cost,0),photos:{arrival:e.arrive_photo||void 0,before:e.before_photo||void 0,after:e.after_photo||void 0},arrivalTime:e.arrival_time,startTime:e.start_time,endTime:e.end_time,workDurationMinutes:e.work_duration_minutes}});return t.sort((e,a)=>new Date(a.startDate).getTime()-new Date(e.startDate).getTime()||(a.applyId??a.formId)-(e.applyId??e.formId)),t},v=async()=>{try{const t=await g(`${l}/availability`);return{fullyBookedDates:Array.isArray(t.fullyBookedDates)?t.fullyBookedDates:[],bookedSlots:Array.isArray(t.bookedSlots)?t.bookedSlots:[]}}catch(t){return console.warn("Availability API fallback ke config default:",t),{fullyBookedDates:Array.from(D),bookedSlots:Array.from(h)}}};async function $(t,e,a){const n=new FormData;n.append("form_id",String(t)),n.append("type",e),n.append("file",a);const i=await fetch(`${l}/booking-photo-upload`,{method:"POST",credentials:"include",body:n}),r=await i.json().catch(()=>null);if(!i.ok){const o=`Upload gagal (status ${i.status})`;throw new Error(o)}return(r==null?void 0:r.data)??r}function I(t){return t?/^https?:\/\//i.test(t)?t:`${p}${t}`:null}export{$,I as A,_ as S,S as _,k as b,b as k,v};
