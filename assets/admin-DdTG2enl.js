const g="https://api-homeservice.viniela.id";function v(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${a}`}function S(t,e){if(/^https?:\/\//i.test(t))return t;const n=(e??g).replace(/\/+$/,""),a=t.startsWith("/")?t:`/${t}`;return`${n}${a}`}async function r(t,e={}){const n=S(t,e.baseUrl),a=await fetch(n,{credentials:"include",...e,headers:{Accept:"application/json",...e.headers||{}}}),c=(a.headers.get("content-type")||"").includes("application/json")?await a.json().catch(()=>null):await a.text().catch(()=>null);if(!a.ok){const l=c&&(c.message||c.error)||`Request gagal (${a.status}) ${a.statusText}`;throw new Error(l)}return c}async function u(t){var n;const e=await r(t,{method:"GET"});return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray((n=e==null?void 0:e.data)==null?void 0:n.rows)?e.data.rows:[]}const i="/api/v1/admin",s={users:`${i}/user-management-list`,userDelete:`${i}/user-management-delete`,roles:`${i}/user-role-list`,serviceCategories:`${i}/service-category-list`,bookings:`${i}/user-booking-list`,services:`${i}/service-list`,updateBookingStatus:`${i}/update-booking-status`,techSchedule:`${i}/tech-schedule`,serviceCreate:`${i}/service-store`,serviceUpdate:`${i}/service-update`,serviceDelete:`${i}/service-delete`,storeBooking:`${i}/store-booking`,availabilityGet:`${i}/availability`,availabilityUpdate:`${i}/availability-update`},b={INPROGRESS:"In Progress",IN_PROGRESS:"In Progress",DONE:"Completed",COMPLETED:"Completed",CANCELLED:"Cancelled",CANCELED:"Cancelled",ONSITE:"On Site",ON_SITE:"On Site"},A=t=>b[(t||"").toUpperCase()]??"Confirmed",k={Confirmed:"1","On Site":"2","In Progress":"3",Completed:"4",Cancelled:"5"},O={unit:"unit",jam:"jam",hour:"jam",hours:"jam",kg:"kg",m2:"m²","m²":"m²"};function m(t){const e=(t??"").toString().toLowerCase();return O[e]??"unit"}function _(t){const e=t.duration_minute,n=t.duration_hour;if(typeof e=="number"||typeof n=="number"){const a=e??(n??0)*60,o=n??Math.floor(a/60);return{durationMinutes:a,durationHours:o}}return{durationMinutes:0,durationHours:0}}async function T(){return(await u(s.users)).map(e=>({id:e.id,name:e.fullname,username:e.username,role:e.role,created_at:e.created_at}))}async function E(){return(await u(s.roles)).map(e=>({id:e.id,name:e.name}))}async function I(t){const e={id:t};await r(s.userDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function $(){return(await u(s.serviceCategories)).map(e=>({id:e.id,name:e.name}))}async function N(){return(await u(s.bookings)).map(e=>{const n=e.schedule_date,a=A(e.status);return{id:Number(e.form_id),formId:e.form_id,applyId:e.apply_id,name:e.customer_name,whatsapp:e.customer_wa,service:e.service,address:e.address,startDate:n,endDate:n,time:e.schedule_time,technician:e.technician_name||"Belum Ditugaskan",technicianUserId:e.technician_id??null,status:a,lat:Number(e.lat),lng:Number(e.lng),arrival_time:e.arrival_time,start_time:e.start_time,end_time:e.end_time,work_duration_minutes:e.work_duration_minutes,additional_cost:e.additional_cost&&Number(e.additional_cost)||0,note:e.note||"",photos:{arrival:e.arrive_photo||void 0,before:e.before_photo||void 0,after:e.after_photo||void 0}}})}async function D(){return(await u(s.services)).map(e=>{const n=m(e.unit_price);return{id:e.id,name:e.name,price:e.price,unit_price:n,service_category:e.service_category,category:e.category,duration_minute:e.duration_minute,duration_hour:e.duration_hour,point:e.point,is_guarantee:e.is_guarantee}})}async function U(t,e,n){const a=k[e];if(!a)throw new Error(`Kode status belum di-mapping untuk status: ${e}`);const o={form_id:String(t),status:a,user_id:n};await r(s.updateBookingStatus,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}async function P(t){const e=v(t);return(await u(`${s.techSchedule}?schedule_date=${encodeURIComponent(e)}`)).map(a=>({user_id:a.user_id,fullname:a.fullname,schedules:Array.isArray(a.schedules)?a.schedules:Array.isArray(a.schedules_json)?a.schedules_json:[]}))}async function j(t){const e=await r(s.storeBooking,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return{error:!!(e!=null&&e.error),message:(e==null?void 0:e.message)??"",data:e==null?void 0:e.data}}async function B(t,e,n){const a=t,{durationMinutes:o,durationHours:c}=_(a),l=n.find(p=>p.id===a.service_category)||n.find(p=>p.name===e),f=(l==null?void 0:l.id)??a.service_category??null,h={name:a.name,price:String(a.price??0),unit_price:m(a.unit_price),point:a.point??0,service_category:f,duration_minute:o,duration_hour:c,is_guarantee:a.is_guarantee??!1},d=await r(s.serviceCreate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),y=(d==null?void 0:d.data)&&d.data.id||(d==null?void 0:d.id)||null;return typeof y=="number"?y:null}async function R(t,e){const n=e,{durationMinutes:a,durationHours:o}=_(n),c={id:t,name:n.name,price:String(n.price??0),unit_price:m(n.unit_price),service_category:n.service_category,duration_minute:a,duration_hour:o,is_guarantee:n.is_guarantee??!1};await r(s.serviceUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}async function F(t){const e={id:String(t)};await r(s.serviceDelete,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}function C(t){const e=(t==null?void 0:t.data)??t;return{fullyBookedDates:Array.isArray(e==null?void 0:e.fully_booked_dates)?e.fully_booked_dates:[],bookedSlots:Array.isArray(e==null?void 0:e.booked_slots)?e.booked_slots:[]}}async function M(){const t=await r(s.availabilityGet,{method:"GET"});return C(t)}async function J(t){const e={fully_booked_dates:t.fullyBookedDates,booked_slots:t.bookedSlots};await r(s.availabilityUpdate,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}export{k as B,v as a,N as b,T as c,E as d,$ as e,D as f,M as g,P as h,B as i,U as j,F as k,I as l,A as m,J as n,j as s,R as u};
