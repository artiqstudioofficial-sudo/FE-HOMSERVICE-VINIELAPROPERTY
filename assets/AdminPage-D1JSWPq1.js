import{c as z,r,j as e,X as Le,d as wa,e as Sa}from"./index-C5a0cNS1.js";import{a as Ue,f as U,p as ke}from"./storage-EbjkSq6s.js";import{C as Ne}from"./Calendar-BlNZk7MG.js";import{L as Ca,M as Da,a as Ma,b as Aa,G as je}from"./GenericConfirmationModal-CXO02lME.js";import{f as Re,b as Ta,c as Ba,d as Ia,e as Oa,g as $a,h as Pa,m as _a,B as Pe,s as La,u as Ua,i as Ra,j as Fa,k as Ha,l as Ea,n as za}from"./admin-BsQ7Zl7q.js";import{T as Fe}from"./trash-2-CLRFtjlP.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=z("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=z("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=z("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=z("PencilLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=z("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=z("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=z("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),E={lat:-6.175392,lng:106.827153,mapSrc:"https://maps.google.com/maps?q=-6.175392,106.827153&z=16&output=embed"},Xa=({isOpen:t,onClose:l,onSave:h,services:s,technicians:u,availability:c})=>{const[i,k]=r.useState({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),[v,B]=r.useState({lat:E.lat,lng:E.lng}),[p,N]=r.useState({}),[I,y]=r.useState(E.mapSrc),w=c||{fullyBookedDates:[],bookedSlots:[]},O=r.useMemo(()=>new Set(w.fullyBookedDates||[]),[w.fullyBookedDates]),d=r.useMemo(()=>new Set(w.bookedSlots||[]),[w.bookedSlots]),M=r.useMemo(()=>Ue(9,17,12,13,30),[]);r.useEffect(()=>{t&&(k({name:"",whatsapp:"",address:"",service:"",startDate:null,endDate:null,time:"",technician:"",status:"Confirmed"}),N({}),B({lat:E.lat,lng:E.lng}),y(E.mapSrc))},[t]);const f=m=>{const{name:C,value:g}=m.target;N($=>({...$,[C]:void 0})),k($=>({...$,[C]:g}))},_=m=>{const C=new Date(m);C.setDate(C.getDate()),k(g=>({...g,startDate:m,endDate:C,time:""})),N(g=>({...g,startDate:void 0,time:void 0}))},R=()=>{const m={};return i.name.trim()||(m.name="Nama wajib diisi."),i.whatsapp.trim()||(m.whatsapp="Nomor WhatsApp wajib diisi."),i.address.trim()||(m.address="Alamat wajib diisi."),i.service||(m.service="Layanan wajib dipilih."),i.startDate||(m.startDate="Tanggal wajib dipilih."),i.time||(m.time="Waktu wajib dipilih."),N(m),Object.keys(m).length===0},S=m=>{if(m.preventDefault(),!R()||!i.startDate)return;const C=i.startDate.toISOString().slice(0,10),g=Number(i.service),$=i.technician&&i.technician!==""?Number(i.technician):null,L={fullname:i.name,whatsapp:i.whatsapp,address:i.address,service:g,user_id:$,status:i.status,lat:v.lat,lng:v.lng,schedule_date:C,schedule_time:i.time};h(L)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-5xl transform transition-all",onClick:m=>m.stopPropagation(),children:e.jsxs("form",{onSubmit:S,noValidate:!0,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Tambah Booking Manual"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Le,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Pelanggan"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),p.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",name:"whatsapp",value:i.whatsapp,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),p.whatsapp&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.whatsapp})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alamat Lengkap"}),e.jsx("textarea",{name:"address",rows:2,value:i.address,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),p.address&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.address})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Layanan"}),e.jsxs("select",{name:"service",value:i.service,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",disabled:!0,children:"-- Pilih Layanan --"}),s.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]}),p.service&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.service})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Teknisi"}),e.jsxs("select",{name:"technician",value:i.technician,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Belum Ditugaskan"}),u.map(m=>e.jsx("option",{value:m.id,children:m.name||m.fullname||m.username},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status Awal"}),e.jsx("select",{name:"status",value:i.status,onChange:f,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:["Confirmed","On Site","In Progress","Completed","Cancelled"].map(m=>e.jsx("option",{value:m,children:m},m))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Jadwal"}),e.jsx(Ne,{selectedDate:i.startDate,onDateSelect:_,fullyBookedDates:O}),p.startDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.startDate})]}),i.startDate?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:M.map(m=>{const C=`${U(i.startDate)}-${m}`,g=d.has(C);return e.jsx("button",{type:"button",onClick:()=>k($=>({...$,time:m})),disabled:g,className:`p-2 rounded-md text-sm font-semibold border-2 transition-colors ${i.time===m?"bg-primary text-white border-primary":"bg-transparent border-gray-300 dark:border-slate-600"} ${g?"bg-gray-200 dark:bg-slate-600 text-gray-400 dark:text-gray-500 line-through cursor-not-allowed":"hover:border-primary"}`,children:m},m)})}),p.time&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.time})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Waktu Mulai"}),e.jsx("div",{className:"h-48 flex items-center justify-center bg-gray-50 dark:bg-slate-700/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Pilih tanggal dahulu"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lokasi (sementara default: Monas, Jakarta)"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Untuk sekarang, lokasi booking akan tersimpan di sekitar Monas (lat: ",E.lat,", lng: ",E.lng,")."]}),e.jsx("div",{className:"mt-2 h-64 w-full rounded-lg overflow-hidden border dark:border-slate-600",children:e.jsx("iframe",{title:"Booking Location Default Monas",width:"100%",height:"100%",style:{border:0},src:I,allowFullScreen:!1,loading:"lazy"},I)})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-500",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan Booking"})]})]})})}):null},Qa=["unit","jam","kg","m²"],Za=({isOpen:t,onClose:l,onSave:h,serviceToEdit:s,categoryToEdit:u,serviceCategories:c})=>{const i=!!s,[k,v]=r.useState(""),[B,p]=r.useState(""),[N,I]=r.useState("unit"),[y,w]=r.useState(""),[O,d]=r.useState(""),[M,f]=r.useState(""),[_,R]=r.useState(""),[S,m]=r.useState(!1),[C,g]=r.useState(""),[$,L]=r.useState(!1),G=r.useMemo(()=>c,[c]);r.useEffect(()=>{if(t)if(s){v(s.name??""),p(typeof s.price=="number"?String(s.price):s.price??""),I(s.unit_price||"unit"),s.service_category?w(String(s.service_category)):w(""),d(u||s.category||"");const b=s.duration_minute,P=s.duration_hour;f(typeof b=="number"&&b>0?String(b):""),R(typeof P=="number"&&P>0?String(P):"");const H=s.point;g(typeof H=="number"?String(H):"");const F=s.is_guarantee;m(!!F)}else v(""),p(""),I("unit"),w(""),d(""),f(""),R(""),m(!1),g("")},[t,s,u]);const K=b=>{const P=b.target.value;w(P);const H=Number(P),F=c.find(ae=>ae.id===H);F&&d(F.name)},W=b=>{const P=b.target.value;d(P),P||w("")},q=async b=>{if(b.preventDefault(),!!k.trim()&&B.trim()&&O.trim()){L(!0);try{const P=y?Number(y):(s==null?void 0:s.service_category)??0,F={...{...s?{id:s.id}:{},id:s?s.id:"",name:k.trim(),price:B.trim(),unit_price:N,service_category:P,category:O.trim()},duration_minute:M?Number(M):void 0,duration_hour:_?Number(_):void 0,point:C?Number(C):void 0,is_guarantee:S};h(F,y)}finally{L(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-lg",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:i?"Edit Layanan":"Tambah Layanan"}),e.jsx("button",{type:"button",onClick:l,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:"✕"})]}),e.jsxs("form",{onSubmit:q,className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Nama Layanan"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:k,onChange:b=>v(b.target.value),placeholder:"Contoh: Cuci AC 1 PK",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Harga (IDR)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:B,onChange:b=>p(b.target.value),placeholder:"Contoh: 150000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Satuan Harga"}),e.jsx("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:N,onChange:b=>I(b.target.value),children:Qa.map(b=>e.jsx("option",{value:b,children:b},b))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Kategori Layanan"}),e.jsxs("select",{className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary mb-2",value:y,onChange:K,children:[e.jsx("option",{value:"",children:"-- Pilih kategori --"}),G.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-dashed border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-xs text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-1 focus:ring-primary",placeholder:"Label kategori untuk tampilan (opsional)",value:O,onChange:W})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (menit)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:M,onChange:b=>f(b.target.value),placeholder:"Contoh: 60"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Durasi (jam)"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:_,onChange:b=>R(b.target.value),placeholder:"Opsional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Point"}),e.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 px-3 py-2 text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary",value:C,onChange:b=>g(b.target.value),placeholder:"Opsional"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isGuarantee",type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary",checked:S,onChange:b=>m(b.target.checked)}),e.jsx("label",{htmlFor:"isGuarantee",className:"text-sm text-slate-700 dark:text-slate-200",children:"Layanan bergaransi"})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",disabled:$,children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark disabled:opacity-60",disabled:$,children:$?"Menyimpan...":i?"Simpan Perubahan":"Tambah Layanan"})]})]})]})}):null},et=({booking:t})=>{const l=s=>s.startsWith("0")?`62${s.substring(1)}`:s,h=()=>{const s=l(t.whatsapp),u=new Date(t.startDate).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),c=`Halo ${t.name}, kami dari Viniela Home & Service ingin mengkonfirmasi pesanan Anda:

*Layanan:* ${t.service}
*Jadwal:* ${u}, pukul ${t.time}
*Alamat:* ${t.address}

Mohon balas pesan ini untuk mengkonfirmasi detail di atas sudah benar. Terima kasih.`;return`https://wa.me/${s}?text=${encodeURIComponent(c)}`};return e.jsxs("a",{href:h(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-green-600 transition-colors",title:`Chat ${t.name} di WhatsApp`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.459l-6.354 1.654zm.791-6.938c.323.517.76 1.002 1.251 1.431.987.842 2.197 1.298 3.51 1.298 5.421 0 9.811-4.39 9.811-9.811 0-2.651-1.04-5.14-2.9-7.001-1.859-1.86-4.35-2.901-7.001-2.901-5.42 0-9.81 4.39-9.81 9.81 0 2.05.61 3.992 1.698 5.688l-.299 1.093zM9.262 7.176c-.23-.487-.474-.487-.698-.487-.203 0-.428.02-.638.211-.23.19-.813.78-.813 1.901 0 1.12.831 2.201.946 2.36.116.161 1.638 2.542 4.004 3.53.585.24 1.045.38 1.41.496.535.169.97.143 1.324-.087.419-.27.813-.981.928-1.342.116-.361.116-.671.083-.758-.032-.087-.23-.142-.487-.27-.257-.128-1.515-.748-1.758-.831-.243-.083-.419-.083-.595.083-.176.166-.66.831-.813.981-.152.152-.291.178-.487.05-.196-.128-.831-.289-1.587-.961-.595-.541-.97-1.221-1.085-1.428-.116-.208-.017-.323.07-.43.087-.107.196-.178.291-.269.1-.096.143-.15.211-.243.068-.092.032-.178-.017-.258-.05-.082-.464-1.113-.638-1.515z"})}),"Chat"]})};function at(t){if(!t)return"-";if(typeof t=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);const h=new Date(t);return Number.isNaN(h.getTime())?t:h.toISOString().slice(0,10)}const l=t;return Number.isNaN(l.getTime())?"-":l.toISOString().slice(0,10)}const tt=({paginatedBookings:t,currentPage:l,totalPages:h,goToPage:s,searchTerm:u,setSearchTerm:c,statusFilter:i,setStatusFilter:k,technicianFilter:v,setTechnicianFilter:B,technicians:p,statuses:N,statusDraft:I,setStatusDraft:y,onStatusSubmit:w,onTechnicianChange:O})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[e.jsx("input",{value:u,onChange:d=>c(d.target.value),placeholder:"Cari nama pelanggan...",className:"w-full md:w-1/3 rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:i,onChange:d=>k(d.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Status"}),N.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsxs("select",{value:v,onChange:d=>B(d.target.value),className:"rounded-lg border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-sm",children:[e.jsx("option",{value:"all",children:"Semua Teknisi"}),e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),p.map(d=>e.jsx("option",{value:String(d.id),children:d.name},d.id))]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700 text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Layanan"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jadwal"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Teknisi"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[t.map(d=>{const M=at(d.startDate);return e.jsxs("tr",{className:"border-t border-gray-100 dark:border-slate-700",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:d.name}),e.jsx("div",{className:"text-xs text-gray-500",children:d.whatsapp})]}),e.jsx("td",{className:"px-4 py-3",children:d.service}),e.jsxs("td",{className:"px-4 py-3",children:[M," • ",d.time]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:d.technicianUserId==null?"unassigned":String(d.technicianUserId),onChange:f=>O(d.id,"technician",f.target.value),className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs",children:[e.jsx("option",{value:"unassigned",children:"Belum Ditugaskan"}),p.map(f=>e.jsx("option",{value:String(f.id),children:f.name},f.id))]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("select",{value:I[d.id]??d.status,onChange:f=>y(_=>({..._,[d.id]:f.target.value})),className:"rounded-md border-gray-300 dark:bg-slate-700 dark:border-slate-600 text-xs",children:N.map(f=>e.jsx("option",{value:f,children:f},f))})}),e.jsxs("td",{className:"px-4 py-3 text-right space-x-2",children:[e.jsx("button",{onClick:()=>w(d.id),className:"px-3 py-1 text-xs rounded-lg bg-primary text-white",children:"Update"}),e.jsx(et,{booking:d})]})]},d.id)}),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada data booking."})})]})]})}),h>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(l-1),disabled:l===1,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Prev"}),e.jsxs("span",{className:"text-xs py-1",children:["Halaman ",l," dari ",h]}),e.jsx("button",{onClick:()=>s(l+1),disabled:l===h,className:"px-3 py-1 text-xs rounded-lg border disabled:opacity-50",children:"Next"})]})]}),st=({currentUserName:t,onOpenSidebar:l})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:l,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),rt=[{name:"Dashboard KPI",icon:Ka,section:"kpi"},{name:"Daftar Booking",icon:Ca,section:"bookings"},{name:"Jadwal Teknisi",icon:Ga,section:"schedule"},{name:"Peta Lokasi",icon:Da,section:"map"},{name:"Manajemen Tim/User",icon:Va,section:"technicians"},{name:"Manajemen Layanan",icon:ve,section:"services"},{name:"Atur Ketersediaan",icon:ve,section:"availability"}],nt=({activeSection:t,onSectionChange:l,isOpen:h,onClose:s,onLogout:u})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${h?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Admin Viniela"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:rt.map(c=>e.jsxs("button",{onClick:()=>{l(c.section),s()},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${t===c.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(c.icon,{size:20}),c.name]},c.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(Ma,{size:20}),"Logout"]})})]}),lt=({isOpen:t,onClose:l,onSave:h,technicianToEdit:s,existingUsernames:u,roles:c})=>{const[i,k]=r.useState({}),[v,B]=r.useState({});r.useEffect(()=>{var y,w;if(t){const O=(s==null?void 0:s.role)||((y=c.find(d=>d.name==="technician"))==null?void 0:y.name)||((w=c[0])==null?void 0:w.name)||"";k(s?{...s,password:""}:{name:"",username:"",role:O,password:""}),B({})}},[t,s,c]);const p=y=>{const{name:w,value:O}=y.target;k(d=>({...d,[w]:O})),v[w]&&B(d=>({...d,[w]:""}))},N=()=>{var w,O,d,M;const y={};return(w=i.name)!=null&&w.trim()||(y.name="Nama wajib diisi."),(O=i.username)!=null&&O.trim()||(y.username="Username wajib diisi."),(d=i.role)!=null&&d.trim()||(y.role="Peran wajib diisi."),s||((M=i.password)!=null&&M.trim()||(y.password="Password wajib diisi untuk user baru."),u.includes(i.username.trim())&&(y.username="Username sudah digunakan.")),B(y),Object.keys(y).length===0},I=y=>{y.preventDefault(),N()&&h({...i})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",onClick:l,children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg transform transition-all",onClick:y=>y.stopPropagation(),children:e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:s?"Edit User":"Tambah User Baru"}),e.jsx("button",{type:"button",onClick:l,className:"p-2 rounded-full text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-700",children:e.jsx(Le,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nama Lengkap"}),e.jsx("input",{type:"text",name:"name",value:i.name||"",onChange:p,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),v.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:i.username||"",onChange:p,readOnly:!!s,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary read-only:bg-gray-100 dark:read-only:bg-slate-600"}),v.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.username})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role User"}),e.jsxs("select",{name:"role",value:i.role||"",onChange:p,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Pilih role"}),c.map(y=>e.jsx("option",{value:y.name,children:y.name},y.id))]}),v.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.role})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:i.password||"",onChange:p,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary"}),v.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:v.password}),s&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Kosongkan jika tidak ingin mengubah password."})]})]}),e.jsxs("div",{className:"p-6 bg-light-bg dark:bg-slate-800/50 border-t border-gray-200 dark:border-slate-700 rounded-b-2xl flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-200 text-gray-800 dark:bg-slate-600 dark:text-gray-200 font-bold px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-slate-5 00",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark",children:"Simpan"})]})]})})}):null},it=({availableTimes:t,selectedDate:l,onSelectedDateChange:h,draftFullyBooked:s,draftBookedSlots:u,onToggleFullDay:c,onToggleSlot:i,onRemoveBlockedDate:k,hasUnsavedChanges:v,showSaveSuccess:B,onSaveChanges:p})=>e.jsxs("div",{children:[e.jsxs("div",{className:"sticky top-4 lg:top-20 z-10 flex justify-end items-center mb-4 p-3 bg-light-bg/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-lg",children:[B&&e.jsx("span",{className:"text-green-600 font-semibold mr-4",children:"Perubahan berhasil disimpan!"}),e.jsx("button",{onClick:p,disabled:!v,className:"bg-primary text-white font-bold px-6 py-2 rounded-lg hover:bg-primary-dark transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Simpan Perubahan"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk mengatur slot waktu atau memblokir sepanjang hari."}),e.jsx(Ne,{selectedDate:l,onDateSelect:N=>h(N),fullyBookedDates:s})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-1 xl:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Atur Slot Waktu"}),l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"font-semibold text-lg text-secondary dark:text-slate-300",children:l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("button",{onClick:c,className:`px-3 py-1.5 text-xs font-bold rounded-full ${s.has(U(l))?"bg-red-100 text-red-700":"bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-200"}`,children:s.has(U(l))?"Buka Blokir Hari Ini":"Blokir Seharian"})]}),e.jsx("div",{className:`grid grid-cols-3 sm:grid-cols-4 gap-3 ${s.has(U(l))?"opacity-40 pointer-events-none":""}`,children:t.map(N=>{const I=`${U(l)}-${N}`,y=u.has(I);return e.jsx("button",{onClick:()=>i(N),className:`text-center font-semibold px-4 py-2.5 rounded-lg border-2 transition-colors duration-200 ${y?"bg-red-500 border-red-500 text-white":"bg-white dark:bg-slate-700 border-gray-200 dark:border-gray-600 hover:border-primary"}`,children:N},N)})}),s.has(U(l))&&e.jsx("p",{className:"text-center mt-4 text-sm text-red-500 font-medium",children:"Semua slot tidak tersedia karena hari ini diblokir."})]}):e.jsx("div",{className:"text-center py-20 text-gray-500 dark:text-gray-400",children:"Pilih tanggal dari kalender untuk memulai."})]}),e.jsxs("div",{className:"col-span-1 lg:col-span-2 xl:col-span-3 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Daftar Tanggal yang Diblokir Penuh"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Berikut adalah daftar tanggal yang telah Anda tandai sebagai penuh (tidak termasuk slot individual)."}),Array.from(s).length>0?e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:Array.from(s).sort((N,I)=>ke(N).getTime()-ke(I).getTime()).map(N=>e.jsxs("li",{className:"flex justify-between items-center bg-light-bg dark:bg-slate-700 p-3 rounded-lg",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:ke(N).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("button",{onClick:()=>k(N),className:"text-red-500 hover:text-red-700 text-sm font-bold",children:"Hapus"})]},N))}):e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Tidak ada tanggal yang diblokir penuh."})]})]})]}),dt=({data:t,title:l})=>{const h=Math.max(...t.map(u=>u.value),1),s=["#14B8A6","#2DD4BF","#5EEAD4","#99F6E4","#CCFBF1"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsx("div",{className:"space-y-3",children:t.map((u,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-200 truncate pr-2",children:u.label}),e.jsx("span",{className:"font-bold text-primary",children:u.value})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-4 rounded-full",style:{width:`${u.value/h*100}%`,backgroundColor:s[c%s.length]},title:`${u.label}: ${u.value}`})})]},u.label))})]})},_e={Confirmed:"#3B82F6","On Site":"#06B6D4","In Progress":"#EAB308",Completed:"#22C55E",Cancelled:"#9CA3AF"},ot=({data:t,title:l})=>{const h=t.reduce((c,i)=>c+i.value,0);if(h===0)return null;let s=0;const u=t.map(c=>{const i=_e[c.label]||"#CCCCCC",k=c.value/h*100,v=s;return s+=k,`${i} ${v}% ${s}%`});return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white mb-4",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsx("div",{className:"w-40 h-40 rounded-full mx-auto",style:{background:`conic-gradient(${u.join(", ")})`}}),e.jsx("div",{className:"space-y-2",children:t.map(c=>{const i=_e[c.label]||"#9CA3AF";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:i}}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:c.label})]}),e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:c.value})]},c.label)})})]})]})},ct=t=>{if(!t)return"-";if(t<60)return`${t} mnt`;const l=Math.floor(t/60),h=t%60;return h===0?`${l} jam`:`${l} jam ${h} mnt`},mt=({kpiData:t})=>{var u;const l=((u=t==null?void 0:t.popularServices)==null?void 0:u.length)??0,h=((t==null?void 0:t.popularServices)??[]).reduce((c,i)=>c+(Number(i.value)||0),0),s=l>0?`${l} Layanan Terlaris (Selesai) • Total ${h} selesai`:"Layanan Terlaris (Selesai)";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(dt,{data:t.popularServices,title:s}),e.jsx(ot,{data:t.statusDistribution,title:"Distribusi Status Pesanan"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Performa Teknisi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.technicianPerformance.length>0?t.technicianPerformance.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-800 dark:text-white",children:c.name}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pekerjaan Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:c.completed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Waktu Kerja"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:ct(c.totalMinutes)})]})]})]},c.name)):e.jsx("p",{className:"col-span-full text-center py-10 text-gray-500 dark:text-gray-400",children:"Belum ada data KPI yang bisa ditampilkan."})})]})]})},ut=({upcomingJobs:t,selectedLocation:l,onSelectLocation:h})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white p-2 sticky top-0 bg-white dark:bg-slate-800 z-10",children:"Pekerjaan Akan Datang"}),t.length>0?t.map(s=>e.jsxs("button",{onClick:()=>h({lat:s.lat,lng:s.lng,title:s.name}),className:`w-full text-left p-4 rounded-lg transition-all duration-200 border-l-4 ${(l==null?void 0:l.title)===s.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent hover:bg-gray-50 dark:hover:bg-slate-700/50 border-transparent"}`,children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300",children:s.service}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:s.address}),e.jsxs("div",{className:"text-sm font-semibold text-primary mt-2",children:[new Date(s.startDate).toLocaleDateString("id-ID",{day:"numeric",month:"long"})," ","- ",s.time]})]},s.id)):e.jsx("p",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada pekerjaan akan datang."})]}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-slate-700 flex-shrink-0",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:["Lokasi: ",l.title]}),e.jsxs("a",{href:`https://www.google.com/maps?q=${l.lat},${l.lng}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:["Buka di Google Maps ",e.jsx(qa,{size:14})]})]}),e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${l.lat},${l.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${l.lat}-${l.lng}`)]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(Aa,{className:"mb-4 text-gray-300 dark:text-gray-600",size:48}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Pekerjaan"}),e.jsx("p",{children:"Pilih pekerjaan dari daftar untuk melihat lokasinya di peta."})]})})]}),xt={Confirmed:"bg-blue-500 border-blue-700","On Site":"bg-cyan-500 border-cyan-700","In Progress":"bg-yellow-500 border-yellow-700",Completed:"bg-green-500 border-green-700",Cancelled:"bg-gray-400 border-gray-600"},ht=({bookings:t,selectedDate:l,technicians:h})=>{const[k,v]=r.useState(()=>new Map),[B,p]=r.useState(!1),[N,I]=r.useState(null);r.useEffect(()=>{(async()=>{try{p(!0),I(null);const M=await Re(),f=new Map;M.forEach(_=>{f.set(_.name,_)}),v(f)}catch(M){console.error("Gagal memuat services dari API:",M),I("Gagal memuat data layanan dari server.")}finally{p(!1)}})()},[]);const y=r.useMemo(()=>{const d=U(l);return t.filter(M=>{const f=U(new Date(M.startDate)),_=U(new Date(M.endDate));return d>=f&&d<=_&&M.status!=="Cancelled"})},[t,l]),w=Array.from({length:10},(d,M)=>8+M),O=d=>d>80?"bg-red-500":d>50?"bg-yellow-400":"bg-green-500";return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:["Jadwal Teknisi untuk"," ",l.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"})]}),B&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Memuat data layanan..."}),N&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 mb-2",children:N}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px]",children:[e.jsxs("div",{className:"flex border-b-2 border-gray-200 dark:border-slate-700 pb-2",children:[e.jsx("div",{className:"w-48 flex-shrink-0"}),e.jsx("div",{className:"flex-1 grid grid-cols-10",children:w.map(d=>e.jsxs("div",{className:"text-center text-xs font-semibold text-gray-500 dark:text-gray-400",children:[String(d).padStart(2,"0"),":00"]},d))})]}),h.map(d=>{const M=y.filter(S=>S.technician===d.name),f=M.reduce((S,m)=>{const C=k.get(m.service);if(!C)return S;const g=C.duration_days&&C.duration_days>1,$=U(new Date(m.startDate))===U(l);if(g&&!$)return S+540;const L=C.duration??60;return S+L},0),_=Math.min(f/540*100,100),R=O(_);return e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-slate-700/50",children:[e.jsxs("div",{className:"w-48 flex-shrink-0 py-3 px-2 border-r border-gray-100 dark:border-slate-700/50",children:[e.jsx("p",{className:"font-semibold text-sm text-gray-700 dark:text-gray-200 truncate",children:d.name}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-medium text-gray-500 dark:text-gray-400 mb-0.5",children:[e.jsx("span",{children:"Beban Kerja"}),e.jsxs("span",{children:[(f/60).toFixed(1)," /"," ",540/60," jam"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-slate-700",title:`${_.toFixed(0)}% terisi`,children:e.jsx("div",{className:`${R} h-2 rounded-full transition-all duration-500`,style:{width:`${_}%`}})})]})]}),e.jsxs("div",{className:"flex-1 h-20 relative",children:[w.map(S=>e.jsx("div",{className:"absolute h-full border-l border-gray-100 dark:border-slate-700/50",style:{left:`${(S-8)/10*100}%`}},`line-${S}`)),M.map(S=>{const m=k.get(S.service),C=S.startDate!==S.endDate,g=U(new Date(S.startDate))===U(l);let $,L;if(C&&!g)$=0,L=600;else{const[q,b]=S.time.split(":").map(Number);$=(q-8)*60+(b||0),L=m?m.duration??60:60}const G=$/600*100,K=L/600*100;if(G<0||G>=100)return null;const W=xt[S.status]||"bg-gray-500 border-gray-700";return e.jsxs("div",{className:`absolute top-2 h-16 ${W} rounded-lg p-2 text-white shadow-md overflow-hidden border-l-4`,style:{left:`${G}%`,width:`${K}%`},title:`${S.name} - ${S.service} @ ${S.time} [Status: ${S.status}]`,children:[e.jsx("p",{className:"text-xs font-bold truncate",children:S.name}),e.jsx("p",{className:"text-[10px] opacity-80 truncate",children:S.service})]},S.id)})]})]},d.id)})]})}),y.length===0&&!B&&e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal pekerjaan untuk tanggal ini."})]})},gt=({scheduleDate:t,onScheduleDateChange:l,isLoading:h,error:s,bookings:u,technicians:c})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-1",children:"Pilih Tanggal"}),e.jsx("p",{className:"text-sm text-secondary dark:text-slate-300 mb-4",children:"Pilih tanggal untuk melihat jadwal teknisi dari sistem backend."}),e.jsx(Ne,{selectedDate:t,onDateSelect:l,fullyBookedDates:new Set})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[h&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow rounded-xl p-3 text-sm text-gray-500 dark:text-gray-300",children:["Memuat jadwal teknisi untuk"," ",t.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),"..."]}),s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl p-3",children:s}),e.jsx(ht,{bookings:u,selectedDate:t,technicians:c})]})]})}),pt=({services:t,onAddService:l,onEditService:h,onRequestDelete:s})=>{const u=r.useMemo(()=>{const c=new Map;return t.forEach(i=>{const k=i.category||"Layanan Umum";c.has(k)||c.set(k,[]),c.get(k).push(i)}),Array.from(c.entries()).sort(([i],[k])=>i.localeCompare(k)).map(([i,k])=>({categoryName:i,services:k}))},[t]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Layanan"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(Wa,{size:20}),"Tambah Layanan"]})]}),u.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6 text-center text-gray-500 dark:text-gray-400",children:"Belum ada layanan. Silakan tambah layanan baru."}):e.jsx("div",{className:"space-y-8",children:u.map(c=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:c.categoryName}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:c.services.map(i=>{const k=Number(i.price)||0;return e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-full bg-primary/10 items-center justify-center text-primary text-sm font-bold uppercase",children:i.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rp",k.toLocaleString("id-ID")," /"," ",i.unit_price]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(i,c.categoryName),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit Layanan",children:e.jsx(ve,{size:18})}),e.jsx("button",{onClick:()=>s({serviceId:i.id,serviceName:i.name,categoryName:c.categoryName}),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus Layanan",children:e.jsx(Fe,{size:18})})]})]},i.id)})})]},c.categoryName))})]})},bt=({users:t,onAddTechnician:l,onEditTechnician:h,onRequestDelete:s})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white",children:"Manajemen Tim/User"}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(Ya,{size:20}),"Tambah User Baru"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-xl rounded-2xl",children:[e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:t.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:u.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:u.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["@",u.username," • ",u.role]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(u),className:"p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-slate-700 rounded-full",title:"Edit User",children:e.jsx(Ja,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>s(u),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-slate-700 rounded-full",title:"Hapus User",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]},u.id))}),t.length===0&&e.jsx("p",{className:"text-center py-10 text-gray-500",children:"Belum ada data user."})]})]}),yt=["Confirmed","On Site","In Progress","Completed","Cancelled"],St=()=>{const[t,l]=r.useState([]),[h,s]=r.useState([]),[u,c]=r.useState([]),[i,k]=r.useState([]),[v,B]=r.useState([]),[p,N]=r.useState("kpi"),[I,y]=r.useState(null),[w,O]=r.useState(1),[d,M]=r.useState(""),[f,_]=r.useState("all"),[R,S]=r.useState("all"),[m,C]=r.useState(!1),{addNotification:g}=wa(),{logout:$,currentUser:L}=Sa(),G=5,[K,W]=r.useState(new Set),[q,b]=r.useState(new Set),[P,H]=r.useState(new Set),[F,ae]=r.useState(new Set),[te,He]=r.useState(null),[Ee,ze]=r.useState(!1),[Ge,we]=r.useState(!1),[me,ue]=r.useState(null),[Ke,ie]=r.useState(!1),[J,Se]=r.useState(null),[We,Ce]=r.useState(null),[de,xe]=r.useState(null),[qe,he]=r.useState(!1),[Je,De]=r.useState(null),[Y,oe]=r.useState(null),[Ye,ge]=r.useState(!1),[se,Me]=r.useState({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""}),[ce,Ve]=r.useState(new Date),[re,Ae]=r.useState([]),[Xe,Te]=r.useState(!1),[Qe,Be]=r.useState(null),pe=G,[Ie,be]=r.useState({}),Ze=r.useMemo(()=>Ue(9,17,12,13,30),[]),Q=r.useMemo(()=>u.filter(a=>a.role==="technician"),[u]),ne=r.useCallback(async()=>{try{const a=await Ta();l(a)}catch(a){console.error("Gagal memuat data booking dari server",a),l([])}try{const a=await Re();s(a)}catch(a){console.error("Gagal memuat data layanan dari server",a),s([])}try{const a=await Ba();c(a)}catch(a){console.error("Gagal memuat data user dari server",a),c([])}try{const a=await Ia();k(a)}catch(a){console.error("Gagal memuat data role dari server",a),k([])}try{const a=await Oa();B(a)}catch(a){console.error("Gagal memuat master kategori layanan dari server",a),B([])}try{const a=await $a(),n=new Set(a.fullyBookedDates||[]),o=new Set(a.bookedSlots||[]);W(n),H(n),b(o),ae(o)}catch(a){console.error("Gagal memuat availability dari server",a),W(new Set),H(new Set),b(new Set),ae(new Set)}},[]),Oe=r.useCallback(async a=>{try{Te(!0),Be(null);const n=await Pa(a);Ae(n)}catch(n){console.error("Error loadTechSchedule:",n),Ae([]),Be((n==null?void 0:n.message)||"Gagal memuat jadwal teknisi")}finally{Te(!1)}},[]);r.useEffect(()=>(ne(),window.addEventListener("focus",ne),()=>{window.removeEventListener("focus",ne)}),[ne]),r.useEffect(()=>{be(a=>{const n={...a};return t.forEach(o=>{n[o.id]||(n[o.id]=o.status)}),n})},[t]),r.useEffect(()=>{const a=JSON.stringify(Array.from(K).sort())!==JSON.stringify(Array.from(P).sort()),n=JSON.stringify(Array.from(q).sort())!==JSON.stringify(Array.from(F).sort());ze(a||n)},[P,F,K,q]),r.useEffect(()=>{p==="schedule"&&ce&&Oe(ce)},[p,ce,Oe]);const ye=r.useMemo(()=>t.filter(a=>{const n=(d||"").toLowerCase(),A=((a==null?void 0:a.name)||"").toLowerCase().includes(n),T=f==="all"||a.status===f,D=R==="all"||a.technician===R;return A&&T&&D}).sort((a,n)=>n.id-a.id),[t,d,f,R]),ea=r.useMemo(()=>{const a=(w-1)*pe;return ye.slice(a,a+pe)},[ye,w]),$e=Math.ceil(ye.length/pe),aa=a=>{O(Math.max(1,Math.min(a,$e)))};r.useEffect(()=>{O(1)},[d,f,R]);const Z=r.useMemo(()=>t.filter(a=>a.status==="Confirmed"||a.status==="On Site").sort((a,n)=>new Date(a.startDate).getTime()-new Date(n.startDate).getTime()),[t]);r.useEffect(()=>{p==="map"&&Z.length>0&&!me?ue({lat:Z[0].lat,lng:Z[0].lng,title:Z[0].name}):p!=="map"&&ue(null)},[p,Z,me]);const ta=async(a,n,o)=>{if(n!=="technician")return;const A=t.find(x=>x.id===a);if(!A)return;const T=o==="unassigned"?null:Number(o);if(o!=="unassigned"&&(!Number.isFinite(T)||T<=0)){g("Teknisi tidak valid (user_id harus angka).","error");return}const D=T==null?null:u.find(x=>x.id===T),j=(D==null?void 0:D.name)??"Belum Ditugaskan";try{if(!A.formId){g("form_id tidak ditemukan untuk booking ini.","error");return}const x=t.map(V=>V.id===a?{...V,technician:j,technicianUserId:T}:V);l(x),g(`Teknisi untuk ${A.name} berhasil diubah.`,"success")}catch(x){console.error(x),g((x==null?void 0:x.message)||"Gagal mengubah teknisi di server.","error")}},sa=a=>{const n=t.find(D=>D.id===a);if(!n)return;const o=Ie[a]??n.status;if(o===n.status){g("Status belum berubah, tidak ada yang perlu diupdate.","info");return}let A="Ubah Status Booking?",T=`Apakah Anda yakin ingin mengubah status pesanan untuk ${n.name} dari "${n.status}" menjadi "${o}"?`;o==="Completed"?(A="Selesaikan Pesanan?",T=`Apakah Anda yakin ingin menyelesaikan pesanan untuk ${n.name}?`):o==="Cancelled"&&(A="Batalkan Pesanan?",T=`Apakah Anda yakin ingin membatalkan pesanan untuk ${n.name}? Tindakan ini tidak dapat diurungkan.`),Me({isOpen:!0,bookingId:a,field:"status",value:o,title:A,message:T})},ee=()=>{Me({isOpen:!1,bookingId:null,field:null,value:null,title:"",message:""})},ra=async()=>{const{bookingId:a,field:n}=se;if(!a||!n){ee();return}if(n==="status"){const o=t.find(D=>D.id===a);if(!o){ee();return}const A=o.status,T=o.technicianUserId??null;try{if(!o.formId){g("form_id tidak ditemukan untuk booking ini.","error"),ee();return}await Fa(o.formId,A,T);const D=T==null?null:u.find(x=>Number(x.id)===Number(T)),j=t.map(x=>x.id===a?{...x,status:A,technicianUserId:T,technician:(D==null?void 0:D.name)??"Belum Ditugaskan"}:x);l(j),be(x=>({...x,[a]:A})),g(`Booking ${o.name} berhasil diupdate.`,"success")}catch(D){console.error(D),g((D==null?void 0:D.message)||"Gagal mengubah status/teknisi di server.","error")}finally{ee()}return}ee()},na=()=>{if(!te)return;const a=U(te),n=new Set(P);n.has(a)?n.delete(a):n.add(a),H(n)},la=a=>{if(!te)return;const n=`${U(te)}-${a}`,o=new Set(F);o.has(n)?o.delete(n):o.add(n),ae(o)},ia=async()=>{try{await za({fullyBookedDates:Array.from(P),bookedSlots:Array.from(F)}),W(new Set(P)),b(new Set(F)),we(!0),setTimeout(()=>we(!1),3e3),g("Availability berhasil disimpan ke server.","success")}catch(a){console.error(a),g((a==null?void 0:a.message)||"Gagal menyimpan availability ke server.","error")}},da=a=>{const n=new Set(P);n.delete(a),H(n)},oa=()=>{Se(null),Ce(null),ie(!0)},ca=(a,n)=>{Se(a),Ce(n),ie(!0)},ma=(a,n)=>{const o=!!J,A=n&&!Number.isNaN(Number(n))?Number(n):a.service_category,T=v.find(x=>x.id===A),D={...a,service_category:A,category:(T==null?void 0:T.name)??a.category},j=x=>{s(V=>{let X=[...V];o&&J&&(X=X.filter(fe=>fe.id!==J.id));const le=X.findIndex(fe=>fe.id===x.id);return le>-1?X[le]=x:X.push(x),X})};(async()=>{try{if(o){const x=J==null?void 0:J.id;if(!x){g("ID layanan tidak ditemukan dari API.","error");return}await Ua(x,D),j({...D,id:x})}else{const x=await Ra(D,D.category,v),V=h.length>0?Math.max(...h.map(le=>le.id?Number(le.id):0))+1:1;j({...D,id:x??V})}ie(!1),g(`Layanan "${a.name}" berhasil ${o?"diperbarui":"disimpan ke server"}.`,"success")}catch(x){console.error(x),g("Gagal menyimpan layanan ke server.","error")}})()},ua=async()=>{if(!de)return;const{serviceId:a,serviceName:n}=de;try{await Ha(a),s(o=>o.filter(A=>A.id!==a)),xe(null),g(`Layanan "${n}" telah dihapus.`,"success")}catch(o){console.error(o),g(`Gagal menghapus layanan "${n}" di server.`,"error")}},xa=()=>{De(null),he(!0)},ha=a=>{De(a),he(!0)},ga=async a=>{if(!i.find(o=>o.name===a.role)){g("Role user tidak valid. Silakan refresh halaman.","error");return}},pa=async()=>{if(!Y)return;const a=L==null?void 0:L.id;if(a&&Y.id===a){g("Tidak bisa menghapus akun yang sedang login.","error"),oe(null);return}try{await Ea(Y.id),c(n=>n.filter(o=>o.id!==Y.id)),g(`User "${Y.name}" telah dihapus.`,"success")}catch(n){console.error(n),g((n==null?void 0:n.message)||"Gagal menghapus user di server.","error")}finally{oe(null)}},ba=async a=>{try{const n=a.status||"Confirmed",o=Pe[n]||Pe.Confirmed,A={...a,status:o};await La(A),g(`Booking baru untuk ${a.fullname} berhasil disimpan.`,"success"),await ne(),ge(!1)}catch(n){console.error(n),g(`Gagal menyimpan booking: ${(n==null?void 0:n.message)||"Unknown error"}`,"error")}},ya=r.useMemo(()=>{const a={};Q.forEach(j=>a[j.name]={completed:0,totalMinutes:0}),t.forEach(j=>{j.technician!=="Belum Ditugaskan"&&j.status==="Completed"&&(a[j.technician]||(a[j.technician]={completed:0,totalMinutes:0}),a[j.technician].completed+=1,a[j.technician].totalMinutes+=j.workDurationMinutes||0)});const n=Object.entries(a).map(([j,x])=>({name:j,...x})),o=t.reduce((j,x)=>(x.status==="Completed"&&(j[x.service]=(j[x.service]||0)+1),j),{}),A=Object.entries(o).sort(([,j],[,x])=>x-j).slice(0,5).map(([j,x])=>({label:j,value:x})),T=t.reduce((j,x)=>(j[x.status]=(j[x.status]||0)+1,j),{}),D=Object.entries(T).map(([j,x])=>({label:j,value:x}));return{technicianPerformance:n,popularServices:A,statusDistribution:D}},[t,Q]),fa=r.useMemo(()=>{const a=[];return re.forEach(n=>{n.schedules.forEach(o=>{const A=o.schedule_date,T=o.schedule_date;a.push({id:o.apply_id,formId:o.form_id,applyId:o.apply_id,name:o.fullname,whatsapp:o.wa,service:o.service,address:o.address,startDate:A,endDate:T,time:o.schedule_time,technician:n.fullname,technicianUserId:n.user_id,status:_a(o.status),lat:0,lng:0,arrivalTime:null,startTime:null,endTime:null,workDurationMinutes:60,additionalCosts:0,note:"",photos:{arrival:void 0,before:void 0,after:void 0}})})}),a},[re]),ka=r.useMemo(()=>re.length>0?re.map(a=>({id:a.user_id,name:a.fullname,username:"",role:"technician"})):Q,[re,Q]),ja=r.useMemo(()=>{const a=v.map(o=>o.name);if(a.length>0)return a;const n=h.map(o=>o.category);return Array.from(new Set(n))},[v,h]),va={kpi:"Dashboard KPI",bookings:"Daftar Booking",schedule:"Jadwal Teknisi",map:"Peta Lokasi Tugas",technicians:"Manajemen Tim/User",services:"Manajemen Layanan",availability:"Atur Ketersediaan Jadwal"},Na=()=>{switch(p){case"bookings":return e.jsx(tt,{paginatedBookings:ea,currentPage:w,totalPages:$e,goToPage:aa,searchTerm:d,setSearchTerm:M,statusFilter:f,setStatusFilter:_,technicianFilter:R,setTechnicianFilter:S,technicians:Q,statuses:yt,expandedBookingId:I,setExpandedBookingId:y,statusDraft:Ie,setStatusDraft:be,onStatusSubmit:sa,onTechnicianChange:ta});case"schedule":return e.jsx(gt,{scheduleDate:ce,onScheduleDateChange:Ve,isLoading:Xe,error:Qe,bookings:fa,technicians:ka});case"map":return e.jsx(ut,{upcomingJobs:Z,selectedLocation:me,onSelectLocation:ue});case"technicians":return e.jsx(bt,{users:u,onAddTechnician:xa,onEditTechnician:ha,onRequestDelete:oe});case"services":return e.jsx(pt,{services:h,onAddService:oa,onEditService:ca,onRequestDelete:xe});case"availability":return e.jsx(it,{availableTimes:Ze,selectedDate:te,onSelectedDateChange:He,draftFullyBooked:P,draftBookedSlots:F,onToggleFullDay:na,onToggleSlot:la,onRemoveBlockedDate:da,hasUnsavedChanges:Ee,showSaveSuccess:Ge,onSaveChanges:ia});case"kpi":return e.jsx(mt,{kpiData:ya});default:return null}};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx(nt,{activeSection:p,onSectionChange:a=>{N(a),C(!1)},isOpen:m,onClose:()=>C(!1),onLogout:$}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(st,{currentUserName:L==null?void 0:L.name,onOpenSidebar:()=>C(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white",children:va[p]}),p==="bookings"&&e.jsx("button",{onClick:()=>ge(!0),className:"inline-flex items-center gap-2 bg-primary text-white font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:"Tambah Booking"})]}),Na()]})]})]}),m&&e.jsx("div",{onClick:()=>C(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"}),e.jsx(Xa,{isOpen:Ye,onClose:()=>ge(!1),onSave:ba,services:h,technicians:Q,availability:{fullyBookedDates:Array.from(K),bookedSlots:Array.from(q)}}),e.jsx(Za,{isOpen:Ke,onClose:()=>ie(!1),onSave:ma,serviceToEdit:J,categoryToEdit:We,allCategories:ja,serviceCategories:v}),e.jsx(lt,{isOpen:qe,onClose:()=>he(!1),onSave:ga,technicianToEdit:Je,existingUsernames:u.map(a=>a.username),roles:i}),e.jsx(je,{isOpen:se.isOpen,onClose:ee,onConfirm:ra,title:se.title,confirmText:"Ya, Lanjutkan",confirmButtonClass:se.value==="Cancelled"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-primary hover:bg-primary-dark focus:ring-primary",children:e.jsx("p",{children:se.message})}),de&&e.jsx(je,{isOpen:!0,onClose:()=>xe(null),onConfirm:ua,title:"Hapus Layanan?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus layanan"," ",e.jsxs("span",{className:"font-bold",children:['"',de.serviceName,'"']}),"? Tindakan ini tidak dapat diurungkan."]})}),Y&&e.jsx(je,{isOpen:!0,onClose:()=>oe(null),onConfirm:pa,title:"Hapus User?",confirmText:"Ya, Hapus",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:e.jsxs("p",{children:["Apakah Anda yakin ingin menghapus user"," ",e.jsxs("span",{className:"font-bold",children:['"',Y.name,'"']}),"? Tindakan ini tidak dapat diurungkan."]})})]})};export{St as default};
