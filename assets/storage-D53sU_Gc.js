const p=a=>{const e=a.getFullYear(),t=(a.getMonth()+1).toString().padStart(2,"0"),n=a.getDate().toString().padStart(2,"0");return`${e}-${t}-${n}`},g=new Date(new Date().setDate(new Date().getDate()+1)),D=new Date(new Date().setDate(new Date().getDate()+5)),y=new Set([`${p(g)}-10:30`]),w=new Set([p(D)]),f="https://api-homeservice.viniela.id",c=`${f}/api/v1/admin`;async function d(a,e={}){const t=await fetch(a,{...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers||{}}}),n=await t.json().catch(()=>null);if(!t.ok){const i=(n==null?void 0:n.message)||(n==null?void 0:n.error)||`Request gagal (status ${t.status})`;throw new Error(i)}return(n==null?void 0:n.data)??n}const S=a=>{const e=a.getFullYear(),t=(a.getMonth()+1).toString().padStart(2,"0"),n=a.getDate().toString().padStart(2,"0");return`${e}-${t}-${n}`},k=a=>{const[e,t,n]=a.split("-").map(Number);return new Date(e,t-1,n)},b=(a,e,t,n,i)=>{const o=[],s=new Date;s.setHours(a,0,0,0);const r=new Date;r.setHours(e,0,0,0);const u=new Date;u.setHours(t,0,0,0);const m=new Date;for(m.setHours(n,0,0,0);s<r;)(s<u||s>=m)&&o.push(s.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}).replace(".",":")),s.setMinutes(s.getMinutes()+i);return o};function h(a){const e=(a||"").toLowerCase().trim();return e==="confirmed"||e.includes("confirm")?"Confirmed":e==="onsite"||e==="on site"||e.includes("on site")||e.includes("onsite")||e.includes("arrive")?"On Site":e==="inprogress"||e==="in progress"||e.includes("progress")?"In Progress":e==="completed"||e.includes("complete")||e.includes("done")||e.includes("selesai")?"Completed":e==="cancelled"||e==="canceled"||e.includes("cancel")||e.includes("batal")?"Cancelled":"Confirmed"}function l(a,e=0){const t=Number(a);return Number.isFinite(t)?t:e}const _=async()=>{const e=(await d(`${c}/user-booking-list`)||[]).map(t=>{const n=new Date(t.schedule_date).toISOString(),i=t.lat==null?0:l(t.lat,0),o=t.lng==null?0:l(t.lng,0),s=t.technician_id==null?null:l(t.technician_id,0),r=t.apply_id??null;return{id:Number(r??t.form_id),formId:Number(t.form_id),applyId:r,name:t.customer_name,whatsapp:t.customer_wa,address:t.address,service:t.service,startDate:n,endDate:n,time:t.schedule_time,status:h(t.status),technician:t.technician_name||"Belum Ditugaskan",technicianId:s,technicianUsername:t.technician_username??null,lat:i,lng:o,note:t.note||"",additionalCosts:t.additional_cost==null?0:l(t.additional_cost,0),photos:{arrival:t.arrive_photo||void 0,before:t.before_photo||void 0,after:t.after_photo||void 0},arrivalTime:t.arrival_time,startTime:t.start_time,endTime:t.end_time,workDurationMinutes:t.work_duration_minutes}});return e.sort((t,n)=>new Date(n.startDate).getTime()-new Date(t.startDate).getTime()||(n.applyId??n.formId)-(t.applyId??t.formId)),e},v=async()=>{try{const a=await d(`${c}/availability`);return{fullyBookedDates:Array.isArray(a.fullyBookedDates)?a.fullyBookedDates:[],bookedSlots:Array.isArray(a.bookedSlots)?a.bookedSlots:[]}}catch(a){return console.warn("Availability API fallback ke config default:",a),{fullyBookedDates:Array.from(w),bookedSlots:Array.from(y)}}},$=async a=>{await d(`${c}/availability`,{method:"PUT",body:JSON.stringify({fullyBookedDates:a.fullyBookedDates??[],bookedSlots:a.bookedSlots??[]})})};async function A(a,e,t){const n=new FormData;n.append("form_id",String(a)),n.append("type",e),n.append("file",t);const i=await fetch(`${c}/booking-photo-upload`,{method:"POST",credentials:"include",body:n}),o=await i.json().catch(()=>null);if(!i.ok){const r=(o==null?void 0:o.message)||(o==null?void 0:o.error)||`Upload gagal (status ${i.status})`;throw new Error(r)}return(o==null?void 0:o.data)??o}function I(a){return a?/^https?:\/\//i.test(a)?a:`${f}${a}`:null}export{b as a,_ as b,S as f,v as g,k as p,I as r,$ as s,A as u};
