import{c as G,j as e,C as Y,r as i,d as K,e as V}from"./index-BOS2NBN7.js";import{C as q}from"./clock-YiuoAvGz.js";import{G as Q,b as X,L as Z,M as ee,a as te}from"./GenericConfirmationModal-BPoU0DXc.js";import{s as J}from"./notifications-D5TRqq6t.js";import{r as ae,u as se,b as re}from"./storage-BHb65FEp.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=G("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),le=({stats:t,todayJobs:r,isLoading:c})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(W,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tugas Hari Ini"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.today})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(q,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Tugas Minggu Ini"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.thisWeek})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary-light p-3 rounded-full",children:e.jsx(Y,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Tugas Selesai"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:t.completed})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:"Jadwal Hari Ini"}),c?e.jsx("div",{className:"text-center py-10 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Memuat data..."})}):r.length>0?e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg divide-y dark:divide-slate-700",children:r.map(a=>e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.service})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-primary",children:a.time}),e.jsx("p",{className:"text-xs text-gray-400",children:a.status})]})]},a.id))}):e.jsx("div",{className:"text-center py-10 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Tidak ada jadwal untuk hari ini."})})]})]}),ne=({currentUserName:t,onOpenSidebar:r})=>e.jsxs("header",{className:"sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm h-20 flex items-center justify-between lg:justify-end px-6",children:[e.jsx("button",{onClick:r,className:"lg:hidden p-2 text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["Hello, ",t]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-light dark:bg-slate-700 flex items-center justify-center text-primary font-bold text-lg",children:t==null?void 0:t.charAt(0)})]})]}),U=({label:t,photoUrlOrPath:r,onUploadFile:c,disabled:a=!1,size:l=72})=>{const[m,x]=i.useState(!1),[o,f]=i.useState(null),y=i.useRef(null),b=i.useMemo(()=>ae(r),[r]),j=o||b||null,D=()=>{var k;a||m||(k=y.current)==null||k.click()},_=async k=>{var v;const C=(v=k.target.files)==null?void 0:v[0];if(!C)return;const I=URL.createObjectURL(C);f(I);try{x(!0),await c(C)}catch(u){console.error(u),alert((u==null?void 0:u.message)||"Gagal upload foto."),f(null)}finally{x(!1),y.current&&(y.current.value=""),setTimeout(()=>{URL.revokeObjectURL(I)},1e3)}};return e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-100 truncate",children:t}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j?"Preview siap":"Belum ada foto"})]}),e.jsx("div",{className:"shrink-0",children:e.jsxs("button",{type:"button",onClick:D,disabled:a||m,className:`group relative overflow-hidden rounded-xl border shadow-sm transition ${a?"opacity-60 cursor-not-allowed":"hover:shadow-md"} border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800`,style:{width:l,height:l},"aria-label":j?`Ganti ${t}`:`Unggah ${t}`,children:[j?e.jsx("img",{src:j,alt:t,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-50 dark:bg-slate-900",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})})}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center text-[11px] font-bold text-white transition ${m?"bg-black/55 opacity-100":"bg-black/40 opacity-0 group-hover:opacity-100"}`,children:m?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Upload"]}):e.jsx("span",{children:j?"Ganti":"Unggah"})}),e.jsx("input",{ref:y,type:"file",className:"sr-only",onChange:_,accept:"image/*",disabled:a||m})]})})]})},R={Confirmed:1,"On Site":2,"In Progress":3,Completed:4,Cancelled:5};async function ie(t,r,c,a){var f,y;const l=R[r]??R.Confirmed,m=((y=(f=import.meta)==null?void 0:f.env)==null?void 0:y.VITE_API_BASE_URL)||"https://api-homeservice.viniela.id",x=await fetch(`${m}/api/v1/admin/update-booking-status`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({form_id:t,user_id:c,arrival_time:a.arrival_time,start_time:a.start_time,end_time:a.end_time,work_duration_minutes:a.work_duration_minutes,note:a.note,additional_cost:a.additional_cost,status:l})}),o=await x.json().catch(()=>null);if(!x.ok){const b=(o==null?void 0:o.message)||(o==null?void 0:o.error)||`Gagal update status (status ${x.status})`;throw new Error(b)}}const z=({booking:t,currentTechnicianId:r,onBookingUpdateLocal:c,onRefresh:a})=>{var F,H;const{addNotification:l}=K(),m=new Date;m.setHours(0,0,0,0);const x=new Date(t.startDate);x.setHours(0,0,0,0);const o=new Date(t.endDate);o.setHours(0,0,0,0);const f=x.getTime()!==o.getTime(),y=m>=x&&m<=o,b=m.getTime()===x.getTime(),j=m.getTime()===o.getTime(),[D,_]=i.useState(!1),[k,T]=i.useState(!1),[C,I]=i.useState(t.note||""),[v,u]=i.useState(t.additionalCosts||0),[L,O]=i.useState(()=>(t.additionalCosts||0).toString()==="0"?"0":new Intl.NumberFormat("id-ID").format(t.additionalCosts||0)),E=s=>{const g=s.target.value;if(g===""){u(0),O("");return}const d=parseInt(g.replace(/\./g,""),10);isNaN(d)||(u(d),O(new Intl.NumberFormat("id-ID").format(d)))},n=()=>{L===""&&O("0")},w=()=>{const s=t.formId??t.form_id??null;if(!s)throw new Error("form_id tidak ditemukan pada booking (cek mapping API).");return Number(s)},h=async(s,g)=>{const d=w();if(!d)throw new Error("booking.id tidak valid untuk form_id.");await ie(d,s,r,g);const N={...t,...g,status:s};c(N),await a()},M=async s=>{const g=new Date().toISOString();try{if(s==="On Site"){const d=J("technician_on_the_way",{...t,status:s,arrivalTime:g});l(d,"info"),await h(s,{arrival_time:g});return}if(s==="In Progress"){await h(s,{start_time:g});return}await h(s)}catch(d){console.error(d),l((d==null?void 0:d.message)||"Gagal update status di server.","error")}},S=async(s,g)=>{const d=w();if(!d)throw new Error("booking.id tidak valid untuk form_id.");const N=await se(d,s,g),$=N==null?void 0:N.url,A={...t,photos:{...t.photos||{},[s]:$}};c(A),await a()},p=async()=>{try{const s=new Date,g=t.startTime||new Date().toISOString(),d=new Date(g),N=Math.round((s.getTime()-d.getTime())/6e4);await h("Completed",{end_time:s.toISOString(),work_duration_minutes:N>0?String(N):String(0),note:C,additional_cost:v});const $=J("job_completed",{...t,status:"Completed"});l($,"success"),_(!1),T(!1)}catch(s){console.error(s),l((s==null?void 0:s.message)||"Gagal menyelesaikan pekerjaan.","error")}},P=()=>{const s=x.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"});if(!f)return`${s} - ${t.time}`;const g=o.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"});return`${s} s/d ${g}`},B=()=>{var s,g,d,N,$;if(!y&&t.status!=="Completed"&&t.status!=="Cancelled")return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-gray-500 dark:text-gray-400",children:"Tugas belum dimulai."})});switch(t.status){case"Confirmed":return b?e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700",children:e.jsx("button",{onClick:()=>M("On Site"),className:"w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors",children:"Saya Sudah di Lokasi"})}):e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsxs("p",{className:"font-semibold text-gray-500 dark:text-gray-400",children:["Tugas dimulai pada ",x.toLocaleDateString("id-ID")]})});case"On Site":return e.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:[e.jsx(U,{label:"Foto Tiba di Lokasi",photoUrlOrPath:(s=t.photos)==null?void 0:s.arrival,onUploadFile:A=>S("arrival",A)}),((g=t.photos)==null?void 0:g.arrival)&&e.jsx(U,{label:"Foto Sebelum Pengerjaan",photoUrlOrPath:(d=t.photos)==null?void 0:d.before,onUploadFile:A=>S("before",A)}),e.jsx("button",{onClick:()=>M("In Progress"),disabled:!((N=t.photos)!=null&&N.arrival)||!(($=t.photos)!=null&&$.before),className:"w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors disabled:bg-gray-400",children:"Mulai Pekerjaan"})]});case"In Progress":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:j?e.jsx("button",{onClick:()=>_(!0),className:"w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors",children:"Selesaikan Pekerjaan"}):e.jsx("p",{className:"font-semibold text-yellow-600 dark:text-yellow-400 text-center",children:"Pekerjaan Sedang Berlangsung"})});case"Completed":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-green-600 dark:text-green-400",children:"Pekerjaan Selesai"})});case"Cancelled":return e.jsx("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 text-center",children:e.jsx("p",{className:"font-semibold text-red-600 dark:text-red-400",children:"Dibatalkan"})});default:return null}};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border-l-4 border-transparent",children:[e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.service}),e.jsx("p",{className:"font-bold text-lg text-gray-800 dark:text-white",children:t.name})]}),y&&e.jsx("span",{className:"text-xs font-bold bg-primary text-white px-2 py-1 rounded-full",children:"AKTIF HARI INI"})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-secondary dark:text-slate-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Jadwal:"})," ",P()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Alamat:"})," ",t.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Telepon:"})," ",t.whatsapp]})]}),D?e.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-slate-700 space-y-4",children:[e.jsx("h4",{className:"font-bold text-center",children:"Formulir Penyelesaian"}),e.jsx(U,{label:"Foto Setelah Selesai",photoUrlOrPath:(F=t.photos)==null?void 0:F.after,onUploadFile:s=>S("after",s)}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`notes-${t.id}`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Catatan Pekerjaan Tambahan"}),e.jsx("textarea",{id:`notes-${t.id}`,rows:3,value:C,onChange:s=>I(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"Catatan tambahan..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`costs-${t.id}`,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Biaya Tambahan (Bahan, dll.)"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"Rp"})}),e.jsx("input",{type:"text",inputMode:"numeric",id:`costs-${t.id}`,value:L,onChange:E,onBlur:n,className:"block w-full rounded-md border-gray-300 pl-8 pr-2 dark:bg-slate-700 dark:border-slate-600 focus:border-primary focus:ring-primary sm:text-sm",placeholder:"0"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>_(!1),className:"w-full bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors",children:"Batal"}),e.jsx("button",{onClick:()=>T(!0),disabled:!((H=t.photos)!=null&&H.after),className:"w-full bg-primary text-white font-bold py-2 px-4 rounded-lg hover:bg-primary-dark transition-colors disabled:bg-gray-400",children:"Konfirmasi Selesai"})]})]}):B()]}),e.jsx(Q,{isOpen:k,onClose:()=>T(!1),onConfirm:p,title:"Konfirmasi Penyelesaian",confirmText:"Ya, Selesaikan",confirmButtonClass:"bg-green-600 hover:bg-green-700 focus:ring-green-500",children:e.jsx("p",{children:"Apakah Anda yakin ingin menyelesaikan pekerjaan ini?"})})]})},oe=({jobFilter:t,setJobFilter:r,refreshBookings:c,categories:a,completedJobs:l,currentTechnicianId:m,onBookingUpdateLocal:x,onRefresh:o})=>{const f=i.useMemo(()=>Object.entries(a),[a]),y=i.useMemo(()=>f.every(([,b])=>b.length===0),[f]);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center gap-3",children:[e.jsxs("div",{className:"inline-flex rounded-md shadow-sm bg-white dark:bg-slate-800 p-1",children:[e.jsx("button",{onClick:()=>r("upcoming"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${t==="upcoming"?"bg-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:"Akan Datang"}),e.jsx("button",{onClick:()=>r("completed"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${t==="completed"?"bg-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:"Riwayat"})]}),e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-semibold rounded-md bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700",children:"Refresh"})]}),t==="upcoming"&&(y?e.jsx("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Tidak Ada Tugas Akan Datang"})}):e.jsx("div",{className:"space-y-10",children:f.map(([b,j])=>j.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold font-poppins text-gray-800 dark:text-white mb-4",children:b}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:j.map(D=>e.jsx(z,{booking:D,currentTechnicianId:m,onBookingUpdateLocal:x,onRefresh:o},D.id))})]},b):null)})),t==="completed"&&(l.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:l.map(b=>e.jsx(z,{booking:b,currentTechnicianId:m,onBookingUpdateLocal:x,onRefresh:o},b.id))}):e.jsx("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-xl shadow-md",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Belum Ada Riwayat Tugas"})}))]})};function de(t,r,c){const a=t==null?void 0:t.slice(0,10),l=r==null?void 0:r.slice(0,10);return a!==l?`${a} s/d ${l}`:`${a} - ${c}`}const ce=({upcomingJobsFlat:t,selectedLocation:r,setSelectedLocation:c})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]","data-aos":"fade-up",children:[e.jsx("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 shadow-xl rounded-2xl p-4 space-y-3 h-full overflow-y-auto",children:t.length>0?t.map(a=>e.jsx("div",{className:`w-full p-4 rounded-lg transition-all duration-200 border-l-4 ${(r==null?void 0:r.title)===a.name?"bg-primary-light dark:bg-slate-700 border-primary":"bg-transparent"}`,children:e.jsxs("button",{onClick:()=>c({lat:a.lat,lng:a.lng,title:a.name}),className:"w-full text-left",children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm font-semibold text-primary mt-1",children:de(a.startDate,a.endDate,a.time)})]})},a.id)):e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:"Tidak ada pekerjaan akan datang."})})}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 shadow-xl rounded-2xl overflow-hidden h-full flex flex-col",children:r?e.jsx("iframe",{title:"Job Location Map",className:"w-full h-full border-0",src:`https://maps.google.com/maps?q=${r.lat},${r.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,allowFullScreen:!1,loading:"lazy"},`${r.lat}-${r.lng}`):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400 p-6",children:[e.jsx(X,{size:48,className:"mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"font-bold text-xl",children:"Peta Lokasi Tugas"}),e.jsx("p",{children:"Tidak ada tugas akan datang untuk ditampilkan."})]})})]}),me=({isOpen:t,activeSection:r,onSelect:c,onLogout:a})=>e.jsxs("aside",{className:`fixed lg:relative lg:translate-x-0 inset-y-0 left-0 z-50 w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 ease-in-out ${t?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b dark:border-slate-700 h-20",children:e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 font-poppins",children:"Teknisi"})}),e.jsx("nav",{className:"flex-grow p-4 space-y-2",children:[{name:"Dashboard",icon:Z,section:"dashboard"},{name:"Tugas Saya",icon:W,section:"jobs"},{name:"Peta Tugas",icon:ee,section:"map"}].map(l=>e.jsxs("button",{onClick:()=>c(l.section),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold transition-colors ${r===l.section?"bg-primary-light text-primary dark:bg-slate-700":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700/50"}`,children:[e.jsx(l.icon,{size:20}),l.name]},l.section))}),e.jsx("div",{className:"p-4 border-t dark:border-slate-700",children:e.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-base font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(te,{size:20}),"Logout"]})})]}),fe=()=>{const{currentUser:t,logout:r}=V(),[c,a]=i.useState([]),[l,m]=i.useState("dashboard"),[x,o]=i.useState(!1),[f,y]=i.useState(null),[b,j]=i.useState("upcoming"),[D,_]=i.useState(!1),k=i.useCallback(async()=>{_(!0);try{const n=await re();a(n)}catch(n){console.error(n)}finally{_(!1)}},[]);if(i.useEffect(()=>{const n=()=>k();return window.addEventListener("focus",n),n(),()=>window.removeEventListener("focus",n)},[k]),!t)return e.jsx("div",{className:"text-center py-20",children:"Loading..."});const T=Number(t==null?void 0:t.id);if(!T)return e.jsx("div",{className:"text-center py-20",children:"currentUser.id tidak ada. Pastikan endpoint auth/me mengembalikan id user."});const C=i.useMemo(()=>c.filter(n=>Number(n.technicianId)===T).sort((n,w)=>new Date(n.startDate).getTime()-new Date(w.startDate).getTime()),[c,T]),{completedJobs:I,upcomingJobsCategorized:v,upcomingJobsFlat:u}=i.useMemo(()=>{const n=C.filter(p=>p.status!=="Completed"&&p.status!=="Cancelled"),w=C.filter(p=>p.status==="Completed"||p.status==="Cancelled"),h=new Date;h.setHours(0,0,0,0);const M=new Date(h);M.setDate(h.getDate()+1);const S={today:[],tomorrow:[],upcoming:[]};return n.forEach(p=>{const P=new Date(p.startDate);P.setHours(0,0,0,0);const B=new Date(p.endDate);B.setHours(0,0,0,0),P.getTime()===h.getTime()||h>P&&h<=B?S.today.push(p):P.getTime()===M.getTime()?S.tomorrow.push(p):P.getTime()>M.getTime()&&S.upcoming.push(p)}),{completedJobs:w,upcomingJobsCategorized:S,upcomingJobsFlat:n}},[C]);i.useEffect(()=>{l==="map"&&u.length>0&&!f&&y({lat:u[0].lat,lng:u[0].lng,title:u[0].name})},[l,u,f]);const L=n=>{a(w=>w.map(h=>h.id===n.id?n:h))},O=i.useMemo(()=>{const n=new Date,w=new Date(n);w.setDate(n.getDate()-n.getDay()),w.setHours(0,0,0,0);const h=new Date(w);h.setDate(w.getDate()+6),h.setHours(23,59,59,999);const M=u.filter(S=>{const p=new Date(S.startDate);return p>=w&&p<=h});return{today:v.today.length,thisWeek:M.length,completed:I.length}},[v.today,u,I]),E={dashboard:"Dashboard",jobs:"Tugas Saya",map:"Peta Tugas"};return e.jsxs("div",{className:"bg-light-bg dark:bg-slate-900 min-h-screen",children:[e.jsxs("div",{className:"flex",children:[e.jsx(me,{isOpen:x,activeSection:l,onSelect:n=>{m(n),o(!1)},onLogout:r}),e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsx(ne,{currentUserName:(t==null?void 0:t.name)||"",onOpenSidebar:()=>o(!0)}),e.jsxs("main",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold font-poppins text-gray-800 dark:text-white mb-6",children:E[l]}),l==="dashboard"&&e.jsx(le,{stats:O,todayJobs:v.today,isLoading:D}),l==="jobs"&&e.jsx(oe,{jobFilter:b,setJobFilter:j,refreshBookings:k,categories:{"Hari Ini":v.today,Besok:v.tomorrow,"Akan Datang":v.upcoming},completedJobs:I,currentTechnicianId:T,onBookingUpdateLocal:L,onRefresh:k}),l==="map"&&e.jsx(ce,{upcomingJobsFlat:u,selectedLocation:f,setSelectedLocation:y})]})]})]}),x&&e.jsx("div",{onClick:()=>o(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"})]})};export{fe as default};
